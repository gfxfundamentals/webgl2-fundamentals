<!DOCTYPE html>
<!-- this file is auto-generated from webgl/lessons/zh_cn/webgl-precision-issues.md. Do not edited directly -->
<!--
Copyright 2021, GFXFundamentals.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

*   Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.

*   Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the following disclaimer
    in the documentation and/or other materials provided with the
    distribution.

*   Neither the name of GFXFundamentals. nor the names of his
    contributors may be used to endorse or promote products derived from
    this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html lang="zh-cn">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="WebGL2里的各种精度问题">
<meta name="keywords" content="webgl webgl2 graphics">
<meta name="thumbnail" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-precision-issues_zh-cn.jpg">

<meta property="og:title" content="WebGL2 精度问题">
<meta property="og:type" content="website">
<meta property="og:image" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-precision-issues_zh-cn.jpg">
<meta property="og:description" content="WebGL2里的各种精度问题">
<meta property="og:url" content="https://webgl2fundamentals.org/webgl/lessons/zh_cn/webgl-precision-issues.html">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@greggman">
<meta name="twitter:creator" content="@greggman">
<meta name="twitter:domain" content="webgl2fundamentals.org">
<meta name="twitter:title" content="WebGL2 精度问题">
<meta name="twitter:url" content="https://webgl2fundamentals.org/webgl/lessons/zh_cn/webgl-precision-issues.html">
<meta name="twitter:description" content="WebGL2里的各种精度问题">
<meta name="twitter:image:src" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-precision-issues_zh-cn.jpg">

<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@graph":[
    {
      "@type":"WebSite",
      "@id":"https://webgl2fundamentals.org/#website",
      "url":"https://webgl2fundamentals.org/",
      "name":"Webgl2Fundamentals"
    },
    {
      "@type":"ImageObject",
      "@id":"https://webgl2fundamentals.org/webgl/lessons/zh_cn/webgl-precision-issues.html#primaryimage",
      "url":"https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-precision-issues_zh-cn.jpg",
      "width":1200,
      "height":630
    },
    {
      "@type":"WebPage",
      "@id":"https://webgl2fundamentals.org/webgl/lessons/zh_cn/webgl-precision-issues.html#webpage",
      "url":"https://webgl2fundamentals.org/webgl/lessons/zh_cn/webgl-precision-issues.html",
      "inLanguage":"zh-cn",
      "name":"WebGL2 精度问题",
      "keywords":"webgl webgl2 graphics programming",
      "isPartOf":{
        "@id":"https://webgl2fundamentals.org/#website"
      },
      "primaryImageOfPage":{
        "@id":"https://webgl2fundamentals.org/webgl/lessons/zh_cn/webgl-precision-issues.html#primaryimage"
      }
    }
  ]
}
</script>


<title>WebGL2 精度问题</title>
<link href="/webgl/lessons/resources/webgl2fundamentals-icon.png" rel="shortcut icon" type="image/png">
<link rel="stylesheet" href="/webgl/lessons/lang.css">
<link rel="stylesheet" href="/webgl/lessons/resources/lesson.css">

  <link rel="alternate" hreflang="en" href="https://webglfundamentals.org/webgl/lessons/webgl-precision-issues.html">
  <link rel="alternate" hreflang="de" href="https://webglfundamentals.org/webgl/lessons/de/webgl-precision-issues.html">
  <link rel="alternate" hreflang="ja" href="https://webglfundamentals.org/webgl/lessons/ja/webgl-precision-issues.html">
  <link rel="alternate" hreflang="ko" href="https://webglfundamentals.org/webgl/lessons/ko/webgl-precision-issues.html">
  <link rel="alternate" hreflang="pt-br" href="https://webglfundamentals.org/webgl/lessons/pt-br/webgl-precision-issues.html">
  <link rel="alternate" hreflang="zh_cn" href="https://webglfundamentals.org/webgl/lessons/zh_cn/webgl-precision-issues.html">




</head>
<body>
<div class="webgl_navbar">
  <div>
    <select class="language">
    <option value="/webgl/lessons/webgl-precision-issues.html" >English</a>
    <option value="/webgl/lessons/de/webgl-precision-issues.html" >Deutsch</a>
    <option value="/webgl/lessons/ja/webgl-precision-issues.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-precision-issues.html" >한국어</a>
    <option value="/webgl/lessons/pt-br/webgl-precision-issues.html" >Português Brasileiro</a>
    <option value="/webgl/lessons/zh_cn/webgl-precision-issues.html" selected>简体中文</a>
</select>


    <a href="#toc">目录</a>
    <input type="search" placeholder="?" id="search">
  </div>
</div>
<div class="webgl_header">
  <h1><a href="/webgl/lessons/zh_cn/">WebGL2Fundamentals.org</a></h1>
<style>
#forkongithub>div {
    background: #000;
    color: #fff;
    font-family: arial,sans-serif;
    text-align: center;
    font-weight: bold;
    padding: 5px 40px;
    font-size: 0.9rem;
    line-height: 1.3rem;
    position: relative;
    transition: 0.5s;
    display: block;
    width: 400px;
    position: absolute;
    top: 0;
    right: 0;
    transform: translateX(200px) rotate(45deg) translate(10px,70px);
    box-shadow: 4px 4px 10px rgba(0,0,0,0.8);
    pointer-events: auto;
}
#forkongithub a {
  text-decoration: none;
  color: #fff;
}
#forkongithub>div:hover {
    background: #c11;
    color: #fff;
}
#forkongithub .contributors {
  font-size: 0.75rem;
  background: rgba(255,255,255,0.2);
  line-height: 1.2;
  padding: 0.1em;
}
#forkongithub>div::before,#forkongithub>div::after {
    content: "";
    width: 100%;
    display: block;
    position: absolute;
    top: 1px;
    left: 0;
    height: 1px;
    background: #fff;
}
#forkongithub>div::after {
    bottom: 1px;
    top: auto;
}

#forkongithub{
    z-index: 9999;
    /* needed for firefox */
    overflow: hidden;
    width: 300px;
    height: 300px;
    position: absolute;
    right: 0;
    top: 0;
    pointer-events: none;
}
#forkongithub svg{
  width: 1em;
  height: 1em;
  vertical-align: middle;
}
#forkongithub img {
  width: 1em;
  height: 1em;
  border-radius: 100%;
  vertical-align: middle;
}

@media (max-width: 900px) {
    #forkongithub>div {
        line-height: 1.2rem;
    }
}
@media (max-width: 700px) {
  #forkongithub {
    display: none;
  }
}
@media (max-width: 410px) {
    #forkongithub>div {
        font-size: 0.7rem;
        transform: translateX(150px) rotate(45deg) translate(20px,40px);
    }
}

</style>
<div id="forkongithub"><div><div><a href="https://github.com/gfxfundamentals/webgl2-fundamentals">Fix, Fork, Contribute <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 136 133" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(3.92891,0,0,3.92891,67.867,129.125)">
        <path d="M0,-31.904C-8.995,-31.904 -16.288,-24.611 -16.288,-15.614C-16.288,-8.417 -11.621,-2.312 -5.148,-0.157C-4.333,-0.008 -4.036,-0.511 -4.036,-0.943C-4.036,-1.329 -4.05,-2.354 -4.058,-3.713C-8.589,-2.729 -9.545,-5.897 -9.545,-5.897C-10.286,-7.779 -11.354,-8.28 -11.354,-8.28C-12.833,-9.29 -11.242,-9.27 -11.242,-9.27C-9.607,-9.155 -8.747,-7.591 -8.747,-7.591C-7.294,-5.102 -4.934,-5.821 -4.006,-6.238C-3.858,-7.29 -3.438,-8.008 -2.972,-8.415C-6.589,-8.826 -10.392,-10.224 -10.392,-16.466C-10.392,-18.244 -9.757,-19.698 -8.715,-20.837C-8.883,-21.249 -9.442,-22.905 -8.556,-25.148C-8.556,-25.148 -7.188,-25.586 -4.076,-23.478C-2.777,-23.84 -1.383,-24.02 0.002,-24.026C1.385,-24.02 2.779,-23.84 4.08,-23.478C7.19,-25.586 8.555,-25.148 8.555,-25.148C9.444,-22.905 8.885,-21.249 8.717,-20.837C9.761,-19.698 10.392,-18.244 10.392,-16.466C10.392,-10.208 6.583,-8.831 2.954,-8.428C3.539,-7.925 4.06,-6.931 4.06,-5.411C4.06,-3.234 4.04,-1.477 4.04,-0.943C4.04,-0.507 4.333,0 5.16,-0.159C11.628,-2.318 16.291,-8.419 16.291,-15.614C16.291,-24.611 8.997,-31.904 0,-31.904" style="fill:white;"/>
    </g>
</svg>
</a></div></div></div>

</div>


<div class="container">
  <div class="lesson-title">
    <h1>WebGL2 精度问题</h1>
  </div>
  <div class="lesson">
    <div class="lesson-main">
      <p>本文讨论 WebGL2 中的各种精度问题。</p>
<h2 id="lowp-mediump-highp"><code class="notranslate" translate="no">lowp</code>, <code class="notranslate" translate="no">mediump</code>, <code class="notranslate" translate="no">highp</code></h2>
<p>在<a href="webgl-fundamentals.html">本站的第一篇文章</a>中，我们创建了顶点着色器和片段着色器。
在创建片段着色器时，顺带提到片段着色器没有默认的精度，所以我们需要通过添加这行代码来设置。</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-glsl">precision highp float;
</code></pre>
<p>这到底是怎么回事？</p>
<p><code class="notranslate" translate="no">lowp</code>、 <code class="notranslate" translate="no">mediump</code> 和 <code class="notranslate" translate="no">highp</code>是精度设置。
这里的精度实际上指的是用多少位(bit)来存储一个值。
JavaScript 中的数字使用 64 位，大多数 WebGL 中的数字只有 32 位。
位数越少意味着速度越快，位数越多意味着精度越高和/或范围越大。</p>
<p>我不确定自己是否能解释清楚。
你可以搜索<a href="https://www.google.com/search?q=double+vs+float">double vs float</a>
了解更多精度问题的示例，但一种简单的理解方法是将其比作字节和短整型，或者在 JavaScript 中的 Uint8Array 和 Uint16Array 的区别。</p>
<ul>
<li>Uint8Array 是一个无符号 8 位整数数组。8 位能表示 2<sup>8</sup>（256）个数，范围是 0 到 255。</li>
<li>Uint16Array 是一个无符号 16 位整数数组。16 位能表示 2<sup>16</sup>（65536）个数，范围是 0 到 65535。</li>
<li>Uint32Array 是一个无符号 32 位整数数组。32 位能表示 2<sup>32</sup>（约42亿）个数，范围是 0 到 4294967295。</li>
</ul>
<p><code class="notranslate" translate="no">lowp</code>、<code class="notranslate" translate="no">mediump</code> 和 <code class="notranslate" translate="no">highp</code> 也是类似的概念。</p>
<ul>
<li><code class="notranslate" translate="no">lowp</code> 至少是 9 位。对于浮点数，其值范围大致是 -2 到 +2，整数则类似于 <code class="notranslate" translate="no">Uint8Array</code> 或 <code class="notranslate" translate="no">Int8Array</code>。</li>
<li><code class="notranslate" translate="no">mediump</code> 至少是 16 位。对于浮点数，其值范围大致是 -2<sup>14</sup> 到 +2<sup>14</sup>，整数类似于 <code class="notranslate" translate="no">Uint16Array</code> 或 <code class="notranslate" translate="no">Int16Array</code>。</li>
<li><code class="notranslate" translate="no">highp</code> 至少是 32 位。对于浮点数，其值范围大致是 -2<sup>62</sup> 到 +2<sup>62</sup>，整数类似于 <code class="notranslate" translate="no">Uint32Array</code> 或 <code class="notranslate" translate="no">Int32Array</code>。</li>
</ul>
<p>需要注意的是，并非范围内的所有数值都能被表示。
最容易理解的是 <code class="notranslate" translate="no">lowp</code>，它只有 9 位，因此只能表示 512 个唯一值。
虽然它的范围是 -2 到 +2，但在这之间有无限多个值，比如 1.9999999 和 1.999998，这两个数值都不能被 <code class="notranslate" translate="no">lowp</code> 精确表示。
例如，如果你用 <code class="notranslate" translate="no">lowp</code> 做颜色计算，可能会出现色带现象。颜色范围是 0 到 1，而 lowp 在 0 到 1 之间大约只有 128 个可表示值。
这意味着如果你想加一个非常小的值（比如 1/512），它可能根本不会改变数值，因为无法被表示，实际上就像加了 0。</p>
<p>理论上，我们可以在任何地方使用 <code class="notranslate" translate="no">highp</code> 完全避免这些问题，但在实际设备上，使用 <code class="notranslate" translate="no">lowp</code> 和 <code class="notranslate" translate="no">mediump</code> 通常会比 <code class="notranslate" translate="no">highp</code> 快很多，有时甚至显著更快。</p>
<p>还有一点，和 <code class="notranslate" translate="no">Uint8Array</code>、<code class="notranslate" translate="no">Uint16Array</code> 不同的是，<code class="notranslate" translate="no">lowp</code>、<code class="notranslate" translate="no">mediump</code>、<code class="notranslate" translate="no">highp</code> 允许在内部使用更高的精度（更多位）。
例如，在桌面 GPU 上，如果你在着色器中写了 <code class="notranslate" translate="no">mediump</code>，它很可能仍然使用 32 位精度。
这导致在开发时很难测试 <code class="notranslate" translate="no">lowp</code> 或 <code class="notranslate" translate="no">mediump</code> 的真正表现。
要确认你的着色器在低精度设备上能正常工作，必须在实际使用较低精度的设备上测试。</p>
<p>如果你想用 <code class="notranslate" translate="no">mediump</code> 以提高速度，常见问题包括比如点光源的高光计算，它在世界空间或视图空间传递的值可能超出 <code class="notranslate" translate="no">mediump</code> 的范围。
可能在某些设备上你只能舍弃高光计算。下面是将<a href="webgl-3d-lighting-point.html">点光源</a>示例的片段着色器改为 <code class="notranslate" translate="no">mediump</code> 的代码示例：</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-glsl">#version 300 es

-precision highp float;
+precision mediump float;

// Passed in and varied from the vertex shader.
in vec3 v_normal;
in vec3 v_surfaceToLight;
in vec3 v_surfaceToView;

uniform vec4 u_color;
uniform float u_shininess;

// we need to declare an output for the fragment shader
out vec4 outColor;

void main() {
  // because v_normal is a varying it's interpolated
  // so it will not be a uint vector. Normalizing it
  // will make it a unit vector again
  vec3 normal = normalize(v_normal);

  vec3 surfaceToLightDirection = normalize(v_surfaceToLight);
-  vec3 surfaceToViewDirection = normalize(v_surfaceToView);
-  vec3 halfVector = normalize(surfaceToLightDirection + surfaceToViewDirection);

  // compute the light by taking the dot product
  // of the normal to the light's reverse direction
  float light = dot(normal, surfaceToLightDirection);
-  float specular = 0.0;
-  if (light &gt; 0.0) {
-    specular = pow(dot(normal, halfVector), u_shininess);
-  }

  outColor = u_color;

  // Lets multiply just the color portion (not the alpha)
  // by the light
  outColor.rgb *= light;

-  // Just add in the specular
-  outColor.rgb += specular;
}
</code></pre>
<p>注意：即便如此还不够。在顶点着色器中我们有以下代码：</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-glsl">  // compute the vector of the surface to the light
  // and pass it to the fragment shader
  v_surfaceToLight = u_lightWorldPosition - surfaceWorldPosition;
</code></pre>
<p>假设光源距离表面有 1000 个单位。
然后我们进入片段着色器，执行这一行代码：</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-glsl">  vec3 surfaceToLightDirection = normalize(v_surfaceToLight);
</code></pre>
<p>看起来似乎没问题。除了归一化向量的常规方法是除以其长度，而计算长度的标准方式是：</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">  float length = sqrt(v.x * v.x + v.y * v.y * v.z * v.z);
</code></pre>
<p>如果 x、y 或 z 中的某一个值是 1000，那么 1000×1000 就是 1000000。
而 1000000 超出了 <code class="notranslate" translate="no">mediump</code> 的表示范围。</p>
<p>这里的一个解决方案是在顶点着色器中进行归一化（normalize）。</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">  // compute the vector of the surface to the light
  // and pass it to the fragment shader
-  v_surfaceToLight = u_lightWorldPosition - surfaceWorldPosition;
+  v_surfaceToLight = normalize(u_lightWorldPosition - surfaceWorldPosition);
</code></pre>
<p>现在赋值给 <code class="notranslate" translate="no">v_surfaceToLight</code> 的数值范围在 -1 到 +1 之间，这正好落在 <code class="notranslate" translate="no">mediump</code> 的有效范围内。</p>
<p>请注意，在顶点着色器中进行归一化实际上不会得到完全相同的结果，但结果可能足够接近，以至于除非并排对比，否则没人会注意到差异。</p>
<p>像 <code class="notranslate" translate="no">normalize</code>、<code class="notranslate" translate="no">length</code>、<code class="notranslate" translate="no">distance</code>、<code class="notranslate" translate="no">dot</code> 这样的函数都会面临一个问题：如果参与计算的值过大，那么在 <code class="notranslate" translate="no">mediump</code> 精度下就可能超出其表示范围。</p>
<p>不过，你实际上需要在一个 <code class="notranslate" translate="no">mediump</code> 为 16 位的设备上进行测试。在桌面设备上，<code class="notranslate" translate="no">mediump</code> 实际上使用的是与 <code class="notranslate" translate="no">highp</code> 相同的 32 位精度，因此任何相关的问题在桌面上都不会显现出来。</p>
<h2 id="检测对16位-mediump-的支持">检测对16位 <code class="notranslate" translate="no">mediump</code> 的支持</h2>
<p>你调用 <code class="notranslate" translate="no">gl.getShaderPrecisionFormat</code>，传入着色器类型（<code class="notranslate" translate="no">VERTEX_SHADER</code> 或 <code class="notranslate" translate="no">FRAGMENT_SHADER</code>），以及以下精度类型之一：</p>
<ul>
<li><code class="notranslate" translate="no">LOW_FLOAT</code></li>
<li><code class="notranslate" translate="no">MEDIUM_FLOAT</code></li>
<li><code class="notranslate" translate="no">HIGH_FLOAT</code></li>
<li><code class="notranslate" translate="no">LOW_INT</code></li>
<li><code class="notranslate" translate="no">MEDIUM_INT</code></li>
<li><code class="notranslate" translate="no">HIGH_INT</code></li>
</ul>
<p>它会[返回精度信息]。</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-precision-lowp-mediump-highp.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-precision-lowp-mediump-highp.html" target="_blank">点此在新窗口中浏览</a>
</div>

</p>
<p><code class="notranslate" translate="no">gl.getShaderPrecisionFormat</code> 会返回一个对象，包含三个属性：<code class="notranslate" translate="no">precision</code>、<code class="notranslate" translate="no">rangeMin</code> 和 <code class="notranslate" translate="no">rangeMax</code>。</p>
<p>对于 <code class="notranslate" translate="no">LOW_FLOAT</code> 和 <code class="notranslate" translate="no">MEDIUM_FLOAT</code>，如果它们实际上就是 <code class="notranslate" translate="no">highp</code>，那么 <code class="notranslate" translate="no">precision</code> 将是 23。否则，它们通常分别是 8 和 15，或者至少会小于 23。对于 <code class="notranslate" translate="no">LOW_INT</code> 和 <code class="notranslate" translate="no">MEDIUM_INT</code>，如果它们等同于 <code class="notranslate" translate="no">highp</code>，那么 <code class="notranslate" translate="no">rangeMin</code> 会是 31。如果小于 31，则说明例如 <code class="notranslate" translate="no">mediump int</code> 比 <code class="notranslate" translate="no">highp int</code> 更高效。</p>
<p>我的 Pixel 2 XL 对于 <code class="notranslate" translate="no">mediump</code> 和 <code class="notranslate" translate="no">lowp</code> 都使用 16 位。我不确定自己是否用过使用 9 位表示 <code class="notranslate" translate="no">lowp</code> 的设备，因此也不清楚在这种情况下通常会遇到哪些问题。</p>
<p>在本文系列中，我们在片段着色器中通常会指定默认精度。我们也可以为每个变量单独指定精度，例如：</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-glsl">uniform mediump vec4 color;  // a uniform
in lowp vec4 normal;         // an attribute or varying input
out lowp vec4 texcoord;      // a fragment shader output or varying output
lowp float foo;              // a variable
</code></pre>
<h2 id="纹理格式">纹理格式</h2>
<p>纹理是规范中另一个指出“实际使用的精度可能高于请求精度”的地方。</p>
<p>例如，你可以请求一个每通道 4 位、总共 16 位的纹理，像这样：</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">gl.texImage2D(
  gl.TEXTURE_2D,               // target
  0,                           // mip level
  gl.RGBA4,                    // internal format
  width,                       // width
  height,                      // height
  0,                           // border
  gl.RGBA,                     // format
  gl.UNSIGNED_SHORT_4_4_4_4,   // type
  null,
);
</code></pre>
<p>但实现上实际上可能在内部使用更高分辨率的格式。<br>
我认为大多数桌面端会这样做，而大多数移动端 GPU 不会。</p>
<p>我们可以做个测试。首先我们会像上面那样请求一个每通道 4 位的纹理。<br>
然后我们会通过渲染一个 0 到 1 的渐变来<a href="webgl-render-to-texture.html">渲染到它</a>。</p>
<p>接着我们会将该纹理渲染到画布上。如果纹理内部确实是每通道 4 位，<br>
那么从我们绘制的渐变中只会有 16 个颜色级别。<br>
如果纹理实际上是每通道 8 位，我们将看到 256 个颜色级别。</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-precision-textures.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-precision-textures.html" target="_blank">点此在新窗口中浏览</a>
</div>

</p>
<p>在我的智能手机上运行时，我看到纹理使用的是每通道4位<br>
（至少红色通道是4位，因为我没有测试其他通道）。</p>
<div class="webgl_center"><img src="../resources/mobile-4-4-4-4-texture-no-dither.png" style="image-rendering: pixelated; width: 600px;"></div>
<p>而在我的桌面上，我看到纹理实际上使用的是每通道8位，<br>
尽管我只请求了4位。</p>
<div class="webgl_center"><img src="../resources/desktop-4-4-4-4-texture-no-dither.png" style="image-rendering: pixelated; width: 600px;"></div>
<p>需要注意的一点是，WebGL 默认会对结果进行抖动处理，<br>
使这种渐变看起来更平滑。你可以通过以下方式关闭抖动：</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">gl.disable(gl.DITHER);
</code></pre>
<p>如果我不关闭抖动处理，那么我的智能手机会产生这样的效果。</p>
<div class="webgl_center"><img src="../resources/mobile-4-4-4-4-texture-dither.png" style="image-rendering: pixelated; width: 600px;"></div>
<p>就我目前所知，这种情况通常只会在以下特定场景出现：当开发者将某种低比特精度的纹理格式用作渲染目标，却未在实际采用该低分辨率的设备上进行测试时。
若仅通过桌面端设备进行测试，由此引发的问题很可能无法被发现。</p>

    </div>
    <div class="lesson-sidebar">
        <select class="language">
    <option value="/webgl/lessons/webgl-precision-issues.html" >English</a>
    <option value="/webgl/lessons/de/webgl-precision-issues.html" >Deutsch</a>
    <option value="/webgl/lessons/ja/webgl-precision-issues.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-precision-issues.html" >한국어</a>
    <option value="/webgl/lessons/pt-br/webgl-precision-issues.html" >Português Brasileiro</a>
    <option value="/webgl/lessons/zh_cn/webgl-precision-issues.html" selected>简体中文</a>
</select>


        <div id="toc">
          <ul>  <li>基础概念</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-getting-webgl2.html">怎样使用WebGL2</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-fundamentals.html">基本原理</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-how-it-works.html">如何工作的</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-shaders-and-glsl.html">着色器和 GLSL 语言</a></li>
<li><a href="/webgl/lessons/resources/webgl-state-diagram.html?lang=zh_cn">WebGL2 State Diagram</a></li>
        </ul>
  <li>WebGL2 vs WebGL1</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl2-whats-new.html">WebGL2有什么新内容</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl1-to-webgl2.html">迁移WebGL1到WebGL2</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl1-to-webgl2-fundamentals.html">WebGLFundamentals.org和WebGL2Fundamentals.org的区别</a></li>
        </ul>
  <li>图像处理</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-image-processing.html">图像处理</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-image-processing-continued.html">进一步处理图像</a></li>
        </ul>
  <li>二维平移，旋转，缩放和矩阵运算</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-2d-translation.html">二维平移</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-2d-rotation.html">二维旋转</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-2d-scale.html">二维缩放</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-2d-matrices.html">二维矩阵</a></li>
        </ul>
  <li>三维</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-3d-orthographic.html">三维正射投影</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-3d-perspective.html">三维透视投影</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-3d-camera.html">三维相机</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-matrix-naming.html">WebGL2 三维矩阵命名</a></li>
        </ul>
  <li>光照</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-3d-lighting-directional.html">三维方向光源</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-3d-lighting-point.html">点光源</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-3d-lighting-spot.html">聚光灯</a></li>
        </ul>
  <li>组织和重构</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-less-code-more-fun.html">码少趣多</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-drawing-multiple-things.html">绘制多个物体</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-scene-graph.html">场景图</a></li>
        </ul>
  <li>几何</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-3d-geometry-lathe.html">三维几何加工</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-load-obj.html">加载 .obj 文件</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-load-obj-w-mtl.html">加载带 .mtl 的 .obj 文件</a></li>
        </ul>
  <li>纹理</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-3d-textures.html">纹理</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-data-textures.html">数据纹理</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-2-textures.html">使用多个纹理</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-cors-permission.html">跨域图像</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-3d-perspective-correct-texturemapping.html">纹理映射的透视纠正</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-planar-projection-mapping.html">平面的和透视的投影映射</a></li>
        </ul>
  <li>渲染到纹理</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-render-to-texture.html">渲染到纹理</a></li>
        </ul>
  <li>阴影</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-shadows.html">阴影</a></li>
        </ul>
  <li>技术</li>
        <ul>
            <li>二维</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-2d-drawimage.html">二维 DrawImage</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-2d-matrix-stack.html">二维矩阵栈</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-sprites.html">精灵</a></li>
        </ul>
  <li>三维</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-cube-maps.html">WebGL2 立方体贴图</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-environment-maps.html">WebGL2 环境贴图</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-skybox.html">WebGL2 天空盒</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-skinning.html">WebGL2 蒙皮</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-fog.html">WebGL2 雾</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-picking.html">拾取（点击物体）</a></li>
        </ul>
  <li>文字</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-text-html.html">文字 - HTML</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-text-canvas2d.html">文字 - 二维 Canvas</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-text-texture.html">文字 - 使用纹理</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-text-glyphs.html">文字 - 使用字形纹理</a></li>
        </ul>
  <li>GPGPU</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-gpgpu.html">通用GPU计算(GPGPU)</a></li>
        </ul>
        </ul>
  <li>技巧</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-smallest-programs.html">最小的程序</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-drawing-without-data.html">无数据绘制</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-shadertoy.html">Shadertoy</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-pulling-vertices.html">顶点拉取</a></li>
        </ul>
  <li>优化</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-indexed-vertices.html">顶点索引 (gl.drawElements)</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-instanced-drawing.html">实例化绘制</a></li>
        </ul>
  <li>杂项</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-setup-and-installation.html">设置和安装</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-boilerplate.html">样板</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-resizing-the-canvas.html">重置画布尺寸</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-animation.html">动画</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-points-lines-triangles.html">点、线段与三角形</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-multiple-views.html">多视图与多画布</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-visualizing-the-camera.html">可视化相机</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-and-alpha.html">WebGL2 和 Alpha</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-2d-vs-3d-library.html">2D vs 3D 库</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-anti-patterns.html">反模式</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-matrix-vs-math.html">WebGL2中的矩阵vs数学中的矩阵</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-precision-issues.html">精度问题</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-tips.html#screenshot">Taking a screenshot</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-tips.html#preservedrawingbuffer">Prevent the Canvas Being Cleared</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-tips.html#tabindex">Get Keyboard Input From a Canvas</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-tips.html#html-background">Use WebGL2 as Background in HTML</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-cross-platform-issues.html">跨平台问题</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-qna.html">Questions and Answers</a></li>
        </ul>
  <li>参考</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-attributes.html">属性（Attributes）</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-texture-units.html">纹理单元（Texture Units）</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-framebuffers.html">帧缓冲区（Framebuffers）</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-readpixels.html">readPixels</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-references.html">参考资料</a></li>
        </ul></ul>
<ul>
  <li><a href="/docs/">API帮助文档</a></li>
  <li><a href="https://twgljs.org">TWGL，一个轻量级WebGL辅助库</a></li>
  <li><a href="https://github.com/gfxfundamentals/webgl2-fundamentals">GitHub</a></li>
</ul>
        </div>
    </div>
    <div class="lesson-comments">
        
<div>有意见或建议? <a href="https://github.com/gfxfundamentals/webgl2-fundamentals/issues">在GitHub上提issue</a>.</div>
  

        <div id="disqus_thread"></div>
        <script>
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'webgl2fundamentals'; // required: replace example with your forum shortname
            var disqus_identifier = 'WebGL2 精度问题';
            var disqus_title = 'WebGL2 精度问题';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                if (window.location.hostname.indexOf("webgl2fundamentals.org") < 0) {
                    return;
                }
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>
</div>
</body>
<script>
const settings = {
  contribTemplate: "感谢 <a href=\"${html_url}\"><img src=\"${avatar_url}\"> ${login}</a><br>的 <a href=\"https://github.com/${owner}/${repo}/commits?author=${login}\">${contributions} 个贡献</a>",
  owner: "gfxfundamentals",
  repo: "webgl2-fundamentals",
};
</script>
<script src="/contributors.js"></script>
<script src="/3rdparty/jquery-1.11.2.min.js"></script>
<script src="/webgl/lessons/resources/prettify.js"></script>
<script src="/webgl/lessons/resources/lesson.js" type="module"></script>
<script>
</script>


</html>



