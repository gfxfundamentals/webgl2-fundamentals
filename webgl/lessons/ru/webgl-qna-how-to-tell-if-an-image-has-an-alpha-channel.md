Title: Как определить, есть ли у изображения альфа-канал
Description: Как определить, есть ли у изображения альфа-канал
TOC: Как определить, есть ли у изображения альфа-канал

## Вопрос:

Когда вы загружаете текстуру WebGL напрямую из DOM-изображения, как узнать, есть ли у изображения альфа-канал? Можно ли это определить, кроме как угадывать по имени файла (например, если есть .PNG — возможно RGBA, иначе RGB)? В DOM-изображении есть ширина и высота, но я не вижу ничего, что бы говорило о формате. Например:

        const img = await loadDOMImage(url);
        const format = gl.RGBA; //Это всегда должно быть RGBA? Я трачу память, если там только RGB
        const internalFormat = gl.RGBA;
        const type = gl.UNSIGNED_BYTE; //Это точно правильно? DOM не поддерживает HDR форматы?
  gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat, format, type, img); 

Моя функция загрузки выглядит так:

      async loadDOMImage(url) {
             return new Promise(
               (resolve, reject)=>{
                 const img = new Image(); 
                 img.crossOrigin = 'anonymous';
                 img.addEventListener('load', function() {
                   resolve(img);
                 }, false);
                 img.addEventListener('error', function(err) {
                   reject(err);
                 }, false);
                      
                 img.src = uri;
        
               }
             );
           }





## Ответ:

> как узнать, есть ли у изображения альфа-канал?

Никак. Можно только догадываться.

1. Можно посмотреть, заканчивается ли URL на .png, и предположить, что там есть альфа. Можно ошибиться.

2. Можно нарисовать изображение в 2D canvas, затем вызвать getImageData, прочитать все альфа-значения и посмотреть, есть ли среди них не 255.

>  ```
>  const format = gl.RGBA; 
>  ```
> Это всегда должно быть RGBA? Я трачу память, если там только RGB

Скорее всего, память не тратится зря. Большинство GPU лучше работают с RGBA, так что даже если вы выберете RGB, это вряд ли сэкономит память.

> ```
> const type = gl.UNSIGNED_BYTE; 
> ```
> Это точно правильно?

`texImage2D` берёт изображение, которое вы передаёте, и конвертирует его в `type` и `format`. Затем эти данные передаются на GPU.

>  DOM не поддерживает HDR форматы?

Это не определено и зависит от браузера. Мне не известны HDR форматы, поддерживаемые браузерами. Какие форматы поддерживает браузер — решает сам браузер.

---

Частый вопрос: нужно ли включать смешивание/прозрачность для конкретной текстуры. Некоторые ошибочно думают, что если у текстуры есть альфа, то надо, иначе — нет. Это неверно. Нужно ли использовать смешивание/прозрачность — это отдельный вопрос, не связанный с форматом изображения, и это нужно хранить отдельно.

То же самое касается других вещей, связанных с изображениями. В каком формате загружать изображение в GPU — это зависит от приложения и задачи, и не связано с форматом самого файла изображения.


<div class="so">
  <div>Вопрос и процитированные части являются 
    CC BY-SA 4.0 от
    <a data-href="https://stackoverflow.com/users/1106528">griffin2000</a>
    из
    <a data-href="https://stackoverflow.com/questions/58702384">здесь</a>
  </div>
</div> 