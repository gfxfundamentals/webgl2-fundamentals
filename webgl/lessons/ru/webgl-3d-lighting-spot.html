<!DOCTYPE html>
<!-- this file is auto-generated from webgl/lessons/ru/webgl-3d-lighting-spot.md. Do not edited directly -->
<!--
Copyright 2021, GFXFundamentals.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

*   Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.

*   Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the following disclaimer
    in the documentation and/or other materials provided with the
    distribution.

*   Neither the name of GFXFundamentals. nor the names of his
    contributors may be used to endorse or promote products derived from
    this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Как реализовать прожекторное освещение в WebGL">
<meta name="keywords" content="webgl webgl2 graphics">
<meta name="thumbnail" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-3d-lighting-spot_ru.jpg">

<meta property="og:title" content="WebGL2 3D - Прожекторное освещение">
<meta property="og:type" content="website">
<meta property="og:image" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-3d-lighting-spot_ru.jpg">
<meta property="og:description" content="Как реализовать прожекторное освещение в WebGL">
<meta property="og:url" content="https://webgl2fundamentals.org/webgl/lessons/ru/webgl-3d-lighting-spot.html">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@greggman">
<meta name="twitter:creator" content="@greggman">
<meta name="twitter:domain" content="webgl2fundamentals.org">
<meta name="twitter:title" content="WebGL2 3D - Прожекторное освещение">
<meta name="twitter:url" content="https://webgl2fundamentals.org/webgl/lessons/ru/webgl-3d-lighting-spot.html">
<meta name="twitter:description" content="Как реализовать прожекторное освещение в WebGL">
<meta name="twitter:image:src" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-3d-lighting-spot_ru.jpg">

<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@graph":[
    {
      "@type":"WebSite",
      "@id":"https://webgl2fundamentals.org/#website",
      "url":"https://webgl2fundamentals.org/",
      "name":"Webgl2Fundamentals"
    },
    {
      "@type":"ImageObject",
      "@id":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-3d-lighting-spot.html#primaryimage",
      "url":"https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-3d-lighting-spot_ru.jpg",
      "width":1200,
      "height":630
    },
    {
      "@type":"WebPage",
      "@id":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-3d-lighting-spot.html#webpage",
      "url":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-3d-lighting-spot.html",
      "inLanguage":"ru",
      "name":"WebGL2 3D - Прожекторное освещение",
      "keywords":"webgl webgl2 graphics programming",
      "isPartOf":{
        "@id":"https://webgl2fundamentals.org/#website"
      },
      "primaryImageOfPage":{
        "@id":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-3d-lighting-spot.html#primaryimage"
      }
    }
  ]
}
</script>


<title>WebGL2 3D - Прожекторное освещение</title>
<link href="/webgl/lessons/resources/webgl2fundamentals-icon.png" rel="shortcut icon" type="image/png">
<link rel="stylesheet" href="/webgl/lessons/lang.css">
<link rel="stylesheet" href="/webgl/lessons/resources/lesson.css">

  <link rel="alternate" hreflang="en" href="https://webglfundamentals.org/webgl/lessons/webgl-3d-lighting-spot.html">
  <link rel="alternate" hreflang="de" href="https://webglfundamentals.org/webgl/lessons/de/webgl-3d-lighting-spot.html">
  <link rel="alternate" hreflang="ja" href="https://webglfundamentals.org/webgl/lessons/ja/webgl-3d-lighting-spot.html">
  <link rel="alternate" hreflang="ko" href="https://webglfundamentals.org/webgl/lessons/ko/webgl-3d-lighting-spot.html">
  <link rel="alternate" hreflang="pt-br" href="https://webglfundamentals.org/webgl/lessons/pt-br/webgl-3d-lighting-spot.html">
  <link rel="alternate" hreflang="ru" href="https://webglfundamentals.org/webgl/lessons/ru/webgl-3d-lighting-spot.html">
  <link rel="alternate" hreflang="zh_cn" href="https://webglfundamentals.org/webgl/lessons/zh_cn/webgl-3d-lighting-spot.html">




</head>
<body>
<div class="webgl_navbar">
  <div>
    <select class="language">
    <option value="/webgl/lessons/webgl-3d-lighting-spot.html" >English</a>
    <option value="/webgl/lessons/de/webgl-3d-lighting-spot.html" >Deutsch</a>
    <option value="/webgl/lessons/ja/webgl-3d-lighting-spot.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-3d-lighting-spot.html" >한국어</a>
    <option value="/webgl/lessons/pt-br/webgl-3d-lighting-spot.html" >Português Brasileiro</a>
    <option value="/webgl/lessons/ru/webgl-3d-lighting-spot.html" selected>Русский</a>
    <option value="/webgl/lessons/zh_cn/webgl-3d-lighting-spot.html" >简体中文</a>
</select>


    <a href="#toc">Содержание</a>
    <input type="search" placeholder="?" id="search">
  </div>
</div>
<div class="webgl_header">
  <h1><a href="/webgl/lessons/ru/">WebGL2Fundamentals.org</a></h1>
<style>
#forkongithub>div {
    background: #000;
    color: #fff;
    font-family: arial,sans-serif;
    text-align: center;
    font-weight: bold;
    padding: 5px 40px;
    font-size: 0.9rem;
    line-height: 1.3rem;
    position: relative;
    transition: 0.5s;
    display: block;
    width: 400px;
    position: absolute;
    top: 0;
    right: 0;
    transform: translateX(200px) rotate(45deg) translate(10px,70px);
    box-shadow: 4px 4px 10px rgba(0,0,0,0.8);
    pointer-events: auto;
}
#forkongithub a {
  text-decoration: none;
  color: #fff;
}
#forkongithub>div:hover {
    background: #c11;
    color: #fff;
}
#forkongithub .contributors {
  font-size: 0.75rem;
  background: rgba(255,255,255,0.2);
  line-height: 1.2;
  padding: 0.1em;
}
#forkongithub>div::before,#forkongithub>div::after {
    content: "";
    width: 100%;
    display: block;
    position: absolute;
    top: 1px;
    left: 0;
    height: 1px;
    background: #fff;
}
#forkongithub>div::after {
    bottom: 1px;
    top: auto;
}

#forkongithub{
    z-index: 9999;
    /* needed for firefox */
    overflow: hidden;
    width: 300px;
    height: 300px;
    position: absolute;
    right: 0;
    top: 0;
    pointer-events: none;
}
#forkongithub svg{
  width: 1em;
  height: 1em;
  vertical-align: middle;
}
#forkongithub img {
  width: 1em;
  height: 1em;
  border-radius: 100%;
  vertical-align: middle;
}

@media (max-width: 900px) {
    #forkongithub>div {
        line-height: 1.2rem;
    }
}
@media (max-width: 700px) {
  #forkongithub {
    display: none;
  }
}
@media (max-width: 410px) {
    #forkongithub>div {
        font-size: 0.7rem;
        transform: translateX(150px) rotate(45deg) translate(20px,40px);
    }
}

</style>
<div id="forkongithub"><div><div><a href="https://github.com/gfxfundamentals/webgl2-fundamentals">Fix, Fork, Contribute <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 136 133" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(3.92891,0,0,3.92891,67.867,129.125)">
        <path d="M0,-31.904C-8.995,-31.904 -16.288,-24.611 -16.288,-15.614C-16.288,-8.417 -11.621,-2.312 -5.148,-0.157C-4.333,-0.008 -4.036,-0.511 -4.036,-0.943C-4.036,-1.329 -4.05,-2.354 -4.058,-3.713C-8.589,-2.729 -9.545,-5.897 -9.545,-5.897C-10.286,-7.779 -11.354,-8.28 -11.354,-8.28C-12.833,-9.29 -11.242,-9.27 -11.242,-9.27C-9.607,-9.155 -8.747,-7.591 -8.747,-7.591C-7.294,-5.102 -4.934,-5.821 -4.006,-6.238C-3.858,-7.29 -3.438,-8.008 -2.972,-8.415C-6.589,-8.826 -10.392,-10.224 -10.392,-16.466C-10.392,-18.244 -9.757,-19.698 -8.715,-20.837C-8.883,-21.249 -9.442,-22.905 -8.556,-25.148C-8.556,-25.148 -7.188,-25.586 -4.076,-23.478C-2.777,-23.84 -1.383,-24.02 0.002,-24.026C1.385,-24.02 2.779,-23.84 4.08,-23.478C7.19,-25.586 8.555,-25.148 8.555,-25.148C9.444,-22.905 8.885,-21.249 8.717,-20.837C9.761,-19.698 10.392,-18.244 10.392,-16.466C10.392,-10.208 6.583,-8.831 2.954,-8.428C3.539,-7.925 4.06,-6.931 4.06,-5.411C4.06,-3.234 4.04,-1.477 4.04,-0.943C4.04,-0.507 4.333,0 5.16,-0.159C11.628,-2.318 16.291,-8.419 16.291,-15.614C16.291,-24.611 8.997,-31.904 0,-31.904" style="fill:white;"/>
    </g>
</svg>
</a></div></div></div>

</div>


<div class="container">
  <div class="lesson-title">
    <h1>WebGL2 3D - Прожекторное освещение</h1>
  </div>
  <div class="lesson">
    <div class="lesson-main">
      <p>Эта статья является продолжением <a href="webgl-3d-lighting-point.html">WebGL 3D Точечное освещение</a>. Если вы не читали это, я предлагаю <a href="webgl-3d-lighting-point.html">начать там</a>.</p>
<p>В последней статье мы рассмотрели точечное освещение, где для каждой точки
на поверхности нашего объекта мы вычисляем направление от света
к этой точке на поверхности. Затем мы делаем то же самое, что делали для
<a href="webgl-3d-lighting-directional.html">направленного освещения</a>, что
мы взяли скалярное произведение нормали поверхности (направление, в котором обращена поверхность)
и направления света. Это дало нам значение
1, если два направления совпадали и поэтому должны быть полностью освещены. 0, если
два направления были перпендикулярны, и -1, если они были противоположны.
Мы использовали это значение напрямую для умножения цвета поверхности,
что дало нам освещение.</p>
<p>Прожекторное освещение - это только очень небольшое изменение. На самом деле, если вы думаете
творчески о том, что мы сделали до сих пор, вы могли бы
вывести собственное решение.</p>
<p>Вы можете представить точечный свет как точку со светом, идущим во всех
направлениях от этой точки.
Чтобы сделать прожектор, все, что нам нужно сделать, это выбрать направление от
этой точки, это направление нашего прожектора. Затем, для каждого
направления, в котором идет свет, мы могли бы взять скалярное произведение
этого направления с нашим выбранным направлением прожектора. Мы бы выбрали какой-то произвольный
предел и решили, если мы в пределах этого предела, мы освещаем. Если мы не в пределах
предела, мы не освещаем.</p>
<p><div class="webgl_diagram_container">
  <iframe class="webgl_example noborder" style="width: 500px; height: 400px;" src="/webgl/lessons/resources/spot-lighting.html"></iframe>
</div>

</p>
<p>В диаграмме выше мы можем видеть свет с лучами, идущими во всех направлениях, и
напечатанными на них их скалярными произведениями относительно направления.
Затем у нас есть конкретное <strong>направление</strong>, которое является направлением прожектора.
Мы выбираем предел (выше он в градусах). Из предела мы вычисляем <em>dot limit</em>, мы просто берем косинус предела. Если скалярное произведение нашего выбранного направления прожектора к
направлению каждого луча света выше dot limit, то мы делаем освещение. Иначе нет освещения.</p>
<p>Чтобы сказать это по-другому, скажем, предел составляет 20 градусов. Мы можем преобразовать
это в радианы и от этого к значению от -1 до 1, взяв косинус. Давайте назовем это dot space.
Другими словами, вот небольшая таблица для значений предела</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">          пределы в
 градусах | радианах | dot space
 --------+---------+----------
    0    |   0.0   |    1.0
    22   |    .38  |     .93
    45   |    .79  |     .71
    67   |   1.17  |     .39
    90   |   1.57  |    0.0
   180   |   3.14  |   -1.0
</code></pre>
<p>Затем мы можем просто проверить</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">dotFromDirection = dot(surfaceToLight, -lightDirection)
if (dotFromDirection &gt;= limitInDotSpace) {
   // делаем освещение
}
</code></pre>
<p>Давайте сделаем это</p>
<p>Сначала давайте изменим наш фрагментный шейдер из
<a href="webgl-3d-lighting-point.html">последней статьи</a>.</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-glsl">#version 300 es
precision highp float;

// Переданный из вершинного шейдера.
in vec3 v_normal;
in vec3 v_surfaceToLight;
in vec3 v_surfaceToView;

uniform vec4 u_color;
uniform float u_shininess;
+uniform vec3 u_lightDirection;
+uniform float u_limit;          // в dot space

// нам нужно объявить выход для фрагментного шейдера
out vec4 outColor;

void main() {
  // потому что v_normal - это varying, он интерполируется
  // поэтому он не будет единичным вектором. Нормализация его
  // сделает его снова единичным вектором
  vec3 normal = normalize(v_normal);

  vec3 surfaceToLightDirection = normalize(v_surfaceToLight);
  vec3 surfaceToViewDirection = normalize(v_surfaceToView);
  vec3 halfVector = normalize(surfaceToLightDirection + surfaceToViewDirection);

-  float light = dot(normal, surfaceToLightDirection);
+  float light = 0.0;
  float specular = 0.0;

+  float dotFromDirection = dot(surfaceToLightDirection,
+                               -u_lightDirection);
+  if (dotFromDirection &gt;= u_limit) {
*    light = dot(normal, surfaceToLightDirection);
*    if (light &gt; 0.0) {
*      specular = pow(dot(normal, halfVector), u_shininess);
*    }
+  }

  outColor = u_color;

  // Давайте умножим только цветовую часть (не альфа)
  // на свет
  outColor.rgb *= light;

  // Просто добавляем блик
  outColor.rgb += specular;
}
</code></pre>
<p>Конечно, нам нужно найти местоположения uniform переменных, которые мы
только что добавили.</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">  var lightDirection = [?, ?, ?];
  var limit = degToRad(20);

  ...

  var lightDirectionLocation = gl.getUniformLocation(program, &quot;u_lightDirection&quot;);
  var limitLocation = gl.getUniformLocation(program, &quot;u_limit&quot;);
</code></pre>
<p>и нам нужно их установить</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">    gl.uniform3fv(lightDirectionLocation, lightDirection);
    gl.uniform1f(limitLocation, Math.cos(limit));
</code></pre>
<p>И вот это</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-3d-lighting-spot.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-3d-lighting-spot.html" target="_blank">Нажмите, чтобы открыть в новом окне</a>
</div>

</p>
<p>Несколько вещей для заметки: Одна в том, что мы отрицаем <code class="notranslate" translate="no">u_lightDirection</code> выше.
Это <a href="https://en.wiktionary.org/wiki/six_of_one,_half_a_dozen_of_the_other"><em>шесть одного, полдюжины другого</em></a>
тип вещи. Мы хотим, чтобы 2 направления, которые мы сравниваем, указывали в
том же направлении, когда они совпадают. Это означает, что нам нужно сравнить
surfaceToLightDirection с противоположным направлением прожектора.
Мы могли бы сделать это многими разными способами. Мы могли бы передать отрицательное
направление при установке uniform. Это был бы мой 1-й выбор,
но я думал, что будет менее запутанно назвать uniform <code class="notranslate" translate="no">u_lightDirection</code> вместо <code class="notranslate" translate="no">u_reverseLightDirection</code> или <code class="notranslate" translate="no">u_negativeLightDirection</code></p>
<p>Другая вещь, и, возможно, это просто личное предпочтение, я не
люблю использовать условные операторы в шейдерах, если возможно. Я думаю, причина
в том, что раньше шейдеры на самом деле не имели условных операторов. Если вы добавляли
условный оператор, компилятор шейдера расширял код множеством
умножений на 0 и 1 здесь и там, чтобы сделать так, чтобы не было
никаких фактических условных операторов в коде. Это означало, что добавление условных операторов
могло заставить ваш код взорваться в комбинаторные расширения. Я не
уверен, что это все еще правда, но давайте избавимся от условных операторов в любом случае,
просто чтобы показать некоторые техники. Вы можете сами решить, использовать их или нет.</p>
<p>Есть функция GLSL, называемая <code class="notranslate" translate="no">step</code>. Она принимает 2 значения, и если
второе значение больше или равно первому, она возвращает 1.0. Иначе она возвращает 0. Вы могли бы написать это так в JavaScript</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">function step(a, b) {
   if (b &gt;= a) {
       return 1;
   } else {
       return 0;
   }
}
</code></pre>
<p>Давайте используем <code class="notranslate" translate="no">step</code>, чтобы избавиться от условий</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-glsl">  float dotFromDirection = dot(surfaceToLightDirection,
                               -u_lightDirection);
  // inLight будет 1, если мы внутри прожектора, и 0, если нет
  float inLight = step(u_limit, dotFromDirection);
  float light = inLight * dot(normal, surfaceToLightDirection);
  float specular = inLight * pow(dot(normal, halfVector), u_shininess);
</code></pre>
<p>Ничего не меняется визуально, но вот это</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-3d-lighting-spot-using-step.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-3d-lighting-spot-using-step.html" target="_blank">Нажмите, чтобы открыть в новом окне</a>
</div>

</p>
<p>Еще одна вещь в том, что сейчас прожектор очень резкий. Мы
либо внутри прожектора, либо нет, и вещи просто становятся черными.</p>
<p>Чтобы исправить это, мы могли бы использовать 2 предела вместо одного,
внутренний предел и внешний предел.
Если мы внутри внутреннего предела, то используем 1.0. Если мы снаружи внешнего
предела, то используем 0.0. Если мы между внутренним пределом и внешним пределом,
то интерполируем между 1.0 и 0.0.</p>
<p>Вот один способ, как мы могли бы сделать это</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-glsl">-uniform float u_limit;          // в dot space
+uniform float u_innerLimit;     // в dot space
+uniform float u_outerLimit;     // в dot space

...

  float dotFromDirection = dot(surfaceToLightDirection,
                               -u_lightDirection);
-  float inLight = step(u_limit, dotFromDirection);
+  float limitRange = u_innerLimit - u_outerLimit;
+  float inLight = clamp((dotFromDirection - u_outerLimit) / limitRange, 0.0, 1.0);
  float light = inLight * dot(normal, surfaceToLightDirection);
  float specular = inLight * pow(dot(normal, halfVector), u_shininess);

</code></pre>
<p>И это работает</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-3d-lighting-spot-falloff.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-3d-lighting-spot-falloff.html" target="_blank">Нажмите, чтобы открыть в новом окне</a>
</div>

</p>
<p>Теперь мы получаем что-то, что выглядит больше как прожектор!</p>
<p>Одна вещь, о которой нужно знать, это если <code class="notranslate" translate="no">u_innerLimit</code> равен <code class="notranslate" translate="no">u_outerLimit</code>,
то <code class="notranslate" translate="no">limitRange</code> будет 0.0. Мы делим на <code class="notranslate" translate="no">limitRange</code>, и деление на
ноль плохо/не определено. Здесь нечего делать в шейдере, нам просто
нужно убедиться в нашем JavaScript, что <code class="notranslate" translate="no">u_innerLimit</code> никогда не равен
<code class="notranslate" translate="no">u_outerLimit</code>. (примечание: пример кода этого не делает).</p>
<p>GLSL также имеет функцию, которую мы могли бы использовать для небольшого упрощения этого. Она
называется <code class="notranslate" translate="no">smoothstep</code>, и как <code class="notranslate" translate="no">step</code> она возвращает значение от 0 до 1, но
она принимает как нижнюю, так и верхнюю границу и интерполирует между 0 и 1 между
этими границами.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no"> smoothstep(lowerBound, upperBound, value)
</code></pre>
<p>Давайте сделаем это</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-glsl">  float dotFromDirection = dot(surfaceToLightDirection,
                               -u_lightDirection);
-  float limitRange = u_innerLimit - u_outerLimit;
-  float inLight = clamp((dotFromDirection - u_outerLimit) / limitRange, 0.0, 1.0);
  float inLight = smoothstep(u_outerLimit, u_innerLimit, dotFromDirection);
  float light = inLight * dot(normal, surfaceToLightDirection);
  float specular = inLight * pow(dot(normal, halfVector), u_shininess);
</code></pre>
<p>Это тоже работает</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-3d-lighting-spot-falloff-using-smoothstep.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-3d-lighting-spot-falloff-using-smoothstep.html" target="_blank">Нажмите, чтобы открыть в новом окне</a>
</div>

</p>
<p>Разница в том, что <code class="notranslate" translate="no">smoothstep</code> использует интерполяцию Эрмита вместо
линейной интерполяции. Это означает, что между <code class="notranslate" translate="no">lowerBound</code> и <code class="notranslate" translate="no">upperBound</code>
она интерполирует, как изображение ниже справа, тогда как линейная интерполяция, как изображение слева.</p>
<img class="webgl_center invertdark" src="../resources/linear-vs-hermite.png" />
<p>Вам решать, имеет ли значение разница.</p>
<p>Еще одна вещь, о которой нужно знать, это то, что функция <code class="notranslate" translate="no">smoothstep</code> имеет неопределенные
результаты, если <code class="notranslate" translate="no">lowerBound</code> больше или равен <code class="notranslate" translate="no">upperBound</code>. Иметь
их равными - это та же проблема, что у нас была выше. Добавленная проблема не быть
определенным, если <code class="notranslate" translate="no">lowerBound</code> больше <code class="notranslate" translate="no">upperBound</code>, новая, но для
цели прожектора это никогда не должно быть правдой.</p>
<div class="webgl_bottombar">
<h3>Будьте осторожны с неопределенным поведением в GLSL</h3>
<p>
Несколько функций в GLSL не определены для определенных значений.
Попытка возвести отрицательное число в степень с помощью <code class="notranslate" translate="no">pow</code> - это один
пример, поскольку результат был бы мнимым числом. Мы рассмотрели
другой пример выше с <code class="notranslate" translate="no">smoothstep</code>.</p>
<p>
Вам нужно попытаться быть в курсе этих или иначе ваши шейдеры будут
получать разные результаты на разных машинах. <a href="https://www.khronos.org/registry/OpenGL/specs/es/3.0/GLSL_ES_Specification_3.00.pdf">Спецификация, в разделе
8</a> перечисляет все встроенные функции, что они делают, и есть ли
какое-либо неопределенное поведение.</p>
<p>Вот список неопределенных поведений. Обратите внимание, <code class="notranslate" translate="no">genType</code> означает <code class="notranslate" translate="no">float</code>, <code class="notranslate" translate="no">vec2</code>, <code class="notranslate" translate="no">vec3</code> или <code class="notranslate" translate="no">vec4</code>.</p>
  <pre class="prettyprint"><code class="notranslate" translate="no">genType asin (genType x)</code></pre><p>Арксинус. Возвращает угол, синус которого равен x. Диапазон
значений, возвращаемых этой функцией, [−π/2, π/2]
Результаты не определены, если ∣x∣ > 1.</p>
<pre class="prettyprint"><code class="notranslate" translate="no">genType acos (genType x)</code></pre><p>Арккосинус. Возвращает угол, косинус которого равен x. Диапазон
<p>значений, возвращаемых этой функцией, [0, π].
Результаты не определены, если ∣x∣ &gt; 1.</p></p>
<pre class="prettyprint"><code class="notranslate" translate="no">genType atan (genType y, genType x)</code></pre><p>Арктангенс. Возвращает угол, тангенс которого равен y/x. Знаки
<p>x и y используются для определения того, в каком квадранте находится
угол. Диапазон значений, возвращаемых этой
функцией, [−π,π]. Результаты не определены, если x и y
оба равны 0.</p></p>
<pre class="prettyprint"><code class="notranslate" translate="no">genType acosh (genType x)</code></pre><p>Аркгиперболический косинус; возвращает неотрицательный обратный
<p>к cosh. Результаты не определены, если x &lt; 1.</p></p>
<pre class="prettyprint"><code class="notranslate" translate="no">genType atanh (genType x)</code></pre><p>Аркгиперболический тангенс; возвращает обратный к tanh.
<p>Результаты не определены, если ∣x∣≥1.</p></p>
<pre class="prettyprint"><code class="notranslate" translate="no">genType pow (genType x, genType y)</code></pre><p>Возвращает x, возведенный в степень y, т.е. x<sup>y</sup>.
<p>Результаты не определены, если x &lt; 0.
Результаты не определены, если x = 0 и y &lt;= 0.</p></p>
<pre class="prettyprint"><code class="notranslate" translate="no">genType log (genType x)</code></pre><p>Возвращает натуральный логарифм x, т.е. возвращает значение
<p>y, которое удовлетворяет уравнению x = e<sup>y</sup>.
Результаты не определены, если x &lt;= 0.</p></p>
<pre class="prettyprint"><code class="notranslate" translate="no">genType log2 (genType x)</code></pre><p>Возвращает логарифм по основанию 2 от x, т.е. возвращает значение
<p>y, которое удовлетворяет уравнению x=2<sup>y</sup>.
Результаты не определены, если x &lt;= 0.</p></p>
<pre class="prettyprint"><code class="notranslate" translate="no">genType sqrt (genType x)</code></pre><p>Возвращает √x .
<p>Результаты не определены, если x &lt; 0.</p></p>
<pre class="prettyprint"><code class="notranslate" translate="no">genType inversesqrt (genType x)</code></pre><p>
<p>Возвращает 1/√x.
Результаты не определены, если x &lt;= 0.</p></p>
<pre class="prettyprint"><code class="notranslate" translate="no">genType clamp (genType x, genType minVal, genType maxVal)
genType clamp (genType x, float minVal, float maxVal)</code></pre><p>
<p>Возвращает min (max (x, minVal), maxVal).
Результаты не определены, если minVal &gt; maxVal</p></p>
<pre class="prettyprint"><code class="notranslate" translate="no">genType smoothstep (genType edge0, genType edge1, genType x)
genType smoothstep (float edge0, float edge1, genType x)</code></pre><p>
<p>Возвращает 0.0, если x &lt;= edge0, и 1.0, если x &gt;= edge1, и
выполняет плавную интерполяцию Эрмита между 0 и 1,
когда edge0 &lt; x &lt; edge1. Это полезно в случаях, когда
вы хотели бы пороговую функцию с плавным
переходом. Это эквивалентно:</p>
</p>
<pre class="prettyprint">
 genType t;
 t = clamp ((x – edge0) / (edge1 – edge0), 0, 1);
 return t * t * (3 – 2 * t);
</pre>
<p>Результаты не определены, если edge0 >= edge1.</p>
<pre class="prettyprint"><code class="notranslate" translate="no">mat2 inverse(mat2 m)
mat3 inverse(mat3 m)
mat4 inverse(mat4 m)</code></pre><p>
<p>Возвращает матрицу, которая является обратной к m. Входная
матрица m не изменяется. Значения в возвращенной
матрице не определены, если m сингулярна или плохо обусловлена
(почти сингулярна).</p></p>
</div>
    </div>
    <div class="lesson-sidebar">
        <select class="language">
    <option value="/webgl/lessons/webgl-3d-lighting-spot.html" >English</a>
    <option value="/webgl/lessons/de/webgl-3d-lighting-spot.html" >Deutsch</a>
    <option value="/webgl/lessons/ja/webgl-3d-lighting-spot.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-3d-lighting-spot.html" >한국어</a>
    <option value="/webgl/lessons/pt-br/webgl-3d-lighting-spot.html" >Português Brasileiro</a>
    <option value="/webgl/lessons/ru/webgl-3d-lighting-spot.html" selected>Русский</a>
    <option value="/webgl/lessons/zh_cn/webgl-3d-lighting-spot.html" >简体中文</a>
</select>


        <div id="toc">
          <ul>  <li>Основы</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-getting-webgl2.html">Как использовать WebGL2</a></li>
<li><a href="/webgl/lessons/ru/webgl-fundamentals.html">Основы</a></li>
<li><a href="/webgl/lessons/ru/webgl-how-it-works.html">Как это работает</a></li>
<li><a href="/webgl/lessons/ru/webgl-shaders-and-glsl.html">Шейдеры и GLSL</a></li>
<li><a href="/webgl/lessons/resources/webgl-state-diagram.html">WebGL2 Диаграмма состояния</a></li>
        </ul>
  <li>WebGL2 vs WebGL1</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl2-whats-new.html">Что нового в WebGL2</a></li>
<li><a href="/webgl/lessons/ru/webgl1-to-webgl2.html">Переход с WebGL1 на WebGL2</a></li>
<li><a href="/webgl/lessons/ru/webgl1-to-webgl2-fundamentals.html">Отличия от WebGLFundamentals.org до WebGL2Fundamentals.org</a></li>
        </ul>
  <li>Обработка изображений</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-image-processing.html">Обработка изображений</a></li>
<li><a href="/webgl/lessons/ru/webgl-image-processing-continued.html">Продвинутая обработка изображений</a></li>
        </ul>
  <li>2D трансформации, повороты, масштабирование и матричные операции</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-2d-translation.html">2D Трансляция</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-rotation.html">2D Вращение</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-scale.html">2D Масштабирование</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-matrices.html">2D Матрицы</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-orthographic.html">Ортографическая 3D</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-perspective.html">3D Перспектива</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-camera.html">3D - Камеры</a></li>
<li><a href="/webgl/lessons/ru/webgl-matrix-naming.html">3D - Именование матриц</a></li>
        </ul>
  <li>Освещение</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-lighting-directional.html">Направленное освещение</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-lighting-point.html">Точечное освещение</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-lighting-spot.html">Прожекторное освещение</a></li>
        </ul>
  <li>Организация и рефакторинг</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-less-code-more-fun.html">Меньше кода, больше удовольствия</a></li>
<li><a href="/webgl/lessons/ru/webgl-drawing-multiple-things.html">Рисование множественных объектов</a></li>
<li><a href="/webgl/lessons/ru/webgl-scene-graph.html">Графы сцен</a></li>
        </ul>
  <li>Геометрия</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-geometry-lathe.html">3D Геометрия - Токарная обработка</a></li>
<li><a href="/webgl/lessons/ru/webgl-load-obj.html">Загрузка .obj файлов</a></li>
<li><a href="/webgl/lessons/ru/webgl-load-obj-w-mtl.html">Загрузка .obj с .mtl файлами</a></li>
        </ul>
  <li>Текстуры</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-textures.html">Текстуры</a></li>
<li><a href="/webgl/lessons/ru/webgl-data-textures.html">Data Textures</a></li>
<li><a href="/webgl/lessons/ru/webgl-2-textures.html">Использование 2 или более текстур</a></li>
<li><a href="/webgl/lessons/ru/webgl-cors-permission.html">Cross Origin Images</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-perspective-correct-texturemapping.html">Перспективно-корректное наложение текстур</a></li>
<li><a href="/webgl/lessons/ru/webgl-planar-projection-mapping.html">Планарное и перспективное проекционное отображение</a></li>
        </ul>
  <li>Рендеринг в текстуру</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-render-to-texture.html">Рендеринг в текстуру</a></li>
        </ul>
  <li>Тени</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-shadows.html">Тени</a></li>
        </ul>
  <li>Техники</li>
        <ul>
            <li>2D</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-2d-drawimage.html">2D - DrawImage</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-matrix-stack.html">2D - Стек Матриц</a></li>
<li><a href="/webgl/lessons/ru/webgl-sprites.html">Спрайты</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-cube-maps.html">Кубические карты</a></li>
<li><a href="/webgl/lessons/ru/webgl-environment-maps.html">Карты окружения</a></li>
<li><a href="/webgl/lessons/ru/webgl-skybox.html">Скайбоксы</a></li>
<li><a href="/webgl/lessons/ru/webgl-skinning.html">Скининг</a></li>
<li><a href="/webgl/lessons/ru/webgl-fog.html">Fog</a></li>
<li><a href="/webgl/lessons/ru/webgl-picking.html">Пикинг (клик по объектам)</a></li>
        </ul>
  <li>Текст</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-text-html.html">Текст - HTML</a></li>
<li><a href="/webgl/lessons/ru/webgl-text-canvas2d.html">Текст - Canvas 2D</a></li>
<li><a href="/webgl/lessons/ru/webgl-text-texture.html">Текст - Использование текстуры</a></li>
<li><a href="/webgl/lessons/ru/webgl-text-glyphs.html">Текст - Использование текстуры глифов</a></li>
        </ul>
  <li>GPGPU</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-gpgpu.html">GPGPU</a></li>
        </ul>
        </ul>
  <li>Советы</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-smallest-programs.html">Самые маленькие программы</a></li>
<li><a href="/webgl/lessons/ru/webgl-drawing-without-data.html">Рисование без данных</a></li>
<li><a href="/webgl/lessons/ru/webgl-shadertoy.html">Shadertoy</a></li>
<li><a href="/webgl/lessons/ru/webgl-pulling-vertices.html">Вытягивание вершин</a></li>
        </ul>
  <li>Оптимизация</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-indexed-vertices.html">Индексированные вершины (gl.drawElements)</a></li>
<li><a href="/webgl/lessons/ru/webgl-instanced-drawing.html">Инстансинг (Instanced Drawing)</a></li>
        </ul>
  <li>Разное</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-setup-and-installation.html">Настройка и установка</a></li>
<li><a href="/webgl/lessons/ru/webgl-boilerplate.html">Boilerplate</a></li>
<li><a href="/webgl/lessons/ru/webgl-resizing-the-canvas.html">Изменение размера Canvas</a></li>
<li><a href="/webgl/lessons/ru/webgl-animation.html">Анимация</a></li>
<li><a href="/webgl/lessons/ru/webgl-points-lines-triangles.html">Точки, линии и треугольники</a></li>
<li><a href="/webgl/lessons/ru/webgl-multiple-views.html">Множественные виды, множественные canvas</a></li>
<li><a href="/webgl/lessons/ru/webgl-visualizing-the-camera.html">Визуализация камеры</a></li>
<li><a href="/webgl/lessons/ru/webgl-and-alpha.html">WebGL2 и альфа-канал</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-vs-3d-library.html">2D против 3D библиотек</a></li>
<li><a href="/webgl/lessons/ru/webgl-anti-patterns.html">Анти-паттерны</a></li>
<li><a href="/webgl/lessons/ru/webgl-matrix-vs-math.html">WebGL2 Матрицы против математических матриц</a></li>
<li><a href="/webgl/lessons/ru/webgl-precision-issues.html">Проблемы точности</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#screenshot">Скриншот канваса</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#preservedrawingbuffer">Как не очищать канвас</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#tabindex">Получение ввода с клавиатуры</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#html-background">WebGL2 как фон HTML</a></li>
<li><a href="/webgl/lessons/ru/webgl-cross-platform-issues.html">Cross Platform Issues</a></li>
<li><a href="/webgl/lessons/ru/webgl-qna.html">Вопросы и ответы</a></li>
        </ul>
  <li>Справочник</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-attributes.html">Атрибуты</a></li>
<li><a href="/webgl/lessons/ru/webgl-texture-units.html">Текстурные юниты</a></li>
<li><a href="/webgl/lessons/ru/webgl-framebuffers.html">Framebuffers</a></li>
<li><a href="/webgl/lessons/ru/webgl-readpixels.html">readPixels</a></li>
<li><a href="/webgl/lessons/ru/webgl-references.html">Ссылки</a></li>
        </ul></ul>
<ul>
  <li><a href="/docs/">API документация</a></li>
  <li><a href="https://twgljs.org">TWGL, легковесная библиотека-помощник для WebGL</a></li>
  <li><a href="https://github.com/gfxfundamentals/webgl2-fundamentals">GitHub</a></li>
</ul>
        </div>
    </div>
    <div class="lesson-comments">
        
<div>Есть предложения или замечания? <a href="https://github.com/gfxfundamentals/webgl2-fundamentals/issues">Создайте issue на GitHub</a>.</div>
  

        <div id="disqus_thread"></div>
        <script>
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'webgl2fundamentals'; // required: replace example with your forum shortname
            var disqus_identifier = 'WebGL2 3D - Прожекторное освещение';
            var disqus_title = 'WebGL2 3D - Прожекторное освещение';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                if (window.location.hostname.indexOf("webgl2fundamentals.org") < 0) {
                    return;
                }
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>
</div>
</body>
<script>
const settings = {
  contribTemplate: "Спасибо <a href=\"${html_url}\"><img src=\"${avatar_url}\"> ${login}</a><br>за <a href=\"https://github.com/${owner}/${repo}/commits?author=${login}\">${contributions} вкладов</a>",
  owner: "gfxfundamentals",
  repo: "webgl2-fundamentals",
};
</script>
<script src="/contributors.js"></script>
<script src="/3rdparty/jquery-1.11.2.min.js"></script>
<script src="/webgl/lessons/resources/prettify.js"></script>
<script src="/webgl/lessons/resources/lesson.js" type="module"></script>
<script>
</script>


</html>



