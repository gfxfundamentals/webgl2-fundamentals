<!DOCTYPE html>
<!-- this file is auto-generated from webgl/lessons/ru/webgl-environment-maps.md. Do not edited directly -->
<!--
Copyright 2021, GFXFundamentals.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

*   Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.

*   Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the following disclaimer
    in the documentation and/or other materials provided with the
    distribution.

*   Neither the name of GFXFundamentals. nor the names of his
    contributors may be used to endorse or promote products derived from
    this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Как реализовать карты окружения.">
<meta name="keywords" content="webgl webgl2 graphics">
<meta name="thumbnail" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-environment-maps_ru.jpg">

<meta property="og:title" content="WebGL2 Карты окружения (отражения)">
<meta property="og:type" content="website">
<meta property="og:image" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-environment-maps_ru.jpg">
<meta property="og:description" content="Как реализовать карты окружения.">
<meta property="og:url" content="https://webgl2fundamentals.org/webgl/lessons/ru/webgl-environment-maps.html">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@greggman">
<meta name="twitter:creator" content="@greggman">
<meta name="twitter:domain" content="webgl2fundamentals.org">
<meta name="twitter:title" content="WebGL2 Карты окружения (отражения)">
<meta name="twitter:url" content="https://webgl2fundamentals.org/webgl/lessons/ru/webgl-environment-maps.html">
<meta name="twitter:description" content="Как реализовать карты окружения.">
<meta name="twitter:image:src" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-environment-maps_ru.jpg">

<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@graph":[
    {
      "@type":"WebSite",
      "@id":"https://webgl2fundamentals.org/#website",
      "url":"https://webgl2fundamentals.org/",
      "name":"Webgl2Fundamentals"
    },
    {
      "@type":"ImageObject",
      "@id":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-environment-maps.html#primaryimage",
      "url":"https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-environment-maps_ru.jpg",
      "width":1200,
      "height":630
    },
    {
      "@type":"WebPage",
      "@id":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-environment-maps.html#webpage",
      "url":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-environment-maps.html",
      "inLanguage":"ru",
      "name":"WebGL2 Карты окружения (отражения)",
      "keywords":"webgl webgl2 graphics programming",
      "isPartOf":{
        "@id":"https://webgl2fundamentals.org/#website"
      },
      "primaryImageOfPage":{
        "@id":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-environment-maps.html#primaryimage"
      }
    }
  ]
}
</script>


<title>WebGL2 Карты окружения (отражения)</title>
<link href="/webgl/lessons/resources/webgl2fundamentals-icon.png" rel="shortcut icon" type="image/png">
<link rel="stylesheet" href="/webgl/lessons/lang.css">
<link rel="stylesheet" href="/webgl/lessons/resources/lesson.css">

  <link rel="alternate" hreflang="en" href="https://webglfundamentals.org/webgl/lessons/webgl-environment-maps.html">
  <link rel="alternate" hreflang="de" href="https://webglfundamentals.org/webgl/lessons/de/webgl-environment-maps.html">
  <link rel="alternate" hreflang="ja" href="https://webglfundamentals.org/webgl/lessons/ja/webgl-environment-maps.html">
  <link rel="alternate" hreflang="ko" href="https://webglfundamentals.org/webgl/lessons/ko/webgl-environment-maps.html">
  <link rel="alternate" hreflang="pt-br" href="https://webglfundamentals.org/webgl/lessons/pt-br/webgl-environment-maps.html">
  <link rel="alternate" hreflang="ru" href="https://webglfundamentals.org/webgl/lessons/ru/webgl-environment-maps.html">
  <link rel="alternate" hreflang="zh_cn" href="https://webglfundamentals.org/webgl/lessons/zh_cn/webgl-environment-maps.html">




</head>
<body>
<div class="webgl_navbar">
  <div>
    <select class="language">
    <option value="/webgl/lessons/webgl-environment-maps.html" >English</a>
    <option value="/webgl/lessons/de/webgl-environment-maps.html" >Deutsch</a>
    <option value="/webgl/lessons/ja/webgl-environment-maps.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-environment-maps.html" >한국어</a>
    <option value="/webgl/lessons/pt-br/webgl-environment-maps.html" >Português Brasileiro</a>
    <option value="/webgl/lessons/ru/webgl-environment-maps.html" selected>Русский</a>
    <option value="/webgl/lessons/zh_cn/webgl-environment-maps.html" >简体中文</a>
</select>


    <a href="#toc">Содержание</a>
    <input type="search" placeholder="?" id="search">
  </div>
</div>
<div class="webgl_header">
  <h1><a href="/webgl/lessons/ru/">WebGL2Fundamentals.org</a></h1>
<style>
#forkongithub>div {
    background: #000;
    color: #fff;
    font-family: arial,sans-serif;
    text-align: center;
    font-weight: bold;
    padding: 5px 40px;
    font-size: 0.9rem;
    line-height: 1.3rem;
    position: relative;
    transition: 0.5s;
    display: block;
    width: 400px;
    position: absolute;
    top: 0;
    right: 0;
    transform: translateX(200px) rotate(45deg) translate(10px,70px);
    box-shadow: 4px 4px 10px rgba(0,0,0,0.8);
    pointer-events: auto;
}
#forkongithub a {
  text-decoration: none;
  color: #fff;
}
#forkongithub>div:hover {
    background: #c11;
    color: #fff;
}
#forkongithub .contributors {
  font-size: 0.75rem;
  background: rgba(255,255,255,0.2);
  line-height: 1.2;
  padding: 0.1em;
}
#forkongithub>div::before,#forkongithub>div::after {
    content: "";
    width: 100%;
    display: block;
    position: absolute;
    top: 1px;
    left: 0;
    height: 1px;
    background: #fff;
}
#forkongithub>div::after {
    bottom: 1px;
    top: auto;
}

#forkongithub{
    z-index: 9999;
    /* needed for firefox */
    overflow: hidden;
    width: 300px;
    height: 300px;
    position: absolute;
    right: 0;
    top: 0;
    pointer-events: none;
}
#forkongithub svg{
  width: 1em;
  height: 1em;
  vertical-align: middle;
}
#forkongithub img {
  width: 1em;
  height: 1em;
  border-radius: 100%;
  vertical-align: middle;
}

@media (max-width: 900px) {
    #forkongithub>div {
        line-height: 1.2rem;
    }
}
@media (max-width: 700px) {
  #forkongithub {
    display: none;
  }
}
@media (max-width: 410px) {
    #forkongithub>div {
        font-size: 0.7rem;
        transform: translateX(150px) rotate(45deg) translate(20px,40px);
    }
}

</style>
<div id="forkongithub"><div><div><a href="https://github.com/gfxfundamentals/webgl2-fundamentals">Fix, Fork, Contribute <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 136 133" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(3.92891,0,0,3.92891,67.867,129.125)">
        <path d="M0,-31.904C-8.995,-31.904 -16.288,-24.611 -16.288,-15.614C-16.288,-8.417 -11.621,-2.312 -5.148,-0.157C-4.333,-0.008 -4.036,-0.511 -4.036,-0.943C-4.036,-1.329 -4.05,-2.354 -4.058,-3.713C-8.589,-2.729 -9.545,-5.897 -9.545,-5.897C-10.286,-7.779 -11.354,-8.28 -11.354,-8.28C-12.833,-9.29 -11.242,-9.27 -11.242,-9.27C-9.607,-9.155 -8.747,-7.591 -8.747,-7.591C-7.294,-5.102 -4.934,-5.821 -4.006,-6.238C-3.858,-7.29 -3.438,-8.008 -2.972,-8.415C-6.589,-8.826 -10.392,-10.224 -10.392,-16.466C-10.392,-18.244 -9.757,-19.698 -8.715,-20.837C-8.883,-21.249 -9.442,-22.905 -8.556,-25.148C-8.556,-25.148 -7.188,-25.586 -4.076,-23.478C-2.777,-23.84 -1.383,-24.02 0.002,-24.026C1.385,-24.02 2.779,-23.84 4.08,-23.478C7.19,-25.586 8.555,-25.148 8.555,-25.148C9.444,-22.905 8.885,-21.249 8.717,-20.837C9.761,-19.698 10.392,-18.244 10.392,-16.466C10.392,-10.208 6.583,-8.831 2.954,-8.428C3.539,-7.925 4.06,-6.931 4.06,-5.411C4.06,-3.234 4.04,-1.477 4.04,-0.943C4.04,-0.507 4.333,0 5.16,-0.159C11.628,-2.318 16.291,-8.419 16.291,-15.614C16.291,-24.611 8.997,-31.904 0,-31.904" style="fill:white;"/>
    </g>
</svg>
</a></div></div></div>

</div>


<div class="container">
  <div class="lesson-title">
    <h1>WebGL2 Карты окружения (отражения)</h1>
  </div>
  <div class="lesson">
    <div class="lesson-main">
      <p>Эта статья является частью серии статей о WebGL2.
<a href="webgl-fundamentals.html">Первая статья начинается с основ</a>.
Эта статья продолжается от <a href="webgl-cube-maps.html">статьи о кубических картах</a>.
Эта статья также использует концепции, рассмотренные в <a href="webgl-3d-lighting-directional.html">статье об освещении</a>.
Если вы еще не читали эти статьи, возможно, вы захотите прочитать их сначала.</p>
<p><em>Карта окружения</em> представляет окружение объектов, которые вы рисуете.
Если вы рисуете уличную сцену, она будет представлять улицу. Если
вы рисуете людей на сцене, она будет представлять место проведения. Если вы рисуете
космическую сцену, это будут звезды. Мы можем реализовать карту окружения
с кубической картой, если у нас есть 6 изображений, которые показывают окружение с точки в
пространстве в 6 направлениях кубической карты.</p>
<p>Вот карта окружения из лобби Музея истории компьютеров в Маунтин-Вью, Калифорния.</p>
<div class="webgl_center">
  <img src="../../resources/images/computer-history-museum/pos-x.jpg" style="width: 128px" class="border">
  <img src="../../resources/images/computer-history-museum/neg-x.jpg" style="width: 128px" class="border">
  <img src="../../resources/images/computer-history-museum/pos-y.jpg" style="width: 128px" class="border">
</div>
<div class="webgl_center">
  <img src="../../resources/images/computer-history-museum/neg-y.jpg" style="width: 128px" class="border">
  <img src="../../resources/images/computer-history-museum/pos-z.jpg" style="width: 128px" class="border">
  <img src="../../resources/images/computer-history-museum/neg-z.jpg" style="width: 128px" class="border">
</div>
<p>Основываясь на <a href="webgl-cube-maps.html">коде в предыдущей статье</a>, давайте загрузим эти 6 изображений вместо изображений, которые мы сгенерировали</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">// Создаем текстуру.
var texture = gl.createTexture();
gl.bindTexture(gl.TEXTURE_CUBE_MAP, texture);

const faceInfos = [
  {
    target: gl.TEXTURE_CUBE_MAP_POSITIVE_X,
    url: 'resources/images/computer-history-museum/pos-x.jpg',
  },
  {
    target: gl.TEXTURE_CUBE_MAP_NEGATIVE_X,
    url: 'resources/images/computer-history-museum/neg-x.jpg',
  },
  {
    target: gl.TEXTURE_CUBE_MAP_POSITIVE_Y,
    url: 'resources/images/computer-history-museum/pos-y.jpg',
  },
  {
    target: gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,
    url: 'resources/images/computer-history-museum/neg-y.jpg',
  },
  {
    target: gl.TEXTURE_CUBE_MAP_POSITIVE_Z,
    url: 'resources/images/computer-history-museum/pos-z.jpg',
  },
  {
    target: gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,
    url: 'resources/images/computer-history-museum/neg-z.jpg',
  },
];
faceInfos.forEach((faceInfo) =&gt; {
  const {target, url} = faceInfo;

  // Загружаем холст в грань кубической карты.
  const level = 0;
  const internalFormat = gl.RGBA;
  const width = 512;
  const height = 512;
  const format = gl.RGBA;
  const type = gl.UNSIGNED_BYTE;

  // настраиваем каждую грань так, чтобы она была сразу рендерируемой
  gl.texImage2D(target, level, internalFormat, width, height, 0, format, type, null);

  // Асинхронно загружаем изображение
  const image = new Image();
  image.src = url;
  image.addEventListener('load', function() {
    // Теперь, когда изображение загружено, загружаем его в текстуру.
    gl.bindTexture(gl.TEXTURE_CUBE_MAP, texture);
    gl.texImage2D(target, level, internalFormat, format, type, image);
    gl.generateMipmap(gl.TEXTURE_CUBE_MAP);
  });
});
gl.generateMipmap(gl.TEXTURE_CUBE_MAP);
gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);
</code></pre>
<p>Обратите внимание, что для каждой грани мы инициализируем ее 512x512 пустым изображением, передавая
<code class="notranslate" translate="no">null</code> в <code class="notranslate" translate="no">texImage2D</code>. Кубические карты должны иметь все 6 граней, все 6 граней должны быть
одинакового размера и быть квадратными. Если они не такие, текстура не будет рендериться. Но мы
загружаем 6 изображений. Мы хотели бы начать рендеринг сразу, поэтому мы выделяем все 6
граней, затем начинаем загружать изображения. Когда каждое изображение прибывает, мы загружаем его в
правильную грань, затем снова генерируем мипмап. Это означает, что мы можем начать рендеринг
сразу, и по мере загрузки изображений грани кубической карты будут
заполняться изображениями по одному и все еще будут рендерируемыми, даже если все 6
еще не прибыли.</p>
<p>Но просто загрузка изображений недостаточна. Как и в
<a href="webgl-3d-lighting-point.html">освещении</a>, нам нужна небольшая математика здесь.</p>
<p>В этом случае мы хотим знать для каждого фрагмента, который нужно нарисовать, учитывая вектор от
глаза/камеры к этой позиции на поверхности объекта, в каком направлении
он отразится от этой поверхности. Мы можем затем использовать это направление, чтобы получить
цвет из кубической карты.</p>
<p>Формула для отражения</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">reflectionDir = eyeToSurfaceDir –
    2 ∗ dot(surfaceNormal, eyeToSurfaceDir) ∗ surfaceNormal
</code></pre>
<p>Думая о том, что мы можем видеть, это правда. Напомним из <a href="webgl-3d-lighting-directional.html">статей об освещении</a>,
что скалярное произведение 2 векторов возвращает косинус угла между 2
векторами. Сложение векторов дает нам новый вектор, так что давайте возьмем пример глаза,
смотрящего прямо перпендикулярно плоской поверхности.</p>
<div class="webgl_center"><img src="../resources/reflect-180-01.svg" style="width: 400px"></div>
<p>Давайте визуализируем формулу выше. Сначала напомним, что скалярное произведение 2 векторов,
указывающих в точно противоположных направлениях, равно -1, так что визуально</p>
<div class="webgl_center"><img src="../resources/reflect-180-02.svg" style="width: 400px"></div>
<p>Подставляя это скалярное произведение с <span style="color:black; font-weight:bold;">eyeToSurfaceDir</span>
и <span style="color:green;">normal</span> в формулу отражения, мы получаем это</p>
<div class="webgl_center"><img src="../resources/reflect-180-03.svg" style="width: 400px"></div>
<p>Что умножение -2 на -1 делает его положительным 2.</p>
<div class="webgl_center"><img src="../resources/reflect-180-04.svg" style="width: 400px"></div>
<p>Так что сложение векторов путем их соединения дает нам <span style="color: red">отраженный вектор</span></p>
<div class="webgl_center"><img src="../resources/reflect-180-05.svg" style="width: 400px"></div>
<p>Мы можем видеть выше, что учитывая 2 нормали, одна полностью компенсирует направление от
глаза, а вторая указывает отражение прямо обратно к глазу.
Что, если мы вернем в исходную диаграмму, точно то, что мы ожидали бы</p>
<div class="webgl_center"><img src="../resources/reflect-180-06.svg" style="width: 400px"></div>
<p>Давайте повернем поверхность на 45 градусов вправо.</p>
<div class="webgl_center"><img src="../resources/reflect-45-01.svg" style="width: 400px"></div>
<p>Скалярное произведение 2 векторов на расстоянии 135 градусов равно -0.707</p>
<div class="webgl_center"><img src="../resources/reflect-45-02.svg" style="width: 400px"></div>
<p>Так что подставляя все в формулу</p>
<div class="webgl_center"><img src="../resources/reflect-45-03.svg" style="width: 400px"></div>
<p>Снова умножение 2 отрицательных дает нам положительное, но <span style="color: green">вектор</span> теперь примерно на 30% короче.</p>
<div class="webgl_center"><img src="../resources/reflect-45-04.svg" style="width: 400px"></div>
<p>Сложение векторов дает нам <span style="color: red">отраженный вектор</span></p>
<div class="webgl_center"><img src="../resources/reflect-45-05.svg" style="width: 400px"></div>
<p>Что, если мы вернем в исходную диаграмму, кажется правильным.</p>
<div class="webgl_center"><img src="../resources/reflect-45-06.svg" style="width: 400px"></div>
<p>Мы используем это <span style="color: red">отраженное направление</span>, чтобы посмотреть на кубическую карту для окрашивания поверхности объекта.</p>
<p>Вот диаграмма, где вы можете установить вращение поверхности и увидеть
различные части уравнения. Вы также можете увидеть, как векторы отражения указывают на
различные грани кубической карты и влияют на цвет поверхности.</p>
<p><div class="webgl_diagram_container">
  <iframe class="webgl_example " style="width: 400px; height: 400px;" src="/webgl/lessons/resources/environment-mapping.html"></iframe>
</div>

</p>
<p>Теперь, когда мы знаем, как работает отражение, и что мы можем использовать его для поиска значений
из кубической карты, давайте изменим шейдеры, чтобы делать это.</p>
<p>Сначала в вершинном шейдере мы вычислим мировую позицию и мировую ориентированную
нормаль вершин и передадим их в фрагментный шейдер как varying. Это
похоже на то, что мы делали в <a href="webgl-3d-lighting-spot.html">статье о прожекторах</a>.</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-glsl">#version 300 es

in vec4 a_position;
in vec3 a_normal;

uniform mat4 u_projection;
uniform mat4 u_view;
uniform mat4 u_world;

out vec3 v_worldPosition;
out vec3 v_worldNormal;

void main() {
  // Умножаем позицию на матрицу.
  gl_Position = u_projection * u_view * u_world * a_position;

  // передаем позицию вида в фрагментный шейдер
  v_worldPosition = (u_world * a_position).xyz;

  // ориентируем нормали и передаем в фрагментный шейдер
  v_worldNormal = mat3(u_world) * a_normal;
}
</code></pre>
<p>Затем в фрагментном шейдере мы нормализуем <code class="notranslate" translate="no">worldNormal</code>, поскольку он
интерполируется по поверхности между вершинами. Мы передаем мировую позицию
камеры и, вычитая ее из мировой позиции поверхности, мы
получаем <code class="notranslate" translate="no">eyeToSurfaceDir</code>.</p>
<p>И наконец мы используем <code class="notranslate" translate="no">reflect</code>, которая является встроенной функцией GLSL, реализующей
формулу, которую мы рассмотрели выше. Мы используем результат, чтобы получить цвет из
кубической карты.</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-glsl">#version 300 es

precision highp float;

// Передается из вершинного шейдера.
in vec3 v_worldPosition;
in vec3 v_worldNormal;

// Текстура.
uniform samplerCube u_texture;

// Позиция камеры
uniform vec3 u_worldCameraPosition;

// нам нужно объявить выход для фрагментного шейдера
out vec4 outColor;

void main() {
  vec3 worldNormal = normalize(v_worldNormal);
  vec3 eyeToSurfaceDir = normalize(v_worldPosition - u_worldCameraPosition);
  vec3 direction = reflect(eyeToSurfaceDir,worldNormal);

  outColor = texture(u_texture, direction);
}
</code></pre>
<p>Нам также нужны реальные нормали для этого примера. Нам нужны реальные нормали, чтобы грани
куба выглядели плоскими. В предыдущем примере просто чтобы увидеть работу кубической карты мы
перепрофилировали позиции куба, но в этом случае нам нужны фактические нормали для
куба, как мы рассмотрели в <a href="webgl-3d-lighting-directional.html">статье об освещении</a></p>
<p>Во время инициализации</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">// Создаем буфер для размещения нормалей
var normalBuffer = gl.createBuffer();
// Привязываем его к ARRAY_BUFFER (думайте об этом как ARRAY_BUFFER = normalBuffer)
gl.bindBuffer(gl.ARRAY_BUFFER, normalBuffer);
// Помещаем данные нормалей в буфер
setNormals(gl);

// Говорим атрибуту, как получать данные из normalBuffer (ARRAY_BUFFER)
var size = 3;          // 3 компонента на итерацию
var type = gl.FLOAT;   // данные являются 32-битными значениями с плавающей точкой
var normalize = false; // нормализуем данные (конвертируем из 0-255 в 0-1)
var stride = 0;        // 0 = двигаемся вперед на size * sizeof(type) на каждой итерации, чтобы получить следующую позицию
var offset = 0;        // начинаем с начала буфера
gl.vertexAttribPointer(
    normalLocation, size, type, normalize, stride, offset)
</code></pre>
<p>И конечно нам нужно найти местоположения uniform во время инициализации</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">var projectionLocation = gl.getUniformLocation(program, &quot;u_projection&quot;);
var viewLocation = gl.getUniformLocation(program, &quot;u_view&quot;);
var worldLocation = gl.getUniformLocation(program, &quot;u_world&quot;);
var textureLocation = gl.getUniformLocation(program, &quot;u_texture&quot;);
var worldCameraPositionLocation = gl.getUniformLocation(program, &quot;u_worldCameraPosition&quot;);
</code></pre>
<p>и установить их во время рендеринга</p>
<pre class="prettyprint notranslate" translate="no"><code class="lang-js">// Вычисляем матрицу проекции
var aspect = gl.canvas.clientWidth / gl.canvas.clientHeight;
var projectionMatrix =
    m4.perspective(fieldOfViewRadians, aspect, 1, 2000);
gl.uniformMatrix4fv(projectionLocation, false, projectionMatrix);

var cameraPosition = [0, 0, 2];
var target = [0, 0, 0];
var up = [0, 1, 0];
// Вычисляем матрицу камеры, используя look at.
var cameraMatrix = m4.lookAt(cameraPosition, target, up);

// Создаем матрицу вида из матрицы камеры.
var viewMatrix = m4.inverse(cameraMatrix);

var worldMatrix = m4.xRotation(modelXRotationRadians);
worldMatrix = m4.yRotate(worldMatrix, modelYRotationRadians);

// Устанавливаем uniform
gl.uniformMatrix4fv(projectionLocation, false, projectionMatrix);
gl.uniformMatrix4fv(viewLocation, false, viewMatrix);
gl.uniformMatrix4fv(worldLocation, false, worldMatrix);
gl.uniform3fv(worldCameraPositionLocation, cameraPosition);

// Говорим шейдеру использовать текстуру unit 0 для u_texture
gl.uniform1i(textureLocation, 0);
</code></pre>
<p>Базовые отражения</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-environment-map.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-environment-map.html" target="_blank">Нажмите, чтобы открыть в новом окне</a>
</div>

</p>
<p>Далее давайте покажем <a href="webgl-skybox.html">как использовать кубическую карту для скайбокса</a>.</p>

    </div>
    <div class="lesson-sidebar">
        <select class="language">
    <option value="/webgl/lessons/webgl-environment-maps.html" >English</a>
    <option value="/webgl/lessons/de/webgl-environment-maps.html" >Deutsch</a>
    <option value="/webgl/lessons/ja/webgl-environment-maps.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-environment-maps.html" >한국어</a>
    <option value="/webgl/lessons/pt-br/webgl-environment-maps.html" >Português Brasileiro</a>
    <option value="/webgl/lessons/ru/webgl-environment-maps.html" selected>Русский</a>
    <option value="/webgl/lessons/zh_cn/webgl-environment-maps.html" >简体中文</a>
</select>


        <div id="toc">
          <ul>  <li>Основы</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-getting-webgl2.html">Как использовать WebGL2</a></li>
<li><a href="/webgl/lessons/ru/webgl-fundamentals.html">Основы</a></li>
<li><a href="/webgl/lessons/ru/webgl-how-it-works.html">Как это работает</a></li>
<li><a href="/webgl/lessons/ru/webgl-shaders-and-glsl.html">Шейдеры и GLSL</a></li>
<li><a href="/webgl/lessons/resources/webgl-state-diagram.html">WebGL2 Диаграмма состояния</a></li>
        </ul>
  <li>WebGL2 vs WebGL1</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl2-whats-new.html">Что нового в WebGL2</a></li>
<li><a href="/webgl/lessons/ru/webgl1-to-webgl2.html">Переход с WebGL1 на WebGL2</a></li>
<li><a href="/webgl/lessons/ru/webgl1-to-webgl2-fundamentals.html">Отличия от WebGLFundamentals.org до WebGL2Fundamentals.org</a></li>
        </ul>
  <li>Обработка изображений</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-image-processing.html">Обработка изображений</a></li>
<li><a href="/webgl/lessons/ru/webgl-image-processing-continued.html">Продвинутая обработка изображений</a></li>
        </ul>
  <li>2D трансформации, повороты, масштабирование и матричные операции</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-2d-translation.html">2D Трансляция</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-rotation.html">2D Вращение</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-scale.html">2D Масштабирование</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-matrices.html">2D Матрицы</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-orthographic.html">Ортографическая 3D</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-perspective.html">3D Перспектива</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-camera.html">3D - Камеры</a></li>
<li><a href="/webgl/lessons/ru/webgl-matrix-naming.html">3D - Именование матриц</a></li>
        </ul>
  <li>Освещение</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-lighting-directional.html">Направленное освещение</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-lighting-point.html">Точечное освещение</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-lighting-spot.html">Прожекторное освещение</a></li>
        </ul>
  <li>Организация и рефакторинг</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-less-code-more-fun.html">Меньше кода, больше удовольствия</a></li>
<li><a href="/webgl/lessons/ru/webgl-drawing-multiple-things.html">Рисование множественных объектов</a></li>
<li><a href="/webgl/lessons/ru/webgl-scene-graph.html">Графы сцен</a></li>
        </ul>
  <li>Геометрия</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-geometry-lathe.html">3D Геометрия - Токарная обработка</a></li>
<li><a href="/webgl/lessons/ru/webgl-load-obj.html">Загрузка .obj файлов</a></li>
<li><a href="/webgl/lessons/ru/webgl-load-obj-w-mtl.html">Загрузка .obj с .mtl файлами</a></li>
        </ul>
  <li>Текстуры</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-textures.html">Текстуры</a></li>
<li><a href="/webgl/lessons/ru/webgl-data-textures.html">Data Textures</a></li>
<li><a href="/webgl/lessons/ru/webgl-2-textures.html">Использование 2 или более текстур</a></li>
<li><a href="/webgl/lessons/ru/webgl-cors-permission.html">Cross Origin Images</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-perspective-correct-texturemapping.html">Перспективно-корректное наложение текстур</a></li>
<li><a href="/webgl/lessons/ru/webgl-planar-projection-mapping.html">Планарное и перспективное проекционное отображение</a></li>
        </ul>
  <li>Рендеринг в текстуру</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-render-to-texture.html">Рендеринг в текстуру</a></li>
        </ul>
  <li>Тени</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-shadows.html">Тени</a></li>
        </ul>
  <li>Техники</li>
        <ul>
            <li>2D</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-2d-drawimage.html">2D - DrawImage</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-matrix-stack.html">2D - Стек Матриц</a></li>
<li><a href="/webgl/lessons/ru/webgl-sprites.html">Спрайты</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-cube-maps.html">Кубические карты</a></li>
<li><a href="/webgl/lessons/ru/webgl-environment-maps.html">Карты окружения</a></li>
<li><a href="/webgl/lessons/ru/webgl-skybox.html">Скайбоксы</a></li>
<li><a href="/webgl/lessons/ru/webgl-skinning.html">Скининг</a></li>
<li><a href="/webgl/lessons/ru/webgl-fog.html">Fog</a></li>
<li><a href="/webgl/lessons/ru/webgl-picking.html">Выбор объектов (клик по объектам)</a></li>
        </ul>
  <li>Текст</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-text-html.html">Текст - HTML</a></li>
<li><a href="/webgl/lessons/ru/webgl-text-canvas2d.html">Текст - Canvas 2D</a></li>
<li><a href="/webgl/lessons/ru/webgl-text-texture.html">Текст - Использование текстуры</a></li>
<li><a href="/webgl/lessons/ru/webgl-text-glyphs.html">Текст - Использование текстуры глифов</a></li>
        </ul>
  <li>GPGPU</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-gpgpu.html">GPGPU</a></li>
        </ul>
        </ul>
  <li>Советы</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-smallest-programs.html">Самые маленькие программы</a></li>
<li><a href="/webgl/lessons/ru/webgl-drawing-without-data.html">Рисование без данных</a></li>
<li><a href="/webgl/lessons/ru/webgl-shadertoy.html">Shadertoy</a></li>
<li><a href="/webgl/lessons/ru/webgl-pulling-vertices.html">Вытягивание вершин</a></li>
        </ul>
  <li>Оптимизация</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-indexed-vertices.html">Индексированные вершины (gl.drawElements)</a></li>
<li><a href="/webgl/lessons/ru/webgl-instanced-drawing.html">Инстансинг (Instanced Drawing)</a></li>
        </ul>
  <li>Разное</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-setup-and-installation.html">Настройка и установка</a></li>
<li><a href="/webgl/lessons/ru/webgl-boilerplate.html">Boilerplate</a></li>
<li><a href="/webgl/lessons/ru/webgl-resizing-the-canvas.html">Изменение размера Canvas</a></li>
<li><a href="/webgl/lessons/ru/webgl-animation.html">Анимация</a></li>
<li><a href="/webgl/lessons/ru/webgl-points-lines-triangles.html">Точки, линии и треугольники</a></li>
<li><a href="/webgl/lessons/ru/webgl-multiple-views.html">Множественные виды, множественные canvas</a></li>
<li><a href="/webgl/lessons/ru/webgl-visualizing-the-camera.html">Визуализация камеры</a></li>
<li><a href="/webgl/lessons/ru/webgl-and-alpha.html">WebGL2 и альфа-канал</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-vs-3d-library.html">2D против 3D библиотек</a></li>
<li><a href="/webgl/lessons/ru/webgl-anti-patterns.html">Анти-паттерны</a></li>
<li><a href="/webgl/lessons/ru/webgl-matrix-vs-math.html">WebGL2 Матрицы против математических матриц</a></li>
<li><a href="/webgl/lessons/ru/webgl-precision-issues.html">Проблемы точности</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#screenshot">Скриншот канваса</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#preservedrawingbuffer">Как не очищать канвас</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#tabindex">Получение ввода с клавиатуры</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#html-background">Использование WebGL2 как фона в HTML</a></li>
<li><a href="/webgl/lessons/ru/webgl-cross-platform-issues.html">Cross Platform Issues</a></li>
<li><a href="/webgl/lessons/ru/webgl-qna.html">Questions and Answers</a></li>
        </ul>
  <li>Справочник</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-attributes.html">Атрибуты</a></li>
<li><a href="/webgl/lessons/ru/webgl-texture-units.html">Текстурные юниты</a></li>
<li><a href="/webgl/lessons/ru/webgl-framebuffers.html">Framebuffers</a></li>
<li><a href="/webgl/lessons/ru/webgl-readpixels.html">readPixels</a></li>
<li><a href="/webgl/lessons/ru/webgl-references.html">Ссылки</a></li>
        </ul></ul>
<ul>
  <li><a href="/docs/">API документация</a></li>
  <li><a href="https://twgljs.org">TWGL, легковесная библиотека-помощник для WebGL</a></li>
  <li><a href="https://github.com/gfxfundamentals/webgl2-fundamentals">GitHub</a></li>
</ul>
        </div>
    </div>
    <div class="lesson-comments">
        
<div>Есть предложения или замечания? <a href="https://github.com/gfxfundamentals/webgl2-fundamentals/issues">Создайте issue на GitHub</a>.</div>
  

        <div id="disqus_thread"></div>
        <script>
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'webgl2fundamentals'; // required: replace example with your forum shortname
            var disqus_identifier = 'WebGL2 Карты окружения (отражения)';
            var disqus_title = 'WebGL2 Карты окружения (отражения)';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                if (window.location.hostname.indexOf("webgl2fundamentals.org") < 0) {
                    return;
                }
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>
</div>
</body>
<script>
const settings = {
  contribTemplate: "Спасибо <a href=\"${html_url}\"><img src=\"${avatar_url}\"> ${login}</a><br>за <a href=\"https://github.com/${owner}/${repo}/commits?author=${login}\">${contributions} вкладов</a>",
  owner: "gfxfundamentals",
  repo: "webgl2-fundamentals",
};
</script>
<script src="/contributors.js"></script>
<script src="/3rdparty/jquery-1.11.2.min.js"></script>
<script src="/webgl/lessons/resources/prettify.js"></script>
<script src="/webgl/lessons/resources/lesson.js" type="module"></script>
<script>
</script>


</html>



