Title: Когда выбирать highp, mediump, lowp в шейдерах
Description: Когда выбирать highp, mediump, lowp в шейдерах
TOC: Когда выбирать highp, mediump, lowp в шейдерах

## Вопрос:

Какие лучшие практики для них? Есть ли разница в производительности?

## Ответ:

> Какие лучшие практики для них?

В основном это важно только на мобильных устройствах. Спецификация говорит, что реализация может всегда использовать более высокую точность, поэтому на десктопе и вершинный шейдер, и фрагментный шейдер всегда работают в highp. (Я не знаю десктопных GPU, для которых это не так)

Из [спецификации](https://www.khronos.org/files/opengles_shading_language.pdf) раздел 4.5.2:

> ##  4.5.2 Precision Qualifiers
>
> ...
>
> Precision qualifiers declare a minimum range and precision that the underlying implementation must use
> when storing these variables. Implementations may use greater range and precision than requested, but
> not less.

Для мобильных устройств и планшетов есть несколько ответов. Нет лучшего. Это зависит от вас:

1. используйте самую низкую точность, которую можете, но которая всё ещё делает то, что вам нужно.

2. используйте highp и игнорируйте проблемы производительности и старые телефоны, где это не работает

3. используйте mediump и игнорируйте баги (см. ниже)

4. проверьте, поддерживает ли устройство пользователя highp, если нет — используйте разные шейдеры с меньшим количеством функций.

WebGL по умолчанию использует highp для вершинных шейдеров, а фрагментные шейдеры не имеют значения по умолчанию, и вы должны указать одно. Более того, highp во фрагментном шейдере — это опциональная функция, и некоторые мобильные GPU её не поддерживают. Я не знаю, какой это процент в 2019 году. Насколько я знаю, большинство или даже все телефоны, выпущенные в 2019 году, поддерживают highp, но старые телефоны (2011, 2012, 2013) не поддерживают.

Из спецификации:

> The vertex language requires any uses of `lowp`, `mediump` and `highp` to compile and link without error.
> The fragment language requires any uses of `lowp` and `mediump` to compile without error. **Support for
> `highp` is optional**.

Примеры мест, где обычно нужен highp. Точечные источники света с затенением по Фонгу обычно нуждаются в highp. Так что, например, вы можете использовать только направленные источники света на системе, которая не поддерживает highp, ИЛИ вы можете использовать только направленные источники света на мобильных для производительности.

> Есть ли разница в производительности?

Да, но как сказано выше, реализация может использовать более высокую точность. Так что если вы используете mediump на десктопном GPU, вы не увидите разницы в производительности, поскольку он действительно всегда использует highp. На мобильных вы увидите разницу в производительности, по крайней мере в 2019 году. Вы также можете увидеть, где вашим шейдерам действительно нужен highp.

Вот шейдер Фонга, настроенный на использование mediump. На десктопе, поскольку mediump на самом деле highp, он работает:

![](https://user-images.githubusercontent.com/234804/43352753-6ed6b9f8-9263-11e8-9716-3819a8c92095.png)

На мобильных, где mediump действительно mediump, он ломается:

![](https://user-images.githubusercontent.com/234804/43352759-7f9d1656-9263-11e8-8487-aa57d6092ff1.png)

Пример, где mediump был бы хорош, по крайней мере во фрагментном шейдере — это большинство 2D игр.

<div class="so">
  <div>Вопрос и цитируемые части взяты по лицензии CC BY-SA 4.0 у
    <a data-href="https://stackoverflow.com/users/1435682">WayneNWayne</a>
    с сайта
    <a data-href="https://stackoverflow.com/questions/59100554">stackoverflow</a>
  </div>
</div> 