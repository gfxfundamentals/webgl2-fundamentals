<!DOCTYPE html>
<!-- this file is auto-generated from webgl/lessons/ru/webgl-how-it-works.md. Do not edited directly -->
<!--
Copyright 2021, GFXFundamentals.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

*   Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.

*   Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the following disclaimer
    in the documentation and/or other materials provided with the
    distribution.

*   Neither the name of GFXFundamentals. nor the names of his
    contributors may be used to endorse or promote products derived from
    this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Что WebGL на самом деле делает под капотом">
<meta name="keywords" content="webgl webgl2 graphics">
<meta name="thumbnail" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-how-it-works.jpg">

<meta property="og:title" content="Как работает WebGL2">
<meta property="og:type" content="website">
<meta property="og:image" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-how-it-works.jpg">
<meta property="og:description" content="Что WebGL на самом деле делает под капотом">
<meta property="og:url" content="https://webgl2fundamentals.org/webgl/lessons/ru/webgl-how-it-works.html">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@greggman">
<meta name="twitter:creator" content="@greggman">
<meta name="twitter:domain" content="webgl2fundamentals.org">
<meta name="twitter:title" content="Как работает WebGL2">
<meta name="twitter:url" content="https://webgl2fundamentals.org/webgl/lessons/ru/webgl-how-it-works.html">
<meta name="twitter:description" content="Что WebGL на самом деле делает под капотом">
<meta name="twitter:image:src" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-how-it-works.jpg">

<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@graph":[
    {
      "@type":"WebSite",
      "@id":"https://webgl2fundamentals.org/#website",
      "url":"https://webgl2fundamentals.org/",
      "name":"Webgl2Fundamentals"
    },
    {
      "@type":"ImageObject",
      "@id":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-how-it-works.html#primaryimage",
      "url":"https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-how-it-works.jpg",
      "width":1200,
      "height":830
    },
    {
      "@type":"WebPage",
      "@id":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-how-it-works.html#webpage",
      "url":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-how-it-works.html",
      "inLanguage":"ru",
      "name":"Как работает WebGL2",
      "keywords":"webgl webgl2 graphics programming",
      "isPartOf":{
        "@id":"https://webgl2fundamentals.org/#website"
      },
      "primaryImageOfPage":{
        "@id":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-how-it-works.html#primaryimage"
      }
    }
  ]
}
</script>


<title>Как работает WebGL2</title>
<link href="/webgl/lessons/resources/webgl2fundamentals-icon.png" rel="shortcut icon" type="image/png">
<link rel="stylesheet" href="/webgl/lessons/lang.css">
<link rel="stylesheet" href="/webgl/lessons/resources/lesson.css">

  <link rel="alternate" hreflang="en" href="https://webglfundamentals.org/webgl/lessons/webgl-how-it-works.html">
  <link rel="alternate" hreflang="de" href="https://webglfundamentals.org/webgl/lessons/de/webgl-how-it-works.html">
  <link rel="alternate" hreflang="ja" href="https://webglfundamentals.org/webgl/lessons/ja/webgl-how-it-works.html">
  <link rel="alternate" hreflang="ko" href="https://webglfundamentals.org/webgl/lessons/ko/webgl-how-it-works.html">
  <link rel="alternate" hreflang="pt-br" href="https://webglfundamentals.org/webgl/lessons/pt-br/webgl-how-it-works.html">
  <link rel="alternate" hreflang="ru" href="https://webglfundamentals.org/webgl/lessons/ru/webgl-how-it-works.html">
  <link rel="alternate" hreflang="zh_cn" href="https://webglfundamentals.org/webgl/lessons/zh_cn/webgl-how-it-works.html">




</head>
<body>
<div class="webgl_navbar">
  <div>
    <select class="language">
    <option value="/webgl/lessons/webgl-how-it-works.html" >English</a>
    <option value="/webgl/lessons/de/webgl-how-it-works.html" >Deutsch</a>
    <option value="/webgl/lessons/ja/webgl-how-it-works.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-how-it-works.html" >한국어</a>
    <option value="/webgl/lessons/pt-br/webgl-how-it-works.html" >Português Brasileiro</a>
    <option value="/webgl/lessons/ru/webgl-how-it-works.html" selected>Русский</a>
    <option value="/webgl/lessons/zh_cn/webgl-how-it-works.html" >简体中文</a>
</select>


    <a href="#toc">Содержание</a>
    <input type="search" placeholder="?" id="search">
  </div>
</div>
<div class="webgl_header">
  <h1><a href="/webgl/lessons/ru/">WebGL2Fundamentals.org</a></h1>
<style>
#forkongithub>div {
    background: #000;
    color: #fff;
    font-family: arial,sans-serif;
    text-align: center;
    font-weight: bold;
    padding: 5px 40px;
    font-size: 0.9rem;
    line-height: 1.3rem;
    position: relative;
    transition: 0.5s;
    display: block;
    width: 400px;
    position: absolute;
    top: 0;
    right: 0;
    transform: translateX(200px) rotate(45deg) translate(10px,70px);
    box-shadow: 4px 4px 10px rgba(0,0,0,0.8);
    pointer-events: auto;
}
#forkongithub a {
  text-decoration: none;
  color: #fff;
}
#forkongithub>div:hover {
    background: #c11;
    color: #fff;
}
#forkongithub .contributors {
  font-size: 0.75rem;
  background: rgba(255,255,255,0.2);
  line-height: 1.2;
  padding: 0.1em;
}
#forkongithub>div::before,#forkongithub>div::after {
    content: "";
    width: 100%;
    display: block;
    position: absolute;
    top: 1px;
    left: 0;
    height: 1px;
    background: #fff;
}
#forkongithub>div::after {
    bottom: 1px;
    top: auto;
}

#forkongithub{
    z-index: 9999;
    /* needed for firefox */
    overflow: hidden;
    width: 300px;
    height: 300px;
    position: absolute;
    right: 0;
    top: 0;
    pointer-events: none;
}
#forkongithub svg{
  width: 1em;
  height: 1em;
  vertical-align: middle;
}
#forkongithub img {
  width: 1em;
  height: 1em;
  border-radius: 100%;
  vertical-align: middle;
}

@media (max-width: 900px) {
    #forkongithub>div {
        line-height: 1.2rem;
    }
}
@media (max-width: 700px) {
  #forkongithub {
    display: none;
  }
}
@media (max-width: 410px) {
    #forkongithub>div {
        font-size: 0.7rem;
        transform: translateX(150px) rotate(45deg) translate(20px,40px);
    }
}

</style>
<div id="forkongithub"><div><div><a href="https://github.com/gfxfundamentals/webgl2-fundamentals">Fix, Fork, Contribute <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 136 133" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(3.92891,0,0,3.92891,67.867,129.125)">
        <path d="M0,-31.904C-8.995,-31.904 -16.288,-24.611 -16.288,-15.614C-16.288,-8.417 -11.621,-2.312 -5.148,-0.157C-4.333,-0.008 -4.036,-0.511 -4.036,-0.943C-4.036,-1.329 -4.05,-2.354 -4.058,-3.713C-8.589,-2.729 -9.545,-5.897 -9.545,-5.897C-10.286,-7.779 -11.354,-8.28 -11.354,-8.28C-12.833,-9.29 -11.242,-9.27 -11.242,-9.27C-9.607,-9.155 -8.747,-7.591 -8.747,-7.591C-7.294,-5.102 -4.934,-5.821 -4.006,-6.238C-3.858,-7.29 -3.438,-8.008 -2.972,-8.415C-6.589,-8.826 -10.392,-10.224 -10.392,-16.466C-10.392,-18.244 -9.757,-19.698 -8.715,-20.837C-8.883,-21.249 -9.442,-22.905 -8.556,-25.148C-8.556,-25.148 -7.188,-25.586 -4.076,-23.478C-2.777,-23.84 -1.383,-24.02 0.002,-24.026C1.385,-24.02 2.779,-23.84 4.08,-23.478C7.19,-25.586 8.555,-25.148 8.555,-25.148C9.444,-22.905 8.885,-21.249 8.717,-20.837C9.761,-19.698 10.392,-18.244 10.392,-16.466C10.392,-10.208 6.583,-8.831 2.954,-8.428C3.539,-7.925 4.06,-6.931 4.06,-5.411C4.06,-3.234 4.04,-1.477 4.04,-0.943C4.04,-0.507 4.333,0 5.16,-0.159C11.628,-2.318 16.291,-8.419 16.291,-15.614C16.291,-24.611 8.997,-31.904 0,-31.904" style="fill:white;"/>
    </g>
</svg>
</a></div></div></div>

</div>


<div class="container">
  <div class="lesson-title">
    <h1>Как работает WebGL2</h1>
  </div>
  <div class="lesson">
    <div class="lesson-main">
      <p>Это продолжение <a href="webgl-fundamentals.html">Основ WebGL</a>.
Прежде чем мы продолжим, я думаю, нам нужно обсудить на
базовом уровне, что WebGL и ваш GPU на самом деле делают. Есть в основном 2
части в этой GPU штуке. Первая часть обрабатывает вершины (или потоки
данных) в вершины clip space. Вторая часть рисует пиксели на основе
первой части.</p>
<p>Когда вы вызываете</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">gl.drawArrays(gl.TRIANGLES, 0, 9);
</code></pre>
<p>9 там означает “обработать 9 вершин”, так что вот 9 вершин обрабатываются.</p>
<div class="webgl_center"><img src="../resources/vertex-shader-anim.gif" /></div>
<p>Слева данные, которые вы предоставляете. Вершинный шейдер - это функция, которую вы
пишете на <a href="webgl-shaders-and-glsl.html">GLSL</a>. Она вызывается один раз для каждой вершины.
Вы делаете некоторую математику и устанавливаете специальную переменную <code class="notranslate" translate="no">gl_Position</code> значением clip space
для текущей вершины. GPU берет это значение и сохраняет его внутренне.</p>
<p>Предполагая, что вы рисуете <code class="notranslate" translate="no">TRIANGLES</code>, каждый раз, когда эта первая часть генерирует 3
вершины, GPU использует их для создания треугольника. Он выясняет, каким
пикселям соответствуют 3 точки треугольника, а затем растеризует
треугольник, что является модным словом для “рисует его пикселями”. Для каждого
пикселя он вызовет ваш фрагментный шейдер, спрашивая, какой цвет сделать для этого
пикселя. Ваш фрагментный шейдер выводит vec4
с цветом, который он хочет для этого пикселя.</p>
<p>Это все очень интересно, но как вы можете видеть в наших примерах до
этого момента фрагментный шейдер имеет очень мало информации на пиксель.
К счастью, мы можем передать ему больше информации. Мы определяем “varyings” для каждого
значения, которое мы хотим передать от вершинного шейдера к фрагментному шейдеру.</p>
<p>Как простой пример, давайте просто передадим координаты clip space, которые мы вычислили
напрямую от вершинного шейдера к фрагментному шейдеру.</p>
<p>Мы будем рисовать простым треугольником. Продолжая с нашего
<a href="webgl-2d-matrices.html">предыдущего примера</a>, давайте изменим наш прямоугольник на
треугольник.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">// Заполняем буфер значениями, которые определяют треугольник.
function setGeometry(gl) {
  gl.bufferData(
      gl.ARRAY_BUFFER,
      new Float32Array([
             0, -100,
           150,  125,
          -175,  100]),
      gl.STATIC_DRAW);
}
</code></pre>
<p>И нам нужно рисовать только 3 вершины.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">// Рисуем сцену.
function drawScene() {
  ...
  // Рисуем геометрию.
*  gl.drawArrays(gl.TRIANGLES, 0, 3);
}
</code></pre>
<p>Затем в нашем вершинном шейдере мы объявляем <em>varying</em>, делая <code class="notranslate" translate="no">out</code> для передачи данных в
фрагментный шейдер.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">out vec4 v_color;
...
void main() {
  // Умножаем позицию на матрицу.
  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1);

  // Преобразуем из clip space в цветовое пространство.
  // Clip space идет от -1.0 до +1.0
  // Цветовое пространство идет от 0.0 до 1.0
*  v_color = gl_Position * 0.5 + 0.5;
}
</code></pre>
<p>И затем мы объявляем тот же <em>varying</em> как <code class="notranslate" translate="no">in</code> в фрагментном шейдере.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">#version 300 es

precision highp float;

in vec4 v_color;

out vec4 outColor;

void main() {
*  outColor = v_color;
}
</code></pre>
<p>WebGL соединит varying в вершинном шейдере с varying
того же имени и типа в фрагментном шейдере.</p>
<p>Вот рабочая версия.</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-2d-triangle-with-position-for-color.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-2d-triangle-with-position-for-color.html" target="_blank">Нажмите, чтобы открыть в новом окне</a>
</div>

</p>
<p>Перемещайте, масштабируйте и поворачивайте треугольник. Обратите внимание, что поскольку цвета
вычисляются из clip space, они не двигаются с треугольником. Они
относительны к фону.</p>
<p>Теперь подумайте об этом. Мы вычисляем только 3 вершины. Наш вершинный шейдер
вызывается только 3 раза, поэтому он вычисляет только 3 цвета, но наш
треугольник имеет много цветов. Вот почему это называется <em>varying</em>.</p>
<p>WebGL берет 3 значения, которые мы вычислили для каждой вершины, и когда он растеризует
треугольник, он интерполирует между значениями, которые мы вычислили для
вершин. Для каждого пикселя он вызывает наш фрагментный шейдер с
интерполированным значением для этого пикселя.</p>
<p>В примере выше мы начинаем с 3 вершин</p>
<style>
table.vertex_table {
  border: 1px solid black;
  border-collapse: collapse;
  font-family: monospace;
  font-size: small;
}

table.vertex_table th {
  background-color: #88ccff;
  padding-right: 1em;
  padding-left: 1em;
}

table.vertex_table td {
  border: 1px solid black;
  text-align: right;
  padding-right: 1em;
  padding-left: 1em;
}
</style>
<div class="hcenter">
<table class="vertex_table">
<tr><th colspan="2">Вершины</th></tr>
<tr><td>0</td><td>-100</td></tr>
<tr><td>150</td><td>125</td></tr>
<tr><td>-175</td><td>100</td></tr>
</table>
</div>
<p>Наш вершинный шейдер применяет матрицу для перемещения, поворота, масштабирования и преобразования
в clip space. Значения по умолчанию для перемещения, поворота и масштабирования:
перемещение = 200, 150, поворот = 0, масштаб = 1,1, так что это действительно только
перемещение. Учитывая, что наш backbuffer 400x300, наш вершинный шейдер применяет
матрицу и затем вычисляет следующие 3 вершины clip space.</p>
<div class="hcenter">
<table class="vertex_table">
<tr><th colspan="3">значения, записанные в gl_Position</th></tr>
<tr><td>0.000</td><td>0.660</td></tr>
<tr><td>0.750</td><td>-0.830</td></tr>
<tr><td>-0.875</td><td>-0.660</td></tr>
</table>
</div>
<p>Он также преобразует их в цветовое пространство и записывает их в <em>varying</em>
v_color, который мы объявили.</p>
<div class="hcenter">
<table class="vertex_table">
<tr><th colspan="3">значения, записанные в v_color</th></tr>
<tr><td>0.5000</td><td>0.830</td><td>0.5</td></tr>
<tr><td>0.8750</td><td>0.086</td><td>0.5</td></tr>
<tr><td>0.0625</td><td>0.170</td><td>0.5</td></tr>
</table>
</div>
<p>Те 3 значения, записанные в v_color, затем интерполируются и передаются в
фрагментный шейдер для каждого пикселя.</p>
<p><div class="webgl_diagram_container">
  <iframe class="webgl_example " style="width: 600px; height: 400px;" src="/webgl/lessons/resources/fragment-shader-anim.html"></iframe>
  <div class="webgl_center">v_color интерполируется между v0, v1 и v2</div>
</div>

</p>
<p>Мы также можем передать больше данных в вершинный шейдер, которые мы можем затем передать
в фрагментный шейдер. Так, например, давайте нарисуем прямоугольник, который
состоит из 2 треугольников, в 2 цветах. Для этого мы добавим еще один
атрибут в вершинный шейдер, чтобы мы могли передать ему больше данных, и мы передадим
эти данные напрямую в фрагментный шейдер.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">in vec2 a_position;
+in vec4 a_color;
...
out vec4 v_color;

void main() {
   ...
  // Копируем цвет из атрибута в varying.
*  v_color = a_color;
}
</code></pre>
<p>Теперь нам нужно предоставить цвета для WebGL.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">  // ищем, куда должны идти данные вершин.
  var positionLocation = gl.getAttribLocation(program, &quot;a_position&quot;);
+  var colorLocation = gl.getAttribLocation(program, &quot;a_color&quot;);
  ...
+  // Создаем буфер для цветов.
+  var buffer = gl.createBuffer();
+  gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
+
+  // Устанавливаем цвета.
+  setColors(gl);

  // настраиваем атрибуты
  ...
+  // говорим атрибуту цвета, как извлекать данные из текущего ARRAY_BUFFER
+  gl.enableVertexAttribArray(colorLocation);
+  var size = 4;
+  var type = gl.FLOAT;
+  var normalize = false;
+  var stride = 0;
+  var offset = 0;
+  gl.vertexAttribPointer(colorLocation, size, type, normalize, stride, offset);

  ...

+// Заполняем буфер цветами для 2 треугольников
+// которые составляют прямоугольник.
+function setColors(gl) {
+  // Выбираем 2 случайных цвета.
+  var r1 = Math.random();
+  var b1 = Math.random();
+  var g1 = Math.random();
+
+  var r2 = Math.random();
+  var b2 = Math.random();
+  var g2 = Math.random();
+
+  gl.bufferData(
+      gl.ARRAY_BUFFER,
+      new Float32Array(
+        [ r1, b1, g1, 1,
+          r1, b1, g1, 1,
+          r1, b1, g1, 1,
+          r2, b2, g2, 1,
+          r2, b2, g2, 1,
+          r2, b2, g2, 1]),
+      gl.STATIC_DRAW);
+}
</code></pre>
<p>И вот результат.</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-2d-rectangle-with-2-colors.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-2d-rectangle-with-2-colors.html" target="_blank">Нажмите, чтобы открыть в новом окне</a>
</div>

</p>
<p>Обратите внимание, что у нас есть 2 треугольника сплошного цвета. Тем не менее, мы передаем значения
в <em>varying</em>, поэтому они варьируются или интерполируются по
треугольнику. Просто мы использовали тот же цвет на каждой из 3 вершин
каждого треугольника. Если мы сделаем каждый цвет разным, мы увидим
интерполяцию.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">// Заполняем буфер цветами для 2 треугольников
// которые составляют прямоугольник.
function setColors(gl) {
  // Делаем каждую вершину разным цветом.
  gl.bufferData(
      gl.ARRAY_BUFFER,
      new Float32Array(
*        [ Math.random(), Math.random(), Math.random(), 1,
*          Math.random(), Math.random(), Math.random(), 1,
*          Math.random(), Math.random(), Math.random(), 1,
*          Math.random(), Math.random(), Math.random(), 1,
*          Math.random(), Math.random(), Math.random(), 1,
*          Math.random(), Math.random(), Math.random(), 1]),
      gl.STATIC_DRAW);
}
</code></pre>
<p>И теперь мы видим интерполированный <em>varying</em>.</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-2d-rectangle-with-random-colors.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-2d-rectangle-with-random-colors.html" target="_blank">Нажмите, чтобы открыть в новом окне</a>
</div>

</p>
<p>Не очень захватывающе, я полагаю, но это демонстрирует использование более чем одного
атрибута и передачу данных от вершинного шейдера к фрагментному шейдеру. Если
вы посмотрите на <a href="webgl-image-processing.html">примеры обработки изображений</a>,
вы увидите, что они также используют дополнительный атрибут для передачи координат текстуры.</p>
<h2 id="что-делают-эти-команды-буфера-и-атрибута">Что делают эти команды буфера и атрибута?</h2>
<p>Буферы - это способ получения данных вершин и других данных на вершину на
GPU. <code class="notranslate" translate="no">gl.createBuffer</code> создает буфер.
<code class="notranslate" translate="no">gl.bindBuffer</code> устанавливает этот буфер как буфер для работы.
<code class="notranslate" translate="no">gl.bufferData</code> копирует данные в текущий буфер.</p>
<p>Как только данные находятся в буфере, нам нужно сказать WebGL, как извлекать данные из
него и предоставлять их атрибутам вершинного шейдера.</p>
<p>Для этого сначала мы спрашиваем WebGL, какие локации он назначил
атрибутам. Например, в коде выше у нас есть</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">// ищем, куда должны идти данные вершин.
var positionLocation = gl.getAttribLocation(program, &quot;a_position&quot;);
var colorLocation = gl.getAttribLocation(program, &quot;a_color&quot;);
</code></pre>
<p>Как только мы знаем локацию атрибута, мы выдаем 2 команды.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">gl.enableVertexAttribArray(location);
</code></pre>
<p>Эта команда говорит WebGL, что мы хотим предоставить данные из буфера.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">gl.vertexAttribPointer(
    location,
    numComponents,
    typeOfData,
    normalizeFlag,
    strideToNextPieceOfData,
    offsetIntoBuffer);
</code></pre>
<p>И эта команда говорит WebGL получать данные из буфера, который был последним
привязан с gl.bindBuffer, сколько компонентов на вершину (1 - 4), какой
тип данных (<code class="notranslate" translate="no">BYTE</code>, <code class="notranslate" translate="no">FLOAT</code>, <code class="notranslate" translate="no">INT</code>, <code class="notranslate" translate="no">UNSIGNED_SHORT</code>, и т.д.), шаг
который означает, сколько байт пропустить, чтобы получить от одного куска данных к
следующему куску данных, и смещение для того, как далеко в буфере находятся наши данные.</p>
<p>Количество компонентов всегда от 1 до 4.</p>
<p>Если вы используете 1 буфер на тип данных, то и шаг, и смещение могут
всегда быть 0. 0 для шага означает “использовать шаг, который соответствует типу и
размеру”. 0 для смещения означает начать с начала буфера. Установка
их в значения, отличные от 0, более сложна, и хотя это может иметь некоторые
преимущества с точки зрения производительности, это не стоит усложнения, если только
вы не пытаетесь довести WebGL до его абсолютных пределов.</p>
<p>Я надеюсь, что это проясняет буферы и атрибуты.</p>
<p>Вы можете взглянуть на эту
<a href="/webgl/lessons/resources/webgl-state-diagram.html">интерактивную диаграмму состояния</a>
для другого способа понимания того, как работает WebGL.</p>
<p>Далее давайте пройдемся по <a href="webgl-shaders-and-glsl.html">шейдерам и GLSL</a>.</p>
<div class="webgl_bottombar"><h3>Для чего нужен normalizeFlag в vertexAttribPointer?</h3>
<p>
Флаг нормализации предназначен для всех не-плавающих типов. Если вы передаете
false, то значения будут интерпретироваться как тип, которым они являются. BYTE идет
от -128 до 127, UNSIGNED_BYTE идет от 0 до 255, SHORT идет от -32768 до 32767 и т.д...
</p>
<p>
Если вы устанавливаете флаг нормализации в true, то значения BYTE (-128 до 127)
представляют значения -1.0 до +1.0, UNSIGNED_BYTE (0 до 255) становятся 0.0 до +1.0.
Нормализованный SHORT также идет от -1.0 до +1.0, просто у него больше разрешения, чем у BYTE.
</p>
<p>
Самое распространенное использование нормализованных данных - для цветов. Большую часть времени цвета
идут только от 0.0 до 1.0. Использование полного float для каждого красного, зеленого, синего и альфа
использовало бы 16 байт на вершину на цвет. Если у вас сложная геометрия, это
может сложиться в много байт. Вместо этого вы могли бы конвертировать ваши цвета в UNSIGNED_BYTE,
где 0 представляет 0.0, а 255 представляет 1.0. Теперь вам понадобилось бы только 4 байта на цвет
на вершину, экономия 75%.
</p>
<p>Давайте изменим наш код, чтобы делать это. Когда мы говорим WebGL, как извлекать наши цвета, мы бы использовали</p>
<pre class="prettyprint showlinemods">
  var size = 4;
*  var type = gl.UNSIGNED_BYTE;
*  var normalize = true;
  var stride = 0;
  var offset = 0;
  gl.vertexAttribPointer(colorLocation, size, type, normalize, stride, offset);
</pre>
<p>И когда мы заполняем наш буфер цветами, мы бы использовали</p>
<pre class="prettyprint showlinemods">
// Заполняем буфер цветами для 2 треугольников
// которые составляют прямоугольник.
function setColors(gl) {
  // Выбираем 2 случайных цвета.
  var r1 = Math.random() * 256; // 0 до 255.99999
  var b1 = Math.random() * 256; // эти значения
  var g1 = Math.random() * 256; // будут обрезаны
  var r2 = Math.random() * 256; // когда сохранены в
  var b2 = Math.random() * 256; // Uint8Array
  var g2 = Math.random() * 256;
<p>gl.bufferData(
gl.ARRAY_BUFFER,
new Uint8Array(   // Uint8Array
[ r1, b1, g1, 255,
r1, b1, g1, 255,
r1, b1, g1, 255,
r2, b2, g2, 255,
r2, b2, g2, 255,
r2, b2, g2, 255]),
gl.STATIC_DRAW);
}
</pre></p>
<p>
Вот этот пример.
</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-2d-rectangle-with-2-byte-colors.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-2d-rectangle-with-2-byte-colors.html" target="_blank">Нажмите, чтобы открыть в новом окне</a>
</div>

</p>
</div> 
    </div>
    <div class="lesson-sidebar">
        <select class="language">
    <option value="/webgl/lessons/webgl-how-it-works.html" >English</a>
    <option value="/webgl/lessons/de/webgl-how-it-works.html" >Deutsch</a>
    <option value="/webgl/lessons/ja/webgl-how-it-works.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-how-it-works.html" >한국어</a>
    <option value="/webgl/lessons/pt-br/webgl-how-it-works.html" >Português Brasileiro</a>
    <option value="/webgl/lessons/ru/webgl-how-it-works.html" selected>Русский</a>
    <option value="/webgl/lessons/zh_cn/webgl-how-it-works.html" >简体中文</a>
</select>


        <div id="toc">
          <ul>  <li>Основы</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-getting-webgl2.html">Как использовать WebGL2</a></li>
<li><a href="/webgl/lessons/ru/webgl-fundamentals.html">Основы</a></li>
<li><a href="/webgl/lessons/ru/webgl-how-it-works.html">Как это работает</a></li>
<li><a href="/webgl/lessons/ru/webgl-shaders-and-glsl.html">Шейдеры и GLSL</a></li>
<li><a href="/webgl/lessons/resources/webgl-state-diagram.html">WebGL2 Диаграмма состояния</a></li>
        </ul>
  <li>WebGL2 vs WebGL1</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl2-whats-new.html">Что нового в WebGL2</a></li>
<li><a href="/webgl/lessons/ru/webgl1-to-webgl2.html">Переход с WebGL1 на WebGL2</a></li>
<li><a href="/webgl/lessons/ru/webgl1-to-webgl2-fundamentals.html">Отличия от WebGLFundamentals.org до WebGL2Fundamentals.org</a></li>
        </ul>
  <li>Обработка изображений</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-image-processing.html">Обработка изображений</a></li>
<li><a href="/webgl/lessons/ru/webgl-image-processing-continued.html">Продвинутая обработка изображений</a></li>
        </ul>
  <li>2D трансформации, повороты, масштабирование и матричные операции</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-2d-translation.html">2D Трансляция</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-rotation.html">2D Вращение</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-scale.html">2D Масштабирование</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-matrices.html">2D Матрицы</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-orthographic.html">Ортографическая 3D</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-perspective.html">3D Перспектива</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-camera.html">3D - Камеры</a></li>
<li><a href="/webgl/lessons/ru/webgl-matrix-naming.html">3D - Именование матриц</a></li>
        </ul>
  <li>Освещение</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-lighting-directional.html">Направленное освещение</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-lighting-point.html">Точечное освещение</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-lighting-spot.html">Прожекторное освещение</a></li>
        </ul>
  <li>Организация и рефакторинг</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-less-code-more-fun.html">Меньше кода, больше удовольствия</a></li>
<li><a href="/webgl/lessons/ru/webgl-drawing-multiple-things.html">Рисование множественных объектов</a></li>
<li><a href="/webgl/lessons/ru/webgl-scene-graph.html">Графы сцен</a></li>
        </ul>
  <li>Геометрия</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-geometry-lathe.html">3D Геометрия - Токарная обработка</a></li>
<li><a href="/webgl/lessons/ru/webgl-load-obj.html">Загрузка .obj файлов</a></li>
<li><a href="/webgl/lessons/ru/webgl-load-obj-w-mtl.html">Загрузка .obj с .mtl файлами</a></li>
        </ul>
  <li>Текстуры</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-textures.html">Текстуры</a></li>
<li><a href="/webgl/lessons/ru/webgl-data-textures.html">Data Textures</a></li>
<li><a href="/webgl/lessons/ru/webgl-2-textures.html">Использование 2 или более текстур</a></li>
<li><a href="/webgl/lessons/ru/webgl-cors-permission.html">Cross Origin Images</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-perspective-correct-texturemapping.html">Перспективно-корректное наложение текстур</a></li>
<li><a href="/webgl/lessons/ru/webgl-planar-projection-mapping.html">Планарное и перспективное проекционное отображение</a></li>
        </ul>
  <li>Рендеринг в текстуру</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-render-to-texture.html">Рендеринг в текстуру</a></li>
        </ul>
  <li>Тени</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-shadows.html">Тени</a></li>
        </ul>
  <li>Техники</li>
        <ul>
            <li>2D</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-2d-drawimage.html">2D - DrawImage</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-matrix-stack.html">2D - Стек Матриц</a></li>
<li><a href="/webgl/lessons/ru/webgl-sprites.html">Спрайты</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-cube-maps.html">Кубические карты</a></li>
<li><a href="/webgl/lessons/ru/webgl-environment-maps.html">Карты окружения</a></li>
<li><a href="/webgl/lessons/ru/webgl-skybox.html">Скайбоксы</a></li>
<li><a href="/webgl/lessons/ru/webgl-skinning.html">Скининг</a></li>
<li><a href="/webgl/lessons/ru/webgl-fog.html">Fog</a></li>
<li><a href="/webgl/lessons/ru/webgl-picking.html">Выбор объектов (клик по объектам)</a></li>
        </ul>
  <li>Текст</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-text-html.html">Текст - HTML</a></li>
<li><a href="/webgl/lessons/ru/webgl-text-canvas2d.html">Текст - Canvas 2D</a></li>
<li><a href="/webgl/lessons/ru/webgl-text-texture.html">Текст - Использование текстуры</a></li>
<li><a href="/webgl/lessons/ru/webgl-text-glyphs.html">Текст - Использование текстуры глифов</a></li>
        </ul>
  <li>GPGPU</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-gpgpu.html">GPGPU</a></li>
        </ul>
        </ul>
  <li>Советы</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-smallest-programs.html">Самые маленькие программы</a></li>
<li><a href="/webgl/lessons/ru/webgl-drawing-without-data.html">Рисование без данных</a></li>
<li><a href="/webgl/lessons/ru/webgl-shadertoy.html">Shadertoy</a></li>
<li><a href="/webgl/lessons/ru/webgl-pulling-vertices.html">Вытягивание вершин</a></li>
        </ul>
  <li>Оптимизация</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-indexed-vertices.html">Индексированные вершины (gl.drawElements)</a></li>
<li><a href="/webgl/lessons/ru/webgl-instanced-drawing.html">Инстансинг (Instanced Drawing)</a></li>
        </ul>
  <li>Разное</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-setup-and-installation.html">Настройка и установка</a></li>
<li><a href="/webgl/lessons/ru/webgl-boilerplate.html">Boilerplate</a></li>
<li><a href="/webgl/lessons/ru/webgl-resizing-the-canvas.html">Изменение размера Canvas</a></li>
<li><a href="/webgl/lessons/ru/webgl-animation.html">Анимация</a></li>
<li><a href="/webgl/lessons/ru/webgl-points-lines-triangles.html">Точки, линии и треугольники</a></li>
<li><a href="/webgl/lessons/ru/webgl-multiple-views.html">Множественные виды, множественные canvas</a></li>
<li><a href="/webgl/lessons/ru/webgl-visualizing-the-camera.html">Визуализация камеры</a></li>
<li><a href="/webgl/lessons/ru/webgl-and-alpha.html">WebGL2 и альфа-канал</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-vs-3d-library.html">2D против 3D библиотек</a></li>
<li><a href="/webgl/lessons/ru/webgl-anti-patterns.html">Анти-паттерны</a></li>
<li><a href="/webgl/lessons/ru/webgl-matrix-vs-math.html">WebGL2 Матрицы против математических матриц</a></li>
<li><a href="/webgl/lessons/ru/webgl-precision-issues.html">Проблемы точности</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#screenshot">Скриншот канваса</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#preservedrawingbuffer">Как не очищать канвас</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#tabindex">Получение ввода с клавиатуры</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#html-background">Использование WebGL2 как фона в HTML</a></li>
<li><a href="/webgl/lessons/ru/webgl-cross-platform-issues.html">Cross Platform Issues</a></li>
<li><a href="/webgl/lessons/ru/webgl-qna.html">Questions and Answers</a></li>
        </ul>
  <li>Справочник</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-attributes.html">Атрибуты</a></li>
<li><a href="/webgl/lessons/ru/webgl-texture-units.html">Текстурные юниты</a></li>
<li><a href="/webgl/lessons/ru/webgl-framebuffers.html">Framebuffers</a></li>
<li><a href="/webgl/lessons/ru/webgl-readpixels.html">readPixels</a></li>
<li><a href="/webgl/lessons/ru/webgl-references.html">Ссылки</a></li>
        </ul></ul>
<ul>
  <li><a href="/docs/">API документация</a></li>
  <li><a href="https://twgljs.org">TWGL, легковесная библиотека-помощник для WebGL</a></li>
  <li><a href="https://github.com/gfxfundamentals/webgl2-fundamentals">GitHub</a></li>
</ul>
        </div>
    </div>
    <div class="lesson-comments">
        
<div>Есть предложения или замечания? <a href="https://github.com/gfxfundamentals/webgl2-fundamentals/issues">Создайте issue на GitHub</a>.</div>
  

        <div id="disqus_thread"></div>
        <script>
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'webgl2fundamentals'; // required: replace example with your forum shortname
            var disqus_identifier = 'Как работает WebGL2';
            var disqus_title = 'Как работает WebGL2';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                if (window.location.hostname.indexOf("webgl2fundamentals.org") < 0) {
                    return;
                }
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>
</div>
</body>
<script>
const settings = {
  contribTemplate: "Спасибо <a href=\"${html_url}\"><img src=\"${avatar_url}\"> ${login}</a><br>за <a href=\"https://github.com/${owner}/${repo}/commits?author=${login}\">${contributions} вкладов</a>",
  owner: "gfxfundamentals",
  repo: "webgl2-fundamentals",
};
</script>
<script src="/contributors.js"></script>
<script src="/3rdparty/jquery-1.11.2.min.js"></script>
<script src="/webgl/lessons/resources/prettify.js"></script>
<script src="/webgl/lessons/resources/lesson.js" type="module"></script>
<script>
</script>


</html>



