<!DOCTYPE html>
<!-- this file is auto-generated from webgl/lessons/ru/webgl-2d-matrix-stack.md. Do not edited directly -->
<!--
Copyright 2021, GFXFundamentals.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

*   Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.

*   Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the following disclaimer
    in the documentation and/or other materials provided with the
    distribution.

*   Neither the name of GFXFundamentals. nor the names of his
    contributors may be used to endorse or promote products derived from
    this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Как реализовать функции translate/rotate/scale из Canvas 2D в WebGL">
<meta name="keywords" content="webgl webgl2 graphics">
<meta name="thumbnail" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-2d-matrix-stack_ru.jpg">

<meta property="og:title" content="WebGL2 Реализация Стекла Матриц">
<meta property="og:type" content="website">
<meta property="og:image" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-2d-matrix-stack_ru.jpg">
<meta property="og:description" content="Как реализовать функции translate/rotate/scale из Canvas 2D в WebGL">
<meta property="og:url" content="https://webgl2fundamentals.org/webgl/lessons/ru/webgl-2d-matrix-stack.html">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@greggman">
<meta name="twitter:creator" content="@greggman">
<meta name="twitter:domain" content="webgl2fundamentals.org">
<meta name="twitter:title" content="WebGL2 Реализация Стекла Матриц">
<meta name="twitter:url" content="https://webgl2fundamentals.org/webgl/lessons/ru/webgl-2d-matrix-stack.html">
<meta name="twitter:description" content="Как реализовать функции translate/rotate/scale из Canvas 2D в WebGL">
<meta name="twitter:image:src" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-2d-matrix-stack_ru.jpg">

<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@graph":[
    {
      "@type":"WebSite",
      "@id":"https://webgl2fundamentals.org/#website",
      "url":"https://webgl2fundamentals.org/",
      "name":"Webgl2Fundamentals"
    },
    {
      "@type":"ImageObject",
      "@id":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-2d-matrix-stack.html#primaryimage",
      "url":"https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-2d-matrix-stack_ru.jpg",
      "width":1200,
      "height":630
    },
    {
      "@type":"WebPage",
      "@id":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-2d-matrix-stack.html#webpage",
      "url":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-2d-matrix-stack.html",
      "inLanguage":"ru",
      "name":"WebGL2 Реализация Стекла Матриц",
      "keywords":"webgl webgl2 graphics programming",
      "isPartOf":{
        "@id":"https://webgl2fundamentals.org/#website"
      },
      "primaryImageOfPage":{
        "@id":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-2d-matrix-stack.html#primaryimage"
      }
    }
  ]
}
</script>


<title>WebGL2 Реализация Стекла Матриц</title>
<link href="/webgl/lessons/resources/webgl2fundamentals-icon.png" rel="shortcut icon" type="image/png">
<link rel="stylesheet" href="/webgl/lessons/lang.css">
<link rel="stylesheet" href="/webgl/lessons/resources/lesson.css">

  <link rel="alternate" hreflang="en" href="https://webglfundamentals.org/webgl/lessons/webgl-2d-matrix-stack.html">
  <link rel="alternate" hreflang="de" href="https://webglfundamentals.org/webgl/lessons/de/webgl-2d-matrix-stack.html">
  <link rel="alternate" hreflang="ja" href="https://webglfundamentals.org/webgl/lessons/ja/webgl-2d-matrix-stack.html">
  <link rel="alternate" hreflang="ko" href="https://webglfundamentals.org/webgl/lessons/ko/webgl-2d-matrix-stack.html">
  <link rel="alternate" hreflang="pt-br" href="https://webglfundamentals.org/webgl/lessons/pt-br/webgl-2d-matrix-stack.html">
  <link rel="alternate" hreflang="ru" href="https://webglfundamentals.org/webgl/lessons/ru/webgl-2d-matrix-stack.html">
  <link rel="alternate" hreflang="zh_cn" href="https://webglfundamentals.org/webgl/lessons/zh_cn/webgl-2d-matrix-stack.html">




</head>
<body>
<div class="webgl_navbar">
  <div>
    <select class="language">
    <option value="/webgl/lessons/webgl-2d-matrix-stack.html" >English</a>
    <option value="/webgl/lessons/de/webgl-2d-matrix-stack.html" >Deutsch</a>
    <option value="/webgl/lessons/ja/webgl-2d-matrix-stack.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-2d-matrix-stack.html" >한국어</a>
    <option value="/webgl/lessons/pt-br/webgl-2d-matrix-stack.html" >Português Brasileiro</a>
    <option value="/webgl/lessons/ru/webgl-2d-matrix-stack.html" selected>Русский</a>
    <option value="/webgl/lessons/zh_cn/webgl-2d-matrix-stack.html" >简体中文</a>
</select>


    <a href="#toc">Содержание</a>
    <input type="search" placeholder="?" id="search">
  </div>
</div>
<div class="webgl_header">
  <h1><a href="/webgl/lessons/ru/">WebGL2Fundamentals.org</a></h1>
<style>
#forkongithub>div {
    background: #000;
    color: #fff;
    font-family: arial,sans-serif;
    text-align: center;
    font-weight: bold;
    padding: 5px 40px;
    font-size: 0.9rem;
    line-height: 1.3rem;
    position: relative;
    transition: 0.5s;
    display: block;
    width: 400px;
    position: absolute;
    top: 0;
    right: 0;
    transform: translateX(200px) rotate(45deg) translate(10px,70px);
    box-shadow: 4px 4px 10px rgba(0,0,0,0.8);
    pointer-events: auto;
}
#forkongithub a {
  text-decoration: none;
  color: #fff;
}
#forkongithub>div:hover {
    background: #c11;
    color: #fff;
}
#forkongithub .contributors {
  font-size: 0.75rem;
  background: rgba(255,255,255,0.2);
  line-height: 1.2;
  padding: 0.1em;
}
#forkongithub>div::before,#forkongithub>div::after {
    content: "";
    width: 100%;
    display: block;
    position: absolute;
    top: 1px;
    left: 0;
    height: 1px;
    background: #fff;
}
#forkongithub>div::after {
    bottom: 1px;
    top: auto;
}

#forkongithub{
    z-index: 9999;
    /* needed for firefox */
    overflow: hidden;
    width: 300px;
    height: 300px;
    position: absolute;
    right: 0;
    top: 0;
    pointer-events: none;
}
#forkongithub svg{
  width: 1em;
  height: 1em;
  vertical-align: middle;
}
#forkongithub img {
  width: 1em;
  height: 1em;
  border-radius: 100%;
  vertical-align: middle;
}

@media (max-width: 900px) {
    #forkongithub>div {
        line-height: 1.2rem;
    }
}
@media (max-width: 700px) {
  #forkongithub {
    display: none;
  }
}
@media (max-width: 410px) {
    #forkongithub>div {
        font-size: 0.7rem;
        transform: translateX(150px) rotate(45deg) translate(20px,40px);
    }
}

</style>
<div id="forkongithub"><div><div><a href="https://github.com/gfxfundamentals/webgl2-fundamentals">Fix, Fork, Contribute <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 136 133" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(3.92891,0,0,3.92891,67.867,129.125)">
        <path d="M0,-31.904C-8.995,-31.904 -16.288,-24.611 -16.288,-15.614C-16.288,-8.417 -11.621,-2.312 -5.148,-0.157C-4.333,-0.008 -4.036,-0.511 -4.036,-0.943C-4.036,-1.329 -4.05,-2.354 -4.058,-3.713C-8.589,-2.729 -9.545,-5.897 -9.545,-5.897C-10.286,-7.779 -11.354,-8.28 -11.354,-8.28C-12.833,-9.29 -11.242,-9.27 -11.242,-9.27C-9.607,-9.155 -8.747,-7.591 -8.747,-7.591C-7.294,-5.102 -4.934,-5.821 -4.006,-6.238C-3.858,-7.29 -3.438,-8.008 -2.972,-8.415C-6.589,-8.826 -10.392,-10.224 -10.392,-16.466C-10.392,-18.244 -9.757,-19.698 -8.715,-20.837C-8.883,-21.249 -9.442,-22.905 -8.556,-25.148C-8.556,-25.148 -7.188,-25.586 -4.076,-23.478C-2.777,-23.84 -1.383,-24.02 0.002,-24.026C1.385,-24.02 2.779,-23.84 4.08,-23.478C7.19,-25.586 8.555,-25.148 8.555,-25.148C9.444,-22.905 8.885,-21.249 8.717,-20.837C9.761,-19.698 10.392,-18.244 10.392,-16.466C10.392,-10.208 6.583,-8.831 2.954,-8.428C3.539,-7.925 4.06,-6.931 4.06,-5.411C4.06,-3.234 4.04,-1.477 4.04,-0.943C4.04,-0.507 4.333,0 5.16,-0.159C11.628,-2.318 16.291,-8.419 16.291,-15.614C16.291,-24.611 8.997,-31.904 0,-31.904" style="fill:white;"/>
    </g>
</svg>
</a></div></div></div>

</div>


<div class="container">
  <div class="lesson-title">
    <h1>WebGL2 Реализация Стекла Матриц</h1>
  </div>
  <div class="lesson">
    <div class="lesson-main">
      <p>Эта статья является продолжением <a href="webgl-2d-drawimage.html">WebGL 2D DrawImage</a>.
Если вы не читали её, я рекомендую <a href="webgl-2d-drawimage.html">начать оттуда</a>.</p>
<p>В той последней статье мы реализовали WebGL эквивалент функции <code class="notranslate" translate="no">drawImage</code> из Canvas 2D,
включая её способность указывать как исходный прямоугольник, так и прямоугольник назначения.</p>
<p>Что мы ещё не сделали - это позволить нам вращать и/или масштабировать изображение из любой произвольной точки. Мы могли бы сделать это, добавив больше аргументов, как минимум нам нужно было бы указать центральную точку, поворот и масштаб по x и y.
К счастью, есть более универсальный и полезный способ. Способ, которым Canvas 2D API делает это - это стек матриц.
Функции стека матриц Canvas 2D API: <code class="notranslate" translate="no">save</code>, <code class="notranslate" translate="no">restore</code>, <code class="notranslate" translate="no">translate</code>, <code class="notranslate" translate="no">rotate</code> и <code class="notranslate" translate="no">scale</code>.</p>
<p>Стек матриц довольно прост в реализации. Мы создаём стек матриц. Мы создаём функции для
умножения верхней матрицы стека на матрицу перевода, поворота или масштабирования,
<a href="webgl-2d-matrices.html">используя функции, которые мы создали ранее</a>.</p>
<p>Вот реализация</p>
<p>Сначала конструктор и функции <code class="notranslate" translate="no">save</code> и <code class="notranslate" translate="no">restore</code></p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">function MatrixStack() {
  this.stack = [];

  // поскольку стек пуст, это поместит начальную матрицу в него
  this.restore();
}

// Извлекает верхний элемент стека, восстанавливая ранее сохранённую матрицу
MatrixStack.prototype.restore = function() {
  this.stack.pop();
  // Никогда не позволяем стеку быть полностью пустым
  if (this.stack.length &lt; 1) {
    this.stack[0] = m4.identity();
  }
};

// Помещает копию текущей матрицы в стек
MatrixStack.prototype.save = function() {
  this.stack.push(this.getCurrentMatrix());
};
</code></pre>
<p>Нам также нужны функции для получения и установки верхней матрицы</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">// Получает копию текущей матрицы (верх стека)
MatrixStack.prototype.getCurrentMatrix = function() {
  return this.stack[this.stack.length - 1].slice();  // создаёт копию
};

// Позволяет нам установить текущую матрицу
MatrixStack.prototype.setCurrentMatrix = function(m) {
  return this.stack[this.stack.length - 1] = m;
};

</code></pre>
<p>Наконец, нам нужно реализовать <code class="notranslate" translate="no">translate</code>, <code class="notranslate" translate="no">rotate</code> и <code class="notranslate" translate="no">scale</code>, используя наши
предыдущие матричные функции.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">// Переводит текущую матрицу
MatrixStack.prototype.translate = function(x, y, z) {
  if (z === undefined) {
    z = 0;
  }
  var m = this.getCurrentMatrix();
  this.setCurrentMatrix(m4.translate(m, x, y, z));
};

// Вращает текущую матрицу вокруг Z
MatrixStack.prototype.rotateZ = function(angleInRadians) {
  var m = this.getCurrentMatrix();
  this.setCurrentMatrix(m4.zRotate(m, angleInRadians));
};

// Масштабирует текущую матрицу
MatrixStack.prototype.scale = function(x, y, z) {
  if (z === undefined) {
    z = 1;
  }
  var m = this.getCurrentMatrix();
  this.setCurrentMatrix(m4.scale(m, x, y, z));
};
</code></pre>
<p>Обратите внимание, что мы используем 3D матричные математические функции. Мы могли бы просто использовать <code class="notranslate" translate="no">0</code> для <code class="notranslate" translate="no">z</code> при переводе и <code class="notranslate" translate="no">1</code>
для <code class="notranslate" translate="no">z</code> при масштабировании, но я обнаружил, что я так привык использовать 2D функции из Canvas 2D,
что часто забываю указать <code class="notranslate" translate="no">z</code>, и тогда код ломается, поэтому давайте сделаем <code class="notranslate" translate="no">z</code> необязательным</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">// Переводит текущую матрицу
MatrixStack.prototype.translate = function(x, y, z) {
  if (z === undefined) {
    z = 0;
  }
  var m = this.getCurrentMatrix();
  this.setCurrentMatrix(m4.translate(m, x, y, z));
};

...

// Масштабирует текущую матрицу
MatrixStack.prototype.scale = function(x, y, z) {
  if (z === undefined) {
    z = 1;
  }
  var m = this.getCurrentMatrix();
  this.setCurrentMatrix(m4.scale(m, x, y, z));
};
</code></pre>
<p>Используя наш <a href="webgl-2d-drawimage.html"><code class="notranslate" translate="no">drawImage</code> из предыдущего урока</a>, у нас были эти строки</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">// эта матрица будет конвертировать из пикселей в пространство отсечения
var matrix = m4.orthographic(
    0, gl.canvas.clientWidth, gl.canvas.clientHeight, 0, -1, 1);

// переводим наш четырёхугольник в dstX, dstY
matrix = m4.translate(matrix, dstX, dstY, 0);

// масштабируем наш четырёхугольник размером в 1 единицу
// от 1 единицы до dstWidth, dstHeight единиц
matrix = m4.scale(matrix, dstWidth, dstHeight, 1);
</code></pre>
<p>Нам просто нужно создать стек матриц</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">var matrixStack = new MatrixStack();
</code></pre>
<p>и умножить на верхнюю матрицу из нашего стека в</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">// эта матрица будет конвертировать из пикселей в пространство отсечения
var matrix = m4.orthographic(
    0, gl.canvas.clientWidth, gl.canvas.clientHeight, 0, -1, 1);

// Стек матриц находится в пикселях, поэтому он идёт после проекции
// выше, которая конвертировала наше пространство из пространства отсечения в пространство пикселей
matrix = m4.multiply(matrix, matrixStack.getCurrentMatrix());

// переводим наш четырёхугольник в dstX, dstY
matrix = m4.translate(matrix, dstX, dstY, 0);

// масштабируем наш четырёхугольник размером в 1 единицу
// от 1 единицы до dstWidth, dstHeight единиц
matrix = m4.scale(matrix, dstWidth, dstHeight, 1);
</code></pre>
<p>И теперь мы можем использовать это так же, как мы использовали бы это с Canvas 2D API.</p>
<p>Если вы не знаете, как использовать стек матриц, вы можете думать об этом как о
перемещении и ориентации начала координат холста. Так, например, по умолчанию в 2D холсте начало координат (0,0)
находится в левом верхнем углу.</p>
<p>Например, если мы переместим начало координат в центр холста, то рисование изображения в точке 0,0
будет рисовать его, начиная с центра холста</p>
<p>Давайте возьмём <a href="webgl-2d-drawimage.html">наш предыдущий пример</a> и просто нарисуем одно изображение</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">var textureInfo = loadImageAndCreateTextureInfo('resources/star.jpg');

function draw(time) {
  gl.clear(gl.COLOR_BUFFER_BIT);

  matrixStack.save();
  matrixStack.translate(gl.canvas.width / 2, gl.canvas.height / 2);
  matrixStack.rotateZ(time);

  drawImage(
    textureInfo.texture,
    textureInfo.width,
    textureInfo.height,
    0, 0);

  matrixStack.restore();
}
</code></pre>
<p>И вот это.</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-2d-matrixstack-01.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-2d-matrixstack-01.html" target="_blank">Нажмите, чтобы открыть в новом окне</a>
</div>

</p>
<p>вы можете видеть, что хотя мы передаём <code class="notranslate" translate="no">0, 0</code> в <code class="notranslate" translate="no">drawImage</code>, поскольку мы используем
<code class="notranslate" translate="no">matrixStack.translate</code> для перемещения начала координат в центр холста,
изображение рисуется и вращается вокруг этого центра.</p>
<p>Давайте переместим центр вращения в центр изображения</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">matrixStack.translate(gl.canvas.width / 2, gl.canvas.height / 2);
matrixStack.rotateZ(time);
matrixStack.translate(textureInfo.width / -2, textureInfo.height / -2);
</code></pre>
<p>И теперь оно вращается вокруг центра изображения в центре холста</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-2d-matrixstack-02.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-2d-matrixstack-02.html" target="_blank">Нажмите, чтобы открыть в новом окне</a>
</div>

</p>
<p>Давайте нарисуем то же изображение в каждом углу, вращаясь на разных углах</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">matrixStack.translate(gl.canvas.width / 2, gl.canvas.height / 2);
matrixStack.rotateZ(time);

matrixStack.save();
{
  matrixStack.translate(textureInfo.width / -2, textureInfo.height / -2);

  drawImage(
    textureInfo.texture,
    textureInfo.width,
    textureInfo.height,
    0, 0);

}
matrixStack.restore();

matrixStack.save();
{
  // Мы находимся в центре центрального изображения, поэтому переходим в левый верхний угол
  matrixStack.translate(textureInfo.width / -2, textureInfo.height / -2);
  matrixStack.rotateZ(Math.sin(time * 2.2));
  matrixStack.scale(0.2, 0.2);
  // Теперь мы хотим правый нижний угол изображения, которое мы собираемся нарисовать
  matrixStack.translate(-textureInfo.width, -textureInfo.height);

  drawImage(
    textureInfo.texture,
    textureInfo.width,
    textureInfo.height,
    0, 0);

}
matrixStack.restore();

matrixStack.save();
{
  // Мы находимся в центре центрального изображения, поэтому переходим в правый верхний угол
  matrixStack.translate(textureInfo.width / 2, textureInfo.height / -2);
  matrixStack.rotateZ(Math.sin(time * 2.3));
  matrixStack.scale(0.2, 0.2);
  // Теперь мы хотим левый нижний угол изображения, которое мы собираемся нарисовать
  matrixStack.translate(0, -textureInfo.height);

  drawImage(
    textureInfo.texture,
    textureInfo.width,
    textureInfo.height,
    0, 0);

}
matrixStack.restore();

matrixStack.save();
{
  // Мы находимся в центре центрального изображения, поэтому переходим в левый нижний угол
  matrixStack.translate(textureInfo.width / -2, textureInfo.height / 2);
  matrixStack.rotateZ(Math.sin(time * 2.4));
  matrixStack.scale(0.2, 0.2);
  // Теперь мы хотим правый верхний угол изображения, которое мы собираемся нарисовать
  matrixStack.translate(-textureInfo.width, 0);

  drawImage(
    textureInfo.texture,
    textureInfo.width,
    textureInfo.height,
    0, 0);

}
matrixStack.restore();

matrixStack.save();
{
  // Мы находимся в центре центрального изображения, поэтому переходим в правый нижний угол
  matrixStack.translate(textureInfo.width / 2, textureInfo.height / 2);
  matrixStack.rotateZ(Math.sin(time * 2.5));
  matrixStack.scale(0.2, 0.2);
  // Теперь мы хотим левый верхний угол изображения, которое мы собираемся нарисовать
  matrixStack.translate(0, 0);  // 0,0 означает, что эта строка на самом деле ничего не делает

  drawImage(
    textureInfo.texture,
    textureInfo.width,
    textureInfo.height,
    0, 0);

}
matrixStack.restore();
</code></pre>
<p>И вот это</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-2d-matrixstack-03.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-2d-matrixstack-03.html" target="_blank">Нажмите, чтобы открыть в новом окне</a>
</div>

</p>
<p>Если вы думаете о различных функциях стека матриц, <code class="notranslate" translate="no">translate</code>, <code class="notranslate" translate="no">rotateZ</code> и <code class="notranslate" translate="no">scale</code>
как о перемещении начала координат, то способ, которым я думаю об установке центра вращения, это
<em>куда мне нужно переместить начало координат, чтобы когда я вызываю drawImage, определённая часть
изображения была <strong>в</strong> предыдущем начале координат?</em></p>
<p>Другими словами, допустим, на холсте 400x300 я вызываю <code class="notranslate" translate="no">matrixStack.translate(210, 150)</code>.
В этот момент начало координат находится в точке 210, 150, и всё рисование будет относительно этой точки.
Если мы вызовем <code class="notranslate" translate="no">drawImage</code> с <code class="notranslate" translate="no">0, 0</code>, это то место, где будет нарисовано изображение.</p>
<img class="webgl_center" width="400" src="../resources/matrixstack-before.svg" />
<p>Допустим, мы хотим, чтобы центром вращения был правый нижний угол. В этом случае
куда нам нужно переместить начало координат, чтобы когда мы вызываем <code class="notranslate" translate="no">drawImage</code>,
точка, которую мы хотим сделать центром вращения, была в текущем начале координат?
Для правого нижнего угла текстуры это было бы <code class="notranslate" translate="no">-textureWidth, -textureHeight</code>,
так что теперь когда мы вызываем <code class="notranslate" translate="no">drawImage</code> с <code class="notranslate" translate="no">0, 0</code>, текстура будет нарисована здесь,
и её правый нижний угол находится в предыдущем начале координат.</p>
<img class="webgl_center" width="400" src="../resources/matrixstack-after.svg" />
<p>В любой момент то, что мы делали до этого в стеке матриц, не имеет значения. Мы сделали кучу
вещей, чтобы переместить или масштабировать или повернуть начало координат, но прямо перед тем, как мы вызываем
<code class="notranslate" translate="no">drawImage</code>, где бы ни находилось начало координат в данный момент, это не имеет значения.
Это новое начало координат, поэтому нам просто нужно решить, куда переместить это начало координат
относительно того места, где текстура была бы нарисована, если бы у нас ничего не было перед ней в стеке.</p>
<p>Вы можете заметить, что стек матриц очень похож на <a href="webgl-scene-graph.html">граф сцены, который мы
рассматривали ранее</a>. Граф сцены имел дерево узлов,
и когда мы проходили по дереву, мы умножали каждый узел на узел его родителя.
Стек матриц - это эффективно другая версия того же процесса.</p>

    </div>
    <div class="lesson-sidebar">
        <select class="language">
    <option value="/webgl/lessons/webgl-2d-matrix-stack.html" >English</a>
    <option value="/webgl/lessons/de/webgl-2d-matrix-stack.html" >Deutsch</a>
    <option value="/webgl/lessons/ja/webgl-2d-matrix-stack.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-2d-matrix-stack.html" >한국어</a>
    <option value="/webgl/lessons/pt-br/webgl-2d-matrix-stack.html" >Português Brasileiro</a>
    <option value="/webgl/lessons/ru/webgl-2d-matrix-stack.html" selected>Русский</a>
    <option value="/webgl/lessons/zh_cn/webgl-2d-matrix-stack.html" >简体中文</a>
</select>


        <div id="toc">
          <ul>  <li>Основы</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-getting-webgl2.html">Как использовать WebGL2</a></li>
<li><a href="/webgl/lessons/ru/webgl-fundamentals.html">Основы</a></li>
<li><a href="/webgl/lessons/ru/webgl-how-it-works.html">Как это работает</a></li>
<li><a href="/webgl/lessons/ru/webgl-shaders-and-glsl.html">Шейдеры и GLSL</a></li>
<li><a href="/webgl/lessons/resources/webgl-state-diagram.html">WebGL2 Диаграмма состояния</a></li>
        </ul>
  <li>WebGL2 vs WebGL1</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl2-whats-new.html">Что нового в WebGL2</a></li>
<li><a href="/webgl/lessons/ru/webgl1-to-webgl2.html">Переход с WebGL1 на WebGL2</a></li>
<li><a href="/webgl/lessons/ru/webgl1-to-webgl2-fundamentals.html">Отличия от WebGLFundamentals.org до WebGL2Fundamentals.org</a></li>
        </ul>
  <li>Обработка изображений</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-image-processing.html">Обработка изображений</a></li>
<li><a href="/webgl/lessons/ru/webgl-image-processing-continued.html">Продвинутая обработка изображений</a></li>
        </ul>
  <li>2D трансформации, повороты, масштабирование и матричные операции</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-2d-translation.html">2D Трансляция</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-rotation.html">2D Вращение</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-scale.html">2D Масштабирование</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-matrices.html">2D Матрицы</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-orthographic.html">Ортографическая 3D</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-perspective.html">3D Перспектива</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-camera.html">3D - Камеры</a></li>
<li><a href="/webgl/lessons/ru/webgl-matrix-naming.html">3D - Именование матриц</a></li>
        </ul>
  <li>Освещение</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-lighting-directional.html">Направленное освещение</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-lighting-point.html">Точечное освещение</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-lighting-spot.html">Прожекторное освещение</a></li>
        </ul>
  <li>Организация и рефакторинг</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-less-code-more-fun.html">Меньше кода, больше удовольствия</a></li>
<li><a href="/webgl/lessons/ru/webgl-drawing-multiple-things.html">Рисование множественных объектов</a></li>
<li><a href="/webgl/lessons/ru/webgl-scene-graph.html">Графы сцен</a></li>
        </ul>
  <li>Геометрия</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-geometry-lathe.html">3D Геометрия - Токарная обработка</a></li>
<li><a href="/webgl/lessons/ru/webgl-load-obj.html">Загрузка .obj файлов</a></li>
<li><a href="/webgl/lessons/ru/webgl-load-obj-w-mtl.html">Загрузка .obj с .mtl файлами</a></li>
        </ul>
  <li>Текстуры</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-textures.html">Текстуры</a></li>
<li><a href="/webgl/lessons/ru/webgl-data-textures.html">Data Textures</a></li>
<li><a href="/webgl/lessons/ru/webgl-2-textures.html">Использование 2 или более текстур</a></li>
<li><a href="/webgl/lessons/ru/webgl-cors-permission.html">Cross Origin Images</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-perspective-correct-texturemapping.html">Перспективно-корректное наложение текстур</a></li>
<li><a href="/webgl/lessons/ru/webgl-planar-projection-mapping.html">Планарное и перспективное проекционное отображение</a></li>
        </ul>
  <li>Рендеринг в текстуру</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-render-to-texture.html">Рендеринг в текстуру</a></li>
        </ul>
  <li>Тени</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-shadows.html">Тени</a></li>
        </ul>
  <li>Техники</li>
        <ul>
            <li>2D</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-2d-drawimage.html">2D - DrawImage</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-matrix-stack.html">2D - Стек Матриц</a></li>
<li><a href="/webgl/lessons/ru/webgl-sprites.html">Спрайты</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-cube-maps.html">Кубические карты</a></li>
<li><a href="/webgl/lessons/ru/webgl-environment-maps.html">Карты окружения</a></li>
<li><a href="/webgl/lessons/ru/webgl-skybox.html">Скайбоксы</a></li>
<li><a href="/webgl/lessons/ru/webgl-skinning.html">Скининг</a></li>
<li><a href="/webgl/lessons/ru/webgl-fog.html">Fog</a></li>
<li><a href="/webgl/lessons/ru/webgl-picking.html">Выбор объектов (клик по объектам)</a></li>
        </ul>
  <li>Текст</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-text-html.html">Текст - HTML</a></li>
<li><a href="/webgl/lessons/ru/webgl-text-canvas2d.html">Текст - Canvas 2D</a></li>
<li><a href="/webgl/lessons/ru/webgl-text-texture.html">Текст - Использование текстуры</a></li>
<li><a href="/webgl/lessons/ru/webgl-text-glyphs.html">Текст - Использование текстуры глифов</a></li>
        </ul>
  <li>GPGPU</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-gpgpu.html">GPGPU</a></li>
        </ul>
        </ul>
  <li>Советы</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-smallest-programs.html">Самые маленькие программы</a></li>
<li><a href="/webgl/lessons/ru/webgl-drawing-without-data.html">Рисование без данных</a></li>
<li><a href="/webgl/lessons/ru/webgl-shadertoy.html">Shadertoy</a></li>
<li><a href="/webgl/lessons/ru/webgl-pulling-vertices.html">Вытягивание вершин</a></li>
        </ul>
  <li>Оптимизация</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-indexed-vertices.html">Индексированные вершины (gl.drawElements)</a></li>
<li><a href="/webgl/lessons/ru/webgl-instanced-drawing.html">Инстансинг (Instanced Drawing)</a></li>
        </ul>
  <li>Разное</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-setup-and-installation.html">Настройка и установка</a></li>
<li><a href="/webgl/lessons/ru/webgl-boilerplate.html">Boilerplate</a></li>
<li><a href="/webgl/lessons/ru/webgl-resizing-the-canvas.html">Изменение размера Canvas</a></li>
<li><a href="/webgl/lessons/ru/webgl-animation.html">Анимация</a></li>
<li><a href="/webgl/lessons/ru/webgl-points-lines-triangles.html">Точки, линии и треугольники</a></li>
<li><a href="/webgl/lessons/ru/webgl-multiple-views.html">Множественные виды, множественные canvas</a></li>
<li><a href="/webgl/lessons/ru/webgl-visualizing-the-camera.html">Визуализация камеры</a></li>
<li><a href="/webgl/lessons/ru/webgl-and-alpha.html">WebGL2 и альфа-канал</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-vs-3d-library.html">2D против 3D библиотек</a></li>
<li><a href="/webgl/lessons/ru/webgl-anti-patterns.html">Анти-паттерны</a></li>
<li><a href="/webgl/lessons/ru/webgl-matrix-vs-math.html">WebGL2 Матрицы против математических матриц</a></li>
<li><a href="/webgl/lessons/ru/webgl-precision-issues.html">Проблемы точности</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#screenshot">Скриншот канваса</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#preservedrawingbuffer">Как не очищать канвас</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#tabindex">Получение ввода с клавиатуры</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#html-background">Использование WebGL2 как фона в HTML</a></li>
<li><a href="/webgl/lessons/ru/webgl-cross-platform-issues.html">Cross Platform Issues</a></li>
<li><a href="/webgl/lessons/ru/webgl-qna.html">Questions and Answers</a></li>
        </ul>
  <li>Справочник</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-attributes.html">Атрибуты</a></li>
<li><a href="/webgl/lessons/ru/webgl-texture-units.html">Текстурные юниты</a></li>
<li><a href="/webgl/lessons/ru/webgl-framebuffers.html">Framebuffers</a></li>
<li><a href="/webgl/lessons/ru/webgl-readpixels.html">readPixels</a></li>
<li><a href="/webgl/lessons/ru/webgl-references.html">Ссылки</a></li>
        </ul></ul>
<ul>
  <li><a href="/docs/">API документация</a></li>
  <li><a href="https://twgljs.org">TWGL, легковесная библиотека-помощник для WebGL</a></li>
  <li><a href="https://github.com/gfxfundamentals/webgl2-fundamentals">GitHub</a></li>
</ul>
        </div>
    </div>
    <div class="lesson-comments">
        
<div>Есть предложения или замечания? <a href="https://github.com/gfxfundamentals/webgl2-fundamentals/issues">Создайте issue на GitHub</a>.</div>
  

        <div id="disqus_thread"></div>
        <script>
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'webgl2fundamentals'; // required: replace example with your forum shortname
            var disqus_identifier = 'WebGL2 Реализация Стекла Матриц';
            var disqus_title = 'WebGL2 Реализация Стекла Матриц';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                if (window.location.hostname.indexOf("webgl2fundamentals.org") < 0) {
                    return;
                }
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>
</div>
</body>
<script>
const settings = {
  contribTemplate: "Спасибо <a href=\"${html_url}\"><img src=\"${avatar_url}\"> ${login}</a><br>за <a href=\"https://github.com/${owner}/${repo}/commits?author=${login}\">${contributions} вкладов</a>",
  owner: "gfxfundamentals",
  repo: "webgl2-fundamentals",
};
</script>
<script src="/contributors.js"></script>
<script src="/3rdparty/jquery-1.11.2.min.js"></script>
<script src="/webgl/lessons/resources/prettify.js"></script>
<script src="/webgl/lessons/resources/lesson.js" type="module"></script>
<script>
</script>


</html>



