<!DOCTYPE html>
<!-- this file is auto-generated from webgl/lessons/ru/webgl-anti-patterns.md. Do not edited directly -->
<!--
Copyright 2021, GFXFundamentals.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

*   Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.

*   Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the following disclaimer
    in the documentation and/or other materials provided with the
    distribution.

*   Neither the name of GFXFundamentals. nor the names of his
    contributors may be used to endorse or promote products derived from
    this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Что не следует делать в WebGL, почему не следует и что делать вместо этого">
<meta name="keywords" content="webgl webgl2 graphics">
<meta name="thumbnail" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-anti-patterns_ru.jpg">

<meta property="og:title" content="WebGL2 Анти-паттерны">
<meta property="og:type" content="website">
<meta property="og:image" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-anti-patterns_ru.jpg">
<meta property="og:description" content="Что не следует делать в WebGL, почему не следует и что делать вместо этого">
<meta property="og:url" content="https://webgl2fundamentals.org/webgl/lessons/ru/webgl-anti-patterns.html">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@greggman">
<meta name="twitter:creator" content="@greggman">
<meta name="twitter:domain" content="webgl2fundamentals.org">
<meta name="twitter:title" content="WebGL2 Анти-паттерны">
<meta name="twitter:url" content="https://webgl2fundamentals.org/webgl/lessons/ru/webgl-anti-patterns.html">
<meta name="twitter:description" content="Что не следует делать в WebGL, почему не следует и что делать вместо этого">
<meta name="twitter:image:src" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-anti-patterns_ru.jpg">

<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@graph":[
    {
      "@type":"WebSite",
      "@id":"https://webgl2fundamentals.org/#website",
      "url":"https://webgl2fundamentals.org/",
      "name":"Webgl2Fundamentals"
    },
    {
      "@type":"ImageObject",
      "@id":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-anti-patterns.html#primaryimage",
      "url":"https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-anti-patterns_ru.jpg",
      "width":1200,
      "height":630
    },
    {
      "@type":"WebPage",
      "@id":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-anti-patterns.html#webpage",
      "url":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-anti-patterns.html",
      "inLanguage":"ru",
      "name":"WebGL2 Анти-паттерны",
      "keywords":"webgl webgl2 graphics programming",
      "isPartOf":{
        "@id":"https://webgl2fundamentals.org/#website"
      },
      "primaryImageOfPage":{
        "@id":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-anti-patterns.html#primaryimage"
      }
    }
  ]
}
</script>


<title>WebGL2 Анти-паттерны</title>
<link href="/webgl/lessons/resources/webgl2fundamentals-icon.png" rel="shortcut icon" type="image/png">
<link rel="stylesheet" href="/webgl/lessons/lang.css">
<link rel="stylesheet" href="/webgl/lessons/resources/lesson.css">

  <link rel="alternate" hreflang="en" href="https://webglfundamentals.org/webgl/lessons/webgl-anti-patterns.html">
  <link rel="alternate" hreflang="de" href="https://webglfundamentals.org/webgl/lessons/de/webgl-anti-patterns.html">
  <link rel="alternate" hreflang="ja" href="https://webglfundamentals.org/webgl/lessons/ja/webgl-anti-patterns.html">
  <link rel="alternate" hreflang="ko" href="https://webglfundamentals.org/webgl/lessons/ko/webgl-anti-patterns.html">
  <link rel="alternate" hreflang="pt-br" href="https://webglfundamentals.org/webgl/lessons/pt-br/webgl-anti-patterns.html">
  <link rel="alternate" hreflang="ru" href="https://webglfundamentals.org/webgl/lessons/ru/webgl-anti-patterns.html">
  <link rel="alternate" hreflang="zh_cn" href="https://webglfundamentals.org/webgl/lessons/zh_cn/webgl-anti-patterns.html">




</head>
<body>
<div class="webgl_navbar">
  <div>
    <select class="language">
    <option value="/webgl/lessons/webgl-anti-patterns.html" >English</a>
    <option value="/webgl/lessons/de/webgl-anti-patterns.html" >Deutsch</a>
    <option value="/webgl/lessons/ja/webgl-anti-patterns.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-anti-patterns.html" >한국어</a>
    <option value="/webgl/lessons/pt-br/webgl-anti-patterns.html" >Português Brasileiro</a>
    <option value="/webgl/lessons/ru/webgl-anti-patterns.html" selected>Русский</a>
    <option value="/webgl/lessons/zh_cn/webgl-anti-patterns.html" >简体中文</a>
</select>


    <a href="#toc">Содержание</a>
    <input type="search" placeholder="?" id="search">
  </div>
</div>
<div class="webgl_header">
  <h1><a href="/webgl/lessons/ru/">WebGL2Fundamentals.org</a></h1>
<style>
#forkongithub>div {
    background: #000;
    color: #fff;
    font-family: arial,sans-serif;
    text-align: center;
    font-weight: bold;
    padding: 5px 40px;
    font-size: 0.9rem;
    line-height: 1.3rem;
    position: relative;
    transition: 0.5s;
    display: block;
    width: 400px;
    position: absolute;
    top: 0;
    right: 0;
    transform: translateX(200px) rotate(45deg) translate(10px,70px);
    box-shadow: 4px 4px 10px rgba(0,0,0,0.8);
    pointer-events: auto;
}
#forkongithub a {
  text-decoration: none;
  color: #fff;
}
#forkongithub>div:hover {
    background: #c11;
    color: #fff;
}
#forkongithub .contributors {
  font-size: 0.75rem;
  background: rgba(255,255,255,0.2);
  line-height: 1.2;
  padding: 0.1em;
}
#forkongithub>div::before,#forkongithub>div::after {
    content: "";
    width: 100%;
    display: block;
    position: absolute;
    top: 1px;
    left: 0;
    height: 1px;
    background: #fff;
}
#forkongithub>div::after {
    bottom: 1px;
    top: auto;
}

#forkongithub{
    z-index: 9999;
    /* needed for firefox */
    overflow: hidden;
    width: 300px;
    height: 300px;
    position: absolute;
    right: 0;
    top: 0;
    pointer-events: none;
}
#forkongithub svg{
  width: 1em;
  height: 1em;
  vertical-align: middle;
}
#forkongithub img {
  width: 1em;
  height: 1em;
  border-radius: 100%;
  vertical-align: middle;
}

@media (max-width: 900px) {
    #forkongithub>div {
        line-height: 1.2rem;
    }
}
@media (max-width: 700px) {
  #forkongithub {
    display: none;
  }
}
@media (max-width: 410px) {
    #forkongithub>div {
        font-size: 0.7rem;
        transform: translateX(150px) rotate(45deg) translate(20px,40px);
    }
}

</style>
<div id="forkongithub"><div><div><a href="https://github.com/gfxfundamentals/webgl2-fundamentals">Fix, Fork, Contribute <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 136 133" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(3.92891,0,0,3.92891,67.867,129.125)">
        <path d="M0,-31.904C-8.995,-31.904 -16.288,-24.611 -16.288,-15.614C-16.288,-8.417 -11.621,-2.312 -5.148,-0.157C-4.333,-0.008 -4.036,-0.511 -4.036,-0.943C-4.036,-1.329 -4.05,-2.354 -4.058,-3.713C-8.589,-2.729 -9.545,-5.897 -9.545,-5.897C-10.286,-7.779 -11.354,-8.28 -11.354,-8.28C-12.833,-9.29 -11.242,-9.27 -11.242,-9.27C-9.607,-9.155 -8.747,-7.591 -8.747,-7.591C-7.294,-5.102 -4.934,-5.821 -4.006,-6.238C-3.858,-7.29 -3.438,-8.008 -2.972,-8.415C-6.589,-8.826 -10.392,-10.224 -10.392,-16.466C-10.392,-18.244 -9.757,-19.698 -8.715,-20.837C-8.883,-21.249 -9.442,-22.905 -8.556,-25.148C-8.556,-25.148 -7.188,-25.586 -4.076,-23.478C-2.777,-23.84 -1.383,-24.02 0.002,-24.026C1.385,-24.02 2.779,-23.84 4.08,-23.478C7.19,-25.586 8.555,-25.148 8.555,-25.148C9.444,-22.905 8.885,-21.249 8.717,-20.837C9.761,-19.698 10.392,-18.244 10.392,-16.466C10.392,-10.208 6.583,-8.831 2.954,-8.428C3.539,-7.925 4.06,-6.931 4.06,-5.411C4.06,-3.234 4.04,-1.477 4.04,-0.943C4.04,-0.507 4.333,0 5.16,-0.159C11.628,-2.318 16.291,-8.419 16.291,-15.614C16.291,-24.611 8.997,-31.904 0,-31.904" style="fill:white;"/>
    </g>
</svg>
</a></div></div></div>

</div>


<div class="container">
  <div class="lesson-title">
    <h1>WebGL2 Анти-паттерны</h1>
  </div>
  <div class="lesson">
    <div class="lesson-main">
      <p>Это список анти-паттернов для WebGL. Анти-паттерны - это вещи, которых следует избегать</p>
<ol>
<li>
<p><a id="viewportwidth"></a>Добавление <code class="notranslate" translate="no">viewportWidth</code> и <code class="notranslate" translate="no">viewportHeight</code> в <code class="notranslate" translate="no">WebGLRenderingContext</code></p>
<p>Некоторые коды добавляют свойства для ширины и высоты viewport
и прикрепляют их к <code class="notranslate" translate="no">WebGLRenderingContext</code> примерно так:</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">gl = canvas.getContext(&quot;webgl2&quot;);
gl.viewportWidth = canvas.width;    // ПЛОХО!!!
gl.viewportHeight = canvas.height;  // ПЛОХО!!!
</code></pre>
<p>Затем они могут делать что-то вроде этого:</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">gl.viewport(0, 0, gl.viewportWidth, gl.viewportHeight);
</code></pre>
<p><strong>Почему это плохо:</strong></p>
<p>Это объективно плохо, потому что теперь у вас есть 2 свойства, которые нужно обновлять
каждый раз, когда вы изменяете размер canvas. Например, если вы измените размер
canvas, когда пользователь изменяет размер окна, <code class="notranslate" translate="no">gl.viewportWidth</code> и <code class="notranslate" translate="no">gl.viewportHeight</code>
будут неправильными, если вы не установите их снова.</p>
<p>Это субъективно плохо, потому что любой новый WebGL программист взглянет на ваш код
и, вероятно, подумает, что <code class="notranslate" translate="no">gl.viewportWidth</code> и <code class="notranslate" translate="no">gl.viewportHeight</code> являются частью спецификации WebGL,
что будет путать их месяцами.</p>
<p><strong>Что делать вместо этого:</strong></p>
<p>Зачем создавать себе больше работы? WebGL контекст имеет доступ к своему canvas,
и у него есть размер.</p>
<pre class="prettyprint">
gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);
</pre>
<p>Контекст также имеет свою ширину и высоту прямо на нем.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">// Когда вам нужно установить viewport в соответствии с размером drawingBuffer canvas,
// это всегда будет правильно
gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);
</code></pre>
<p>Еще лучше, это будет обрабатывать крайние случаи, тогда как использование <code class="notranslate" translate="no">gl.canvas.width</code>
и <code class="notranslate" translate="no">gl.canvas.height</code> не будет. <a href="#drawingbuffer">Что касается почему, см. здесь</a>.</p>
</li>
<li>
<p><a id="canvaswidth"></a>Использование <code class="notranslate" translate="no">canvas.width</code> и <code class="notranslate" translate="no">canvas.height</code> для соотношения сторон</p>
<p>Часто код использует <code class="notranslate" translate="no">canvas.width</code> и <code class="notranslate" translate="no">canvas.height</code> для соотношения сторон, как здесь:</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">var aspect = canvas.width / canvas.height;
perspective(fieldOfView, aspect, zNear, zFar);
</code></pre>
<p><strong>Почему это плохо:</strong></p>
<p>Ширина и высота canvas не имеют ничего общего с размером, в котором canvas отображается.
CSS контролирует размер, в котором отображается canvas.</p>
<p><strong>Что делать вместо этого:</strong></p>
<p>Используйте <code class="notranslate" translate="no">canvas.clientWidth</code> и <code class="notranslate" translate="no">canvas.clientHeight</code>. Эти значения говорят вам, какого
размера ваш canvas фактически отображается на экране. Используя эти значения,
вы всегда получите правильное соотношение сторон независимо от настроек CSS.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">var aspect = canvas.clientWidth / canvas.clientHeight;
perspective(projectionMatrix, fieldOfView, aspect, zNear, zFar);
</code></pre>
<p>Вот примеры canvas, чьи drawingbuffer’ы имеют одинаковый размер (<code class="notranslate" translate="no">width=&quot;400&quot; height=&quot;300&quot;</code>),
но используя CSS мы сказали браузеру отображать canvas другого размера.
Обратите внимание, что образцы оба отображают ‘F’ в правильном соотношении сторон.</p>
<p><div class="webgl_diagram_container">
  <iframe class="webgl_example " style="width: 150px; height: 200px;" src="/webgl/lessons/../webgl-canvas-clientwidth-clientheight.html"></iframe>
</div>

</p>
<p></p>
<div class="webgl_diagram_container">
  <iframe class="webgl_example " style="width: 400px; height: 150px;" src="/webgl/lessons/../webgl-canvas-clientwidth-clientheight.html"></iframe>
</div>


<p>Если бы мы использовали <code class="notranslate" translate="no">canvas.width</code> и <code class="notranslate" translate="no">canvas.height</code>, это было бы не так.</p>
<p><div class="webgl_diagram_container">
  <iframe class="webgl_example " style="width: 150px; height: 200px;" src="/webgl/lessons/../webgl-canvas-width-height.html"></iframe>
</div>

</p>
<p></p>
<div class="webgl_diagram_container">
  <iframe class="webgl_example " style="width: 400px; height: 150px;" src="/webgl/lessons/../webgl-canvas-width-height.html"></iframe>
</div>


</li>
<li>
<p><a id="innerwidth"></a>Использование <code class="notranslate" translate="no">window.innerWidth</code> и <code class="notranslate" translate="no">window.innerHeight</code> для вычисления чего-либо</p>
<p>Многие WebGL программы используют <code class="notranslate" translate="no">window.innerWidth</code> и <code class="notranslate" translate="no">window.innerHeight</code> во многих местах.
Например:</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">canvas.width = window.innerWidth;                    // ПЛОХО!!
canvas.height = window.innerHeight;                  // ПЛОХО!!
</code></pre>
<p><strong>Почему это плохо:</strong></p>
<p>Это не переносимо. Да, это может работать для WebGL страниц, где вы хотите сделать canvas
заполняющим экран. Проблема возникает, когда вы этого не делаете. Может быть, вы решите сделать статью
как эти уроки, где ваш canvas - это просто небольшая диаграмма на большей странице.
Или, может быть, вам нужен редактор свойств сбоку или счет для игры. Конечно, вы можете исправить свой код
для обработки этих случаев, но почему бы просто не написать его так, чтобы он работал в этих случаях с самого начала?
Тогда вам не придется изменять какой-либо код, когда вы копируете его в новый проект или используете старый
проект по-новому.</p>
<p><strong>Что делать вместо этого:</strong></p>
<p>Вместо того чтобы бороться с веб-платформой, используйте веб-платформу так, как она была предназначена для использования.
Используйте CSS и <code class="notranslate" translate="no">clientWidth</code> и <code class="notranslate" translate="no">clientHeight</code>.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">var width = gl.canvas.clientWidth;
var height = gl.canvas.clientHeight;

gl.canvas.width = width;
gl.canvas.height = height;
</code></pre>
<p>Вот 9 случаев. Все они используют точно такой же код. Обратите внимание, что ни один из них
не ссылается на <code class="notranslate" translate="no">window.innerWidth</code> или <code class="notranslate" translate="no">window.innerHeight</code>.</p>
<p><a href="../../webgl-same-code-canvas-fullscreen.html" target="_blank">Страница только с canvas, использующая CSS для полноэкранного режима</a></p>
<p><a href="../../webgl-same-code-canvas-partscreen.html" target="_blank">Страница с canvas, установленным на использование 70% ширины, чтобы было место для элементов управления редактора</a></p>
<p><a href="../../webgl-same-code-canvas-embedded.html" target="_blank">Страница с canvas, встроенным в абзац</a></p>
<p><a href="../../webgl-same-code-canvas-embedded-border-box.html" target="_blank">Страница с canvas, встроенным в абзац, использующим <code class="notranslate" translate="no">box-sizing: border-box;</code></a></p>
<p><code class="notranslate" translate="no">box-sizing: border-box;</code> заставляет границы и отступы занимать место от элемента, на котором они определены, а не снаружи него. Другими словами, в
обычном режиме box-sizing элемент 400x300 пикселей с 15-пиксельной границей имеет 400x300 пикселей пространства содержимого, окруженного 15-пиксельной границей, что делает его общий размер
430x330 пикселей. В режиме box-sizing: border-box граница идет изнутри, так что тот же элемент останется 400x300 пикселей, содержимое окажется
370x270. Это еще одна причина, почему использование <code class="notranslate" translate="no">clientWidth</code> и <code class="notranslate" translate="no">clientHeight</code> так важно. Если вы установите границу, скажем, <code class="notranslate" translate="no">1em</code>, у вас не будет
способа узнать, какого размера окажется ваш canvas. Это было бы разным с разными шрифтами на разных машинах или разных браузерах.</p>
<p><a href="../../webgl-same-code-container-fullscreen.html" target="_blank">Страница только с контейнером, использующим CSS для полноэкранного режима, в который код вставит canvas</a></p>
<p><a href="../../webgl-same-code-container-partscreen.html" target="_blank">Страница с контейнером, установленным на использование 70% ширины, чтобы было место для элементов управления редактора, в который код вставит canvas</a></p>
<p><a href="../../webgl-same-code-container-embedded.html" target="_blank">Страница с контейнером, встроенным в абзац, в который код вставит canvas</a></p>
<p><a href="../../webgl-same-code-container-embedded-border-box.html" target="_blank">Страница с контейнером, встроенным в абзац, использующим <code class="notranslate" translate="no">box-sizing: border-box;</code>, в который код вставит canvas</a></p>
<p><a href="../../webgl-same-code-body-only-fullscreen.html" target="_blank">Страница без элементов с настройкой CSS для полноэкранного режима, в которую код вставит canvas</a></p>
<p>Опять же, суть в том, что если вы принимаете веб и пишете свой код, используя методы выше, вам не придется изменять какой-либо код, когда вы столкнетесь с разными случаями использования.</p>
</li>
<li>
<p><a id="resize"></a>Использование события <code class="notranslate" translate="no">'resize'</code> для изменения размера вашего canvas.</p>
<p>Некоторые приложения проверяют событие <code class="notranslate" translate="no">'resize'</code> окна, как здесь, для изменения размера их canvas.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">window.addEventListener('resize', resizeTheCanvas);
</code></pre>
<p>или так:</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">window.onresize = resizeTheCanvas;
</code></pre>
<p><strong>Почему это плохо:</strong></p>
<p>Это не плохо само по себе, скорее, для <em>большинства</em> WebGL программ это подходит для меньшего количества случаев использования.
Конкретно <code class="notranslate" translate="no">'resize'</code> работает только когда окно изменяет размер. Это не работает,
если canvas изменяет размер по какой-то другой причине. Например, скажем, вы делаете
3D редактор. У вас canvas слева и настройки справа. Вы сделали так, что есть перетаскиваемая полоса,
разделяющая 2 части, и вы можете перетащить эту полосу, чтобы сделать область настроек больше или меньше.
В этом случае вы не получите никаких событий <code class="notranslate" translate="no">'resize'</code>. Аналогично, если у вас есть страница, где другое содержимое
добавляется или удаляется, и canvas изменяет размер, когда браузер перераспределяет страницу, вы не получите событие resize.</p>
<p><strong>Что делать вместо этого:</strong></p>
<p>Как и многие решения анти-паттернов выше, есть способ написать ваш код
так, чтобы он просто работал для большинства случаев. Для WebGL приложений, которые постоянно рисуют каждый кадр,
решение - проверять, нужно ли изменять размер каждый раз, когда вы рисуете, как здесь:</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">function resizeCanvasToDisplaySize() {
  var width = gl.canvas.clientWidth;
  var height = gl.canvas.clientHeight;
  if (gl.canvas.width != width ||
      gl.canvas.height != height) {
     gl.canvas.width = width;
     gl.canvas.height = height;
  }
}

function render() {
   resizeCanvasToDisplaySize();
   drawStuff();
   requestAnimationFrame(render);
}
render();
</code></pre>
<p>Теперь в любом из этих случаев ваш canvas будет масштабироваться до правильного размера. Нет необходимости
изменять какой-либо код для разных случаев. Например, используя тот же код из #3 выше,
вот редактор с изменяемой областью редактирования.</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-same-code-resize.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-same-code-resize.html" target="_blank">Нажмите, чтобы открыть в новом окне</a>
</div>

</p>
<p>Не было бы событий resize для этого случая, ни для любого другого, где canvas изменяет размер
на основе размера других динамических элементов на странице.</p>
<p>Для WebGL приложений, которые не перерисовывают каждый кадр, код выше все еще правильный, вам просто нужно
запустить перерисовку в каждом случае, где canvas может потенциально изменить размер. Один простой способ - использовать <code class="notranslate" translate="no">ResizeObserver</code></p>
<pre class="prettyprint">
const resizeObserver = new ResizeObserver(render);
resizeObserver.observe(gl.canvas, {box: 'content-box'});
</pre>
</li>
<li>
<p><a id="properties"></a>Добавление свойств к <code class="notranslate" translate="no">WebGLObject</code>’ам</p>
<p><code class="notranslate" translate="no">WebGLObject</code>’ы - это различные типы ресурсов в WebGL, такие как <code class="notranslate" translate="no">WebGLBuffer</code>
или <code class="notranslate" translate="no">WebGLTexture</code>. Некоторые приложения добавляют свойства к этим объектам. Например, код вроде этого:</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">var buffer = gl.createBuffer();
buffer.itemSize = 3;        // ПЛОХО!!
buffer.numComponents = 75;  // ПЛОХО!!

var program = gl.createProgram();
...
program.u_matrixLoc = gl.getUniformLocation(program, &quot;u_matrix&quot;);  // ПЛОХО!!
</code></pre>
<p><strong>Почему это плохо:</strong></p>
<p>Причина, по которой это плохо, в том, что WebGL может “потерять контекст”. Это может произойти по любой
причине, но самая распространенная причина - если браузер решит, что используется слишком много ресурсов GPU,
он может намеренно потерять контекст на некоторых <code class="notranslate" translate="no">WebGLRenderingContext</code>’ах, чтобы освободить место.
WebGL программы, которые хотят всегда работать, должны обрабатывать это. Google Maps обрабатывает это, например.</p>
<p>Проблема с кодом выше в том, что когда контекст потерян, WebGL функции создания, такие как
<code class="notranslate" translate="no">gl.createBuffer()</code> выше, будут возвращать <code class="notranslate" translate="no">null</code>. Это эффективно делает код таким:</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">var buffer = null;
buffer.itemSize = 3;        // ОШИБКА!
buffer.numComponents = 75;  // ОШИБКА!
</code></pre>
<p>Это, вероятно, убьет ваше приложение с ошибкой вроде:</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">TypeError: Cannot set property 'itemSize' of null
</code></pre>
<p>Хотя многим приложениям все равно, если они умрут, когда контекст потерян, кажется плохой идеей
писать код, который придется исправлять позже, если разработчики когда-либо решат обновить их
приложение для обработки событий потери контекста.</p>
<p><strong>Что делать вместо этого:</strong></p>
<p>Если вы хотите держать <code class="notranslate" translate="no">WebGLObject</code>’ы и некоторую информацию о них вместе, один способ был бы
использовать JavaScript объекты. Например:</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">var bufferInfo = {
  id: gl.createBuffer(),
  itemSize: 3,
  numComponents: 75,
};

var programInfo = {
  id: program,
  u_matrixLoc: gl.getUniformLocation(program, &quot;u_matrix&quot;),
};
</code></pre>
<p>Лично я бы предложил <a href="webgl-less-code-more-fun.html">использовать несколько простых помощников, которые делают написание WebGL
намного проще</a>.</p>
</li>
</ol>
<p>Это несколько из того, что я считаю WebGL анти-паттернами в коде, который я видел в сети.
Надеюсь, я объяснил, почему их следует избегать, и дал решения, которые просты и полезны.</p>
<div class="webgl_bottombar"><a id="drawingbuffer"></a><h3>Что такое drawingBufferWidth и drawingBufferHeight?</h3>
<p>
GPU имеют ограничение на то, насколько большим прямоугольником пикселей (текстура, renderbuffer) они могут поддерживать. Часто этот
размер - это следующая степень 2 больше, чем какое-либо распространенное разрешение монитора было во время создания GPU.
Например, если GPU был разработан для поддержки экранов 1280x1024, он может иметь ограничение размера 2048.
Если он был разработан для экранов 2560x1600, он может иметь ограничение 4096.
</p><p>
Это кажется разумным, но что происходит, если у вас несколько мониторов? Скажем, у меня есть GPU с ограничением
2048, но у меня два монитора 1920x1080. Пользователь открывает окно браузера с WebGL страницей, затем
растягивает это окно на оба монитора. Ваш код пытается установить <code class="notranslate" translate="no">canvas.width</code> в
<code class="notranslate" translate="no">canvas.clientWidth</code>, который в этом случае равен 3840. Что должно произойти?
</p>
<p>Сразу на ум приходят только 3 варианта</p>
<ol>
<li>
 <p>Выбросить исключение.</p>
 <p>Это кажется плохим. Большинство веб-приложений не будут проверять это, и приложение упадет.
 Если у приложения были пользовательские данные, пользователь только что потерял свои данные</p>
</li>
<li>
 <p>Ограничить размер canvas до лимита GPU</p>
 <p>Проблема с этим решением в том, что это также
 вероятно приведет к краху или, возможно, к испорченной веб-странице, потому что код ожидает, что canvas будет того размера,
 который они запросили, и они ожидают, что другие части UI и элементы на странице будут в правильных местах.</p>
</li>
<li>
 <p>Позволить canvas быть того размера, который запросил пользователь, но сделать его drawingbuffer лимитом</p>
 <p>Это решение, которое использует WebGL. Если ваш код написан правильно, единственное, что пользователь может заметить,
 это то, что изображение в canvas немного масштабируется. В противном случае это просто работает. В худшем случае большинство WebGL программ, которые
 не делают правильную вещь, просто будут иметь немного неправильный дисплей, но если пользователь изменит размер окна обратно вниз,
 вещи вернутся к нормальному состоянию.</p>
</li>
</ol>
<p>У большинства людей нет нескольких мониторов, поэтому эта проблема редко возникает. Или, по крайней мере, раньше.
Chrome и Safari, по крайней мере, по состоянию на январь 2015 года, имели жестко закодированное ограничение на размер canvas в 4096. Apple's
5k iMac превышает этот лимит. Много WebGL приложений имели странные дисплеи из-за этого.
Аналогично многие люди начали использовать WebGL с несколькими мониторами для установочной работы и
сталкивались с этим лимитом.</p>
<p>
Итак, если вы хотите обрабатывать эти случаи, используйте <code class="notranslate" translate="no">gl.drawingBufferWidth</code> и <code class="notranslate" translate="no">gl.drawingBufferHeight</code>, как
показано в #1 выше. Для большинства приложений, если вы следуете лучшим практикам выше, вещи просто будут работать. Имейте в виду,
хотя, если вы делаете вычисления, которые должны знать фактический размер drawingbuffer, вам нужно
учитывать это. Примеры сразу на ум, [picking](webgl-picking.html), другими словами преобразование из
координат мыши в координаты пикселей canvas. Другим был бы любой вид пост-обработки
эффектов, которые хотят знать фактический размер drawingbuffer.
</p>
</div> 
    </div>
    <div class="lesson-sidebar">
        <select class="language">
    <option value="/webgl/lessons/webgl-anti-patterns.html" >English</a>
    <option value="/webgl/lessons/de/webgl-anti-patterns.html" >Deutsch</a>
    <option value="/webgl/lessons/ja/webgl-anti-patterns.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-anti-patterns.html" >한국어</a>
    <option value="/webgl/lessons/pt-br/webgl-anti-patterns.html" >Português Brasileiro</a>
    <option value="/webgl/lessons/ru/webgl-anti-patterns.html" selected>Русский</a>
    <option value="/webgl/lessons/zh_cn/webgl-anti-patterns.html" >简体中文</a>
</select>


        <div id="toc">
          <ul>  <li>Основы</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-getting-webgl2.html">Как использовать WebGL2</a></li>
<li><a href="/webgl/lessons/ru/webgl-fundamentals.html">Основы</a></li>
<li><a href="/webgl/lessons/ru/webgl-how-it-works.html">Как это работает</a></li>
<li><a href="/webgl/lessons/ru/webgl-shaders-and-glsl.html">Шейдеры и GLSL</a></li>
<li><a href="/webgl/lessons/resources/webgl-state-diagram.html">WebGL2 Диаграмма состояния</a></li>
        </ul>
  <li>WebGL2 vs WebGL1</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl2-whats-new.html">Что нового в WebGL2</a></li>
<li><a href="/webgl/lessons/ru/webgl1-to-webgl2.html">Переход с WebGL1 на WebGL2</a></li>
<li><a href="/webgl/lessons/ru/webgl1-to-webgl2-fundamentals.html">Отличия от WebGLFundamentals.org до WebGL2Fundamentals.org</a></li>
        </ul>
  <li>Обработка изображений</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-image-processing.html">Обработка изображений</a></li>
<li><a href="/webgl/lessons/ru/webgl-image-processing-continued.html">Продвинутая обработка изображений</a></li>
        </ul>
  <li>2D трансформации, повороты, масштабирование и матричные операции</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-2d-translation.html">2D Трансляция</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-rotation.html">2D Вращение</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-scale.html">2D Масштабирование</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-matrices.html">2D Матрицы</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-orthographic.html">Ортографическая 3D</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-perspective.html">3D Перспектива</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-camera.html">3D - Камеры</a></li>
<li><a href="/webgl/lessons/ru/webgl-matrix-naming.html">3D - Именование матриц</a></li>
        </ul>
  <li>Освещение</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-lighting-directional.html">Направленное освещение</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-lighting-point.html">Точечное освещение</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-lighting-spot.html">Прожекторное освещение</a></li>
        </ul>
  <li>Организация и рефакторинг</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-less-code-more-fun.html">Меньше кода, больше удовольствия</a></li>
<li><a href="/webgl/lessons/ru/webgl-drawing-multiple-things.html">Рисование множественных объектов</a></li>
<li><a href="/webgl/lessons/ru/webgl-scene-graph.html">Графы сцен</a></li>
        </ul>
  <li>Геометрия</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-geometry-lathe.html">3D Геометрия - Токарная обработка</a></li>
<li><a href="/webgl/lessons/ru/webgl-load-obj.html">Загрузка .obj файлов</a></li>
<li><a href="/webgl/lessons/ru/webgl-load-obj-w-mtl.html">Загрузка .obj с .mtl файлами</a></li>
        </ul>
  <li>Текстуры</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-textures.html">Текстуры</a></li>
<li><a href="/webgl/lessons/ru/webgl-data-textures.html">Data Textures</a></li>
<li><a href="/webgl/lessons/ru/webgl-2-textures.html">Использование 2 или более текстур</a></li>
<li><a href="/webgl/lessons/ru/webgl-cors-permission.html">Cross Origin Images</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-perspective-correct-texturemapping.html">Перспективно-корректное наложение текстур</a></li>
<li><a href="/webgl/lessons/ru/webgl-planar-projection-mapping.html">Планарное и перспективное проекционное отображение</a></li>
        </ul>
  <li>Рендеринг в текстуру</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-render-to-texture.html">Рендеринг в текстуру</a></li>
        </ul>
  <li>Тени</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-shadows.html">Тени</a></li>
        </ul>
  <li>Техники</li>
        <ul>
            <li>2D</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-2d-drawimage.html">2D - DrawImage</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-matrix-stack.html">2D - Стек Матриц</a></li>
<li><a href="/webgl/lessons/ru/webgl-sprites.html">Спрайты</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-cube-maps.html">Кубические карты</a></li>
<li><a href="/webgl/lessons/ru/webgl-environment-maps.html">Карты окружения</a></li>
<li><a href="/webgl/lessons/ru/webgl-skybox.html">Скайбоксы</a></li>
<li><a href="/webgl/lessons/ru/webgl-skinning.html">Скининг</a></li>
<li><a href="/webgl/lessons/ru/webgl-fog.html">Fog</a></li>
<li><a href="/webgl/lessons/ru/webgl-picking.html">Пикинг (клик по объектам)</a></li>
        </ul>
  <li>Текст</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-text-html.html">Текст - HTML</a></li>
<li><a href="/webgl/lessons/ru/webgl-text-canvas2d.html">Текст - Canvas 2D</a></li>
<li><a href="/webgl/lessons/ru/webgl-text-texture.html">Текст - Использование текстуры</a></li>
<li><a href="/webgl/lessons/ru/webgl-text-glyphs.html">Текст - Использование текстуры глифов</a></li>
        </ul>
  <li>GPGPU</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-gpgpu.html">GPGPU</a></li>
        </ul>
        </ul>
  <li>Советы</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-smallest-programs.html">Самые маленькие программы</a></li>
<li><a href="/webgl/lessons/ru/webgl-drawing-without-data.html">Рисование без данных</a></li>
<li><a href="/webgl/lessons/ru/webgl-shadertoy.html">Shadertoy</a></li>
<li><a href="/webgl/lessons/ru/webgl-pulling-vertices.html">Вытягивание вершин</a></li>
        </ul>
  <li>Оптимизация</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-indexed-vertices.html">Индексированные вершины (gl.drawElements)</a></li>
<li><a href="/webgl/lessons/ru/webgl-instanced-drawing.html">Инстансинг (Instanced Drawing)</a></li>
        </ul>
  <li>Разное</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-setup-and-installation.html">Настройка и установка</a></li>
<li><a href="/webgl/lessons/ru/webgl-boilerplate.html">Boilerplate</a></li>
<li><a href="/webgl/lessons/ru/webgl-resizing-the-canvas.html">Изменение размера Canvas</a></li>
<li><a href="/webgl/lessons/ru/webgl-animation.html">Анимация</a></li>
<li><a href="/webgl/lessons/ru/webgl-points-lines-triangles.html">Точки, линии и треугольники</a></li>
<li><a href="/webgl/lessons/ru/webgl-multiple-views.html">Множественные виды, множественные canvas</a></li>
<li><a href="/webgl/lessons/ru/webgl-visualizing-the-camera.html">Визуализация камеры</a></li>
<li><a href="/webgl/lessons/ru/webgl-and-alpha.html">WebGL2 и альфа-канал</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-vs-3d-library.html">2D против 3D библиотек</a></li>
<li><a href="/webgl/lessons/ru/webgl-anti-patterns.html">Анти-паттерны</a></li>
<li><a href="/webgl/lessons/ru/webgl-matrix-vs-math.html">WebGL2 Матрицы против математических матриц</a></li>
<li><a href="/webgl/lessons/ru/webgl-precision-issues.html">Проблемы точности</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#screenshot">Скриншот канваса</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#preservedrawingbuffer">Как не очищать канвас</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#tabindex">Получение ввода с клавиатуры</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#html-background">WebGL2 как фон HTML</a></li>
<li><a href="/webgl/lessons/ru/webgl-cross-platform-issues.html">Cross Platform Issues</a></li>
<li><a href="/webgl/lessons/ru/webgl-qna.html">Вопросы и ответы</a></li>
        </ul>
  <li>Справочник</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-attributes.html">Атрибуты</a></li>
<li><a href="/webgl/lessons/ru/webgl-texture-units.html">Текстурные юниты</a></li>
<li><a href="/webgl/lessons/ru/webgl-framebuffers.html">Framebuffers</a></li>
<li><a href="/webgl/lessons/ru/webgl-readpixels.html">readPixels</a></li>
<li><a href="/webgl/lessons/ru/webgl-references.html">Ссылки</a></li>
        </ul></ul>
<ul>
  <li><a href="/docs/">API документация</a></li>
  <li><a href="https://twgljs.org">TWGL, легковесная библиотека-помощник для WebGL</a></li>
  <li><a href="https://github.com/gfxfundamentals/webgl2-fundamentals">GitHub</a></li>
</ul>
        </div>
    </div>
    <div class="lesson-comments">
        
<div>Есть предложения или замечания? <a href="https://github.com/gfxfundamentals/webgl2-fundamentals/issues">Создайте issue на GitHub</a>.</div>
  

        <div id="disqus_thread"></div>
        <script>
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'webgl2fundamentals'; // required: replace example with your forum shortname
            var disqus_identifier = 'WebGL2 Анти-паттерны';
            var disqus_title = 'WebGL2 Анти-паттерны';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                if (window.location.hostname.indexOf("webgl2fundamentals.org") < 0) {
                    return;
                }
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>
</div>
</body>
<script>
const settings = {
  contribTemplate: "Спасибо <a href=\"${html_url}\"><img src=\"${avatar_url}\"> ${login}</a><br>за <a href=\"https://github.com/${owner}/${repo}/commits?author=${login}\">${contributions} вкладов</a>",
  owner: "gfxfundamentals",
  repo: "webgl2-fundamentals",
};
</script>
<script src="/contributors.js"></script>
<script src="/3rdparty/jquery-1.11.2.min.js"></script>
<script src="/webgl/lessons/resources/prettify.js"></script>
<script src="/webgl/lessons/resources/lesson.js" type="module"></script>
<script>
</script>


</html>



