<!DOCTYPE html>
<!-- this file is auto-generated from webgl/lessons/ru/webgl-3d-perspective.md. Do not edited directly -->
<!--
Copyright 2021, GFXFundamentals.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

*   Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.

*   Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the following disclaimer
    in the documentation and/or other materials provided with the
    distribution.

*   Neither the name of GFXFundamentals. nor the names of his
    contributors may be used to endorse or promote products derived from
    this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Как отобразить перспективу в 3D в WebGL">
<meta name="keywords" content="webgl webgl2 graphics">
<meta name="thumbnail" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-3d-perspective_ru.jpg">

<meta property="og:title" content="WebGL2 3D Перспектива">
<meta property="og:type" content="website">
<meta property="og:image" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-3d-perspective_ru.jpg">
<meta property="og:description" content="Как отобразить перспективу в 3D в WebGL">
<meta property="og:url" content="https://webgl2fundamentals.org/webgl/lessons/ru/webgl-3d-perspective.html">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@greggman">
<meta name="twitter:creator" content="@greggman">
<meta name="twitter:domain" content="webgl2fundamentals.org">
<meta name="twitter:title" content="WebGL2 3D Перспектива">
<meta name="twitter:url" content="https://webgl2fundamentals.org/webgl/lessons/ru/webgl-3d-perspective.html">
<meta name="twitter:description" content="Как отобразить перспективу в 3D в WebGL">
<meta name="twitter:image:src" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-3d-perspective_ru.jpg">

<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@graph":[
    {
      "@type":"WebSite",
      "@id":"https://webgl2fundamentals.org/#website",
      "url":"https://webgl2fundamentals.org/",
      "name":"Webgl2Fundamentals"
    },
    {
      "@type":"ImageObject",
      "@id":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-3d-perspective.html#primaryimage",
      "url":"https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-3d-perspective_ru.jpg",
      "width":1200,
      "height":630
    },
    {
      "@type":"WebPage",
      "@id":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-3d-perspective.html#webpage",
      "url":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-3d-perspective.html",
      "inLanguage":"ru",
      "name":"WebGL2 3D Перспектива",
      "keywords":"webgl webgl2 graphics programming",
      "isPartOf":{
        "@id":"https://webgl2fundamentals.org/#website"
      },
      "primaryImageOfPage":{
        "@id":"https://webgl2fundamentals.org/webgl/lessons/ru/webgl-3d-perspective.html#primaryimage"
      }
    }
  ]
}
</script>


<title>WebGL2 3D Перспектива</title>
<link href="/webgl/lessons/resources/webgl2fundamentals-icon.png" rel="shortcut icon" type="image/png">
<link rel="stylesheet" href="/webgl/lessons/lang.css">
<link rel="stylesheet" href="/webgl/lessons/resources/lesson.css">

  <link rel="alternate" hreflang="en" href="https://webglfundamentals.org/webgl/lessons/webgl-3d-perspective.html">
  <link rel="alternate" hreflang="de" href="https://webglfundamentals.org/webgl/lessons/de/webgl-3d-perspective.html">
  <link rel="alternate" hreflang="ja" href="https://webglfundamentals.org/webgl/lessons/ja/webgl-3d-perspective.html">
  <link rel="alternate" hreflang="ko" href="https://webglfundamentals.org/webgl/lessons/ko/webgl-3d-perspective.html">
  <link rel="alternate" hreflang="pt-br" href="https://webglfundamentals.org/webgl/lessons/pt-br/webgl-3d-perspective.html">
  <link rel="alternate" hreflang="ru" href="https://webglfundamentals.org/webgl/lessons/ru/webgl-3d-perspective.html">
  <link rel="alternate" hreflang="zh_cn" href="https://webglfundamentals.org/webgl/lessons/zh_cn/webgl-3d-perspective.html">




</head>
<body>
<div class="webgl_navbar">
  <div>
    <select class="language">
    <option value="/webgl/lessons/webgl-3d-perspective.html" >English</a>
    <option value="/webgl/lessons/de/webgl-3d-perspective.html" >Deutsch</a>
    <option value="/webgl/lessons/ja/webgl-3d-perspective.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-3d-perspective.html" >한국어</a>
    <option value="/webgl/lessons/pt-br/webgl-3d-perspective.html" >Português Brasileiro</a>
    <option value="/webgl/lessons/ru/webgl-3d-perspective.html" selected>Русский</a>
    <option value="/webgl/lessons/zh_cn/webgl-3d-perspective.html" >简体中文</a>
</select>


    <a href="#toc">Содержание</a>
    <input type="search" placeholder="?" id="search">
  </div>
</div>
<div class="webgl_header">
  <h1><a href="/webgl/lessons/ru/">WebGL2Fundamentals.org</a></h1>
<style>
#forkongithub>div {
    background: #000;
    color: #fff;
    font-family: arial,sans-serif;
    text-align: center;
    font-weight: bold;
    padding: 5px 40px;
    font-size: 0.9rem;
    line-height: 1.3rem;
    position: relative;
    transition: 0.5s;
    display: block;
    width: 400px;
    position: absolute;
    top: 0;
    right: 0;
    transform: translateX(200px) rotate(45deg) translate(10px,70px);
    box-shadow: 4px 4px 10px rgba(0,0,0,0.8);
    pointer-events: auto;
}
#forkongithub a {
  text-decoration: none;
  color: #fff;
}
#forkongithub>div:hover {
    background: #c11;
    color: #fff;
}
#forkongithub .contributors {
  font-size: 0.75rem;
  background: rgba(255,255,255,0.2);
  line-height: 1.2;
  padding: 0.1em;
}
#forkongithub>div::before,#forkongithub>div::after {
    content: "";
    width: 100%;
    display: block;
    position: absolute;
    top: 1px;
    left: 0;
    height: 1px;
    background: #fff;
}
#forkongithub>div::after {
    bottom: 1px;
    top: auto;
}

#forkongithub{
    z-index: 9999;
    /* needed for firefox */
    overflow: hidden;
    width: 300px;
    height: 300px;
    position: absolute;
    right: 0;
    top: 0;
    pointer-events: none;
}
#forkongithub svg{
  width: 1em;
  height: 1em;
  vertical-align: middle;
}
#forkongithub img {
  width: 1em;
  height: 1em;
  border-radius: 100%;
  vertical-align: middle;
}

@media (max-width: 900px) {
    #forkongithub>div {
        line-height: 1.2rem;
    }
}
@media (max-width: 700px) {
  #forkongithub {
    display: none;
  }
}
@media (max-width: 410px) {
    #forkongithub>div {
        font-size: 0.7rem;
        transform: translateX(150px) rotate(45deg) translate(20px,40px);
    }
}

</style>
<div id="forkongithub"><div><div><a href="https://github.com/gfxfundamentals/webgl2-fundamentals">Fix, Fork, Contribute <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 136 133" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(3.92891,0,0,3.92891,67.867,129.125)">
        <path d="M0,-31.904C-8.995,-31.904 -16.288,-24.611 -16.288,-15.614C-16.288,-8.417 -11.621,-2.312 -5.148,-0.157C-4.333,-0.008 -4.036,-0.511 -4.036,-0.943C-4.036,-1.329 -4.05,-2.354 -4.058,-3.713C-8.589,-2.729 -9.545,-5.897 -9.545,-5.897C-10.286,-7.779 -11.354,-8.28 -11.354,-8.28C-12.833,-9.29 -11.242,-9.27 -11.242,-9.27C-9.607,-9.155 -8.747,-7.591 -8.747,-7.591C-7.294,-5.102 -4.934,-5.821 -4.006,-6.238C-3.858,-7.29 -3.438,-8.008 -2.972,-8.415C-6.589,-8.826 -10.392,-10.224 -10.392,-16.466C-10.392,-18.244 -9.757,-19.698 -8.715,-20.837C-8.883,-21.249 -9.442,-22.905 -8.556,-25.148C-8.556,-25.148 -7.188,-25.586 -4.076,-23.478C-2.777,-23.84 -1.383,-24.02 0.002,-24.026C1.385,-24.02 2.779,-23.84 4.08,-23.478C7.19,-25.586 8.555,-25.148 8.555,-25.148C9.444,-22.905 8.885,-21.249 8.717,-20.837C9.761,-19.698 10.392,-18.244 10.392,-16.466C10.392,-10.208 6.583,-8.831 2.954,-8.428C3.539,-7.925 4.06,-6.931 4.06,-5.411C4.06,-3.234 4.04,-1.477 4.04,-0.943C4.04,-0.507 4.333,0 5.16,-0.159C11.628,-2.318 16.291,-8.419 16.291,-15.614C16.291,-24.611 8.997,-31.904 0,-31.904" style="fill:white;"/>
    </g>
</svg>
</a></div></div></div>

</div>


<div class="container">
  <div class="lesson-title">
    <h1>WebGL2 3D Перспектива</h1>
  </div>
  <div class="lesson">
    <div class="lesson-main">
      <p>Этот пост является продолжением серии постов о WebGL.
Первый <a href="webgl-fundamentals.html">начался с основ</a> и
предыдущий был о <a href="webgl-3d-orthographic.html">3D Основы</a>.
Если вы не читали их, пожалуйста, просмотрите их сначала.</p>
<p>В последнем посте мы рассмотрели, как делать 3D, но этот 3D не имел никакой перспективы.
Он использовал то, что называется “ортографическим” видом, который имеет свои применения, но это
обычно не то, что люди хотят, когда говорят “3D”.</p>
<p>Вместо этого нам нужно добавить перспективу. Что такое перспектива?
Это в основном особенность, что вещи, которые находятся дальше, выглядят
меньше.</p>
<div class="webgl_center noinvertdark"><img style="width: 500px;" src="../resources/perspective-example.svg" /></div>
<p>Глядя на пример выше, мы видим, что вещи дальше
рисуются меньше. Учитывая наш текущий пример, один простой способ
сделать так, чтобы вещи, которые находятся дальше, выглядели меньше,
было бы разделить clip space X и Y на Z.</p>
<p>Думайте об этом так: Если у вас есть линия от (10, 15) до (20,15),
она длиной 10 единиц. В нашем текущем примере она была бы нарисована длиной 10 пикселей.
Но если мы разделим на Z, то, например, если Z равен 1</p>
<pre class="webgl_center">
10 / 1 = 10
20 / 1 = 20
abs(10-20) = 10
</pre>
<p>она была бы длиной 10 пикселей. Если Z равен 2, она была бы</p>
<pre class="webgl_center">
10 / 2 = 5
20 / 2 = 10
abs(5 - 10) = 5
</pre>
<p>длиной 5 пикселей. При Z = 3 она была бы</p>
<pre class="webgl_center">
10 / 3 = 3.333
20 / 3 = 6.666
abs(3.333 - 6.666) = 3.333
</pre>
<p>Вы можете видеть, что по мере увеличения Z, по мере того, как он становится дальше, мы в конечном итоге рисуем его меньше.
Если мы разделим в clip space, мы можем получить лучшие результаты, потому что Z будет меньшим числом (-1 до +1).
Если мы добавим fudgeFactor, чтобы умножить Z перед тем, как мы разделим, мы можем настроить, насколько меньше вещи
становятся для данного расстояния.</p>
<p>Давайте попробуем это. Сначала давайте изменим вершинный шейдер, чтобы разделить на Z после того, как мы
умножили его на наш “fudgeFactor”.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">...
+uniform float u_fudgeFactor;
...
void main() {
  // Умножаем позицию на матрицу.
*  vec4 position = u_matrix * a_position;

  // Настраиваем z для деления на
+  float zToDivideBy = 1.0 + position.z * u_fudgeFactor;

  // Делим x и y на z.
*  gl_Position = vec4(position.xy / zToDivideBy, position.zw);
}
</code></pre>
<p>Обратите внимание, поскольку Z в clip space идет от -1 до +1, я добавил 1, чтобы получить
<code class="notranslate" translate="no">zToDivideBy</code>, чтобы он шел от 0 до +2 * fudgeFactor</p>
<p>Нам также нужно обновить код, чтобы позволить нам установить fudgeFactor.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">  ...
+  var fudgeLocation = gl.getUniformLocation(program, &quot;u_fudgeFactor&quot;);

  ...
+  var fudgeFactor = 1;
  ...
  function drawScene() {
    ...
+    // Устанавливаем fudgeFactor
+    gl.uniform1f(fudgeLocation, fudgeFactor);

    // Рисуем геометрию.
    gl.drawArrays(gl.TRIANGLES, 0, 16 * 6);
</code></pre>
<p>И вот результат.</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-3d-perspective.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-3d-perspective.html" target="_blank">Нажмите, чтобы открыть в новом окне</a>
</div>

</p>
<p>Если это не ясно, перетащите слайдер “fudgeFactor” с 1.0 на 0.0, чтобы увидеть,
как вещи выглядели раньше, прежде чем мы добавили наш код деления на Z.</p>
<div class="webgl_center"><img src="../resources/orthographic-vs-perspective.png" /></div>
<div class="webgl_center">ортографическая vs перспективная</div>
<p>Оказывается, WebGL берет значение x,y,z,w, которое мы присваиваем <code class="notranslate" translate="no">gl_Position</code> в нашем вершинном
шейдере, и автоматически делит его на w.</p>
<p>Мы можем доказать это очень легко, изменив шейдер и вместо того, чтобы делать
деление сами, поместить <code class="notranslate" translate="no">zToDivideBy</code> в <code class="notranslate" translate="no">gl_Position.w</code>.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">...
uniform float u_fudgeFactor;
...
void main() {
  // Умножаем позицию на матрицу.
  vec4 position = u_matrix * a_position;

  // Настраиваем z для деления на
  float zToDivideBy = 1.0 + position.z * u_fudgeFactor;

  // Делим x, y и z на zToDivideBy
  gl_Position = vec4(position.xyz,  zToDivideBy);
}
</code></pre>
<p>и посмотреть, как это точно то же самое.</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-3d-perspective-w.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-3d-perspective-w.html" target="_blank">Нажмите, чтобы открыть в новом окне</a>
</div>

</p>
<p>Почему тот факт, что WebGL автоматически делит на W, полезен? Потому что теперь, используя
больше матричной магии, мы можем просто использовать еще одну матрицу, чтобы скопировать z в w.</p>
<p>Матрица, как эта</p>
<div class="webgl_math_center"><pre class="webgl_math">
1, 0, 0, 0,
0, 1, 0, 0,
0, 0, 1, 1,
0, 0, 0, 0,
</pre></div>
<p>скопирует z в w. Вы можете смотреть на каждый из этих столбцов как</p>
<div class="webgl_math_center"><pre class="webgl_math">
x_out = x_in * 1 +
        y_in * 0 +
        z_in * 0 +
        w_in * 0 ;
<p>y_out = x_in * 0 +
y_in * 1 +
z_in * 0 +
w_in * 0 ;</p>
<p>z_out = x_in * 0 +
y_in * 0 +
z_in * 1 +
w_in * 0 ;</p>
<p>w_out = x_in * 0 +
y_in * 0 +
z_in * 1 +
w_in * 0 ;
</pre></div></p>
<p>что при упрощении есть</p>
<div class="webgl_math_center"><pre class="webgl_math">
x_out = x_in;
y_out = y_in;
z_out = z_in;
w_out = z_in;
</pre></div>
<p>Мы можем добавить плюс 1, который у нас был раньше, с этой матрицей, поскольку мы знаем, что <code class="notranslate" translate="no">w_in</code> всегда 1.0.</p>
<div class="webgl_math_center"><pre class="webgl_math">
1, 0, 0, 0,
0, 1, 0, 0,
0, 0, 1, 1,
0, 0, 0, 1,
</pre></div>
<p>это изменит вычисление W на</p>
<div class="webgl_math_center"><pre class="webgl_math">
w_out = x_in * 0 +
        y_in * 0 +
        z_in * 1 +
        w_in * 1 ;
</pre></div>
<p>и поскольку мы знаем, что <code class="notranslate" translate="no">w_in</code> = 1.0, то это действительно</p>
<div class="webgl_math_center"><pre class="webgl_math">
w_out = z_in + 1;
</pre></div>
<p>Наконец, мы можем вернуть наш fudgeFactor, если матрица такая</p>
<div class="webgl_math_center"><pre class="webgl_math">
1, 0, 0, 0,
0, 1, 0, 0,
0, 0, 1, fudgeFactor,
0, 0, 0, 1,
</pre></div>
<p>что означает</p>
<div class="webgl_math_center"><pre class="webgl_math">
w_out = x_in * 0 +
        y_in * 0 +
        z_in * fudgeFactor +
        w_in * 1 ;
</pre></div>
<p>и упрощенно это</p>
<div class="webgl_math_center"><pre class="webgl_math">
w_out = z_in * fudgeFactor + 1;
</pre></div>
<p>Итак, давайте снова изменим программу, чтобы просто использовать матрицы.</p>
<p>Сначала давайте вернем вершинный шейдер. Он снова простой</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">uniform mat4 u_matrix;

void main() {
  // Умножаем позицию на матрицу.
  gl_Position = u_matrix * a_position;
  ...
}
</code></pre>
<p>Далее давайте сделаем функцию для создания нашей матрицы Z → W.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">function makeZToWMatrix(fudgeFactor) {
  return [
    1, 0, 0, 0,
    0, 1, 0, 0,
    0, 0, 1, fudgeFactor,
    0, 0, 0, 1,
  ];
}
</code></pre>
<p>и мы изменим код, чтобы использовать ее.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">    ...

    // Вычисляем матрицу
+    var matrix = makeZToWMatrix(fudgeFactor);
*    matrix = m4.multiply(matrix, m4.projection(gl.canvas.clientWidth, gl.canvas.clientHeight, 400));
    matrix = m4.translate(matrix, translation[0], translation[1], translation[2]);
    matrix = m4.xRotate(matrix, rotation[0]);
    matrix = m4.yRotate(matrix, rotation[1]);
    matrix = m4.zRotate(matrix, rotation[2]);
    matrix = m4.scale(matrix, scale[0], scale[1], scale[2]);

    ...
</code></pre>
<p>и обратите внимание, снова, это точно то же самое.</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-3d-perspective-w-matrix.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-3d-perspective-w-matrix.html" target="_blank">Нажмите, чтобы открыть в новом окне</a>
</div>

</p>
<p>Все это было в основном просто чтобы показать вам, что деление на Z дает нам перспективу
и что WebGL удобно делает это деление на Z для нас.</p>
<p>Но все еще есть некоторые проблемы. Например, если вы установите Z примерно на -100, вы увидите что-то вроде
анимации ниже</p>
<div class="webgl_center"><img src="../resources/z-clipping.gif" style="border: 1px solid black;" /></div>
<p>Что происходит? Почему F исчезает рано? Так же, как WebGL обрезает X и Y до
значений между +1 и -1, он также обрезает Z. То, что мы видим здесь, это где Z &lt; -1.</p>
<p>Я мог бы вдаваться в детали математики, чтобы исправить это, но <a href="https://stackoverflow.com/a/28301213/128511">вы можете вывести это</a> так же, как
мы делали 2D проекцию. Нам нужно взять Z, добавить некоторое количество и масштабировать некоторое количество, и мы можем сделать любой диапазон, который мы хотим,
перемаппированным в -1 до +1.</p>
<p>Крутая вещь в том, что все эти шаги могут быть сделаны в 1 матрице. Еще лучше, вместо <code class="notranslate" translate="no">fudgeFactor</code>
мы решим на <code class="notranslate" translate="no">fieldOfView</code> и вычислим правильные значения, чтобы это произошло.</p>
<p>Вот функция для построения матрицы.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">var m4 = {
  perspective: function(fieldOfViewInRadians, aspect, near, far) {
    var f = Math.tan(Math.PI * 0.5 - 0.5 * fieldOfViewInRadians);
    var rangeInv = 1.0 / (near - far);

    return [
      f / aspect, 0, 0, 0,
      0, f, 0, 0,
      0, 0, (near + far) * rangeInv, -1,
      0, 0, near * far * rangeInv * 2, 0
    ];
  },

  ...
</code></pre>
<p>Эта матрица сделает все наши преобразования для нас. Она настроит единицы так, чтобы они были
в clip space, она сделает математику так, чтобы мы могли выбрать поле зрения по углу,
и она позволит нам выбрать наше Z-обрезающее пространство. Она предполагает, что есть <em>глаз</em> или <em>камера</em> в
начале координат (0, 0, 0), и учитывая <code class="notranslate" translate="no">zNear</code> и <code class="notranslate" translate="no">fieldOfView</code>, она вычисляет, что потребуется, чтобы
вещи на <code class="notranslate" translate="no">zNear</code> оказались на <code class="notranslate" translate="no">Z = -1</code>, а вещи на <code class="notranslate" translate="no">zNear</code>, которые составляют половину <code class="notranslate" translate="no">fieldOfView</code> выше или ниже центра,
оказались с <code class="notranslate" translate="no">Y = -1</code> и <code class="notranslate" translate="no">Y = 1</code> соответственно. Она вычисляет, что использовать для X, просто умножая на переданный <code class="notranslate" translate="no">aspect</code>.
Мы обычно устанавливаем это в <code class="notranslate" translate="no">width / height</code> области отображения.
Наконец, она выясняет, насколько масштабировать вещи в Z, чтобы вещи на zFar оказались на <code class="notranslate" translate="no">Z = 1</code>.</p>
<p>Вот диаграмма матрицы в действии.</p>
<p><div class="webgl_diagram_container">
  <iframe class="webgl_example " style="width: 400px; height: 600px;" src="/webgl/lessons/../frustum-diagram.html"></iframe>
</div>

</p>
<p>Эта форма, которая выглядит как 4-сторонний конус, в котором вращаются кубы, называется “усеченной пирамидой”.
Матрица берет пространство внутри усеченной пирамиды и преобразует это в clip space. <code class="notranslate" translate="no">zNear</code> определяет, где
вещи будут обрезаны спереди, а <code class="notranslate" translate="no">zFar</code> определяет, где вещи обрезаются сзади. Установите <code class="notranslate" translate="no">zNear</code> на 23, и
вы увидите, как передняя часть вращающихся кубов обрезается. Установите <code class="notranslate" translate="no">zFar</code> на 24, и вы увидите, как задняя часть кубов
обрезается.</p>
<p>Остается только одна проблема. Эта матрица предполагает, что есть зритель в 0,0,0, и
она предполагает, что он смотрит в отрицательном направлении Z и что положительный Y вверх.
Наши матрицы до этого момента делали вещи по-другому.</p>
<p>Чтобы заставить это появиться, нам нужно переместить это внутрь усеченной пирамиды.
Мы можем сделать это, переместив наш F. Мы рисовали в (45, 150, 0). Давайте переместим его в (-150, 0, -360)
и давайте установим вращение на что-то, что заставляет его появиться правой стороной вверх.</p>
<div class="webgl_center"><img src="../resources/f-right-side.svg" style="width: 500px;" caption="не в масштабе"></div>
<p>Теперь, чтобы использовать это, нам просто нужно заменить наш старый вызов m4.projection на вызов
m4.perspective</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">   var aspect = gl.canvas.clientWidth / gl.canvas.clientHeight;
   var zNear = 1;
   var zFar = 2000;
   var matrix = m4.perspective(fieldOfViewRadians, aspect, zNear, zFar);
   matrix = m4.translate(matrix, translation[0], translation[1], translation[2]);
   matrix = m4.xRotate(matrix, rotation[0]);
   matrix = m4.yRotate(matrix, rotation[1]);
   matrix = m4.zRotate(matrix, rotation[2]);
   matrix = m4.scale(matrix, scale[0], scale[1], scale[2]);
</code></pre>
<p>И вот это.</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-3d-perspective-matrix.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-3d-perspective-matrix.html" target="_blank">Нажмите, чтобы открыть в новом окне</a>
</div>

</p>
<p>Мы вернулись к простому умножению матрицы, и мы получаем как поле зрения, так и возможность выбрать наше Z пространство.
Мы не закончили, но эта статья становится слишком длинной. Далее <a href="webgl-3d-camera.html">камеры</a>.</p>
<div class="webgl_bottombar">
<h3>Почему мы переместили F так далеко в Z (-360)?</h3>
<p>
<p>В других примерах у нас был F в (45, 150, 0), но в последнем примере
он был перемещен в (-150, 0, -360). Почему его нужно было переместить так далеко?</p>
</p>
<p>
<p>Причина в том, что до этого последнего примера наша функция <code class="notranslate" translate="no">m4.projection</code>
делала проекцию из пикселей в clip space. Это означает, что область, которую мы
отображали, представляла 400x300 пикселей. Использование ‘пикселей’ действительно не
имеет смысла в 3D.</p>
</p>
<p>
<p>Другими словами, если бы мы попытались нарисовать с F в 0,0,0 и не повернутым, мы бы получили это</p>
</p>
<div class="webgl_center"><img src="../resources/f-big-and-wrong-side.svg" style="width: 500px;"></div>
<p>
F имеет свой верхний левый передний угол в начале координат. Проекция
смотрит в отрицательном направлении Z, но наш F построен в положительном Z. Проекция имеет
положительный Y вверх, но наш F построен с положительным Z вниз.
</p>
<p>
Наша новая проекция видит только то, что в синей усеченной пирамиде. С -zNear = 1 и с полем зрения 60 градусов,
то при Z = -1 усеченная пирамида только 1.154 единицы высотой и 1.154 * aspect единиц шириной. При Z = -2000 (-zFar) она 2309 единиц высотой.
Поскольку наш F размером 150 единиц, а вид может видеть только 1.154
единицы, когда что-то находится на <code class="notranslate" translate="no">-zNear</code>, нам нужно переместить это довольно далеко от начала координат, чтобы
увидеть все это.
</p>
<p>
Перемещение его на -360 единиц в Z перемещает его внутрь усеченной пирамиды. Мы также повернули его, чтобы он был правой стороной вверх.
</p>
<div class="webgl_center"><img src="../resources/f-right-side.svg" style="width: 500px;"><div>не в масштабе</div></div>
</div>
    </div>
    <div class="lesson-sidebar">
        <select class="language">
    <option value="/webgl/lessons/webgl-3d-perspective.html" >English</a>
    <option value="/webgl/lessons/de/webgl-3d-perspective.html" >Deutsch</a>
    <option value="/webgl/lessons/ja/webgl-3d-perspective.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-3d-perspective.html" >한국어</a>
    <option value="/webgl/lessons/pt-br/webgl-3d-perspective.html" >Português Brasileiro</a>
    <option value="/webgl/lessons/ru/webgl-3d-perspective.html" selected>Русский</a>
    <option value="/webgl/lessons/zh_cn/webgl-3d-perspective.html" >简体中文</a>
</select>


        <div id="toc">
          <ul>  <li>Основы</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-getting-webgl2.html">Как использовать WebGL2</a></li>
<li><a href="/webgl/lessons/ru/webgl-fundamentals.html">Основы</a></li>
<li><a href="/webgl/lessons/ru/webgl-how-it-works.html">Как это работает</a></li>
<li><a href="/webgl/lessons/ru/webgl-shaders-and-glsl.html">Шейдеры и GLSL</a></li>
<li><a href="/webgl/lessons/resources/webgl-state-diagram.html">WebGL2 Диаграмма состояния</a></li>
        </ul>
  <li>WebGL2 vs WebGL1</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl2-whats-new.html">Что нового в WebGL2</a></li>
<li><a href="/webgl/lessons/ru/webgl1-to-webgl2.html">Переход с WebGL1 на WebGL2</a></li>
<li><a href="/webgl/lessons/ru/webgl1-to-webgl2-fundamentals.html">Отличия от WebGLFundamentals.org до WebGL2Fundamentals.org</a></li>
        </ul>
  <li>Обработка изображений</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-image-processing.html">Обработка изображений</a></li>
<li><a href="/webgl/lessons/ru/webgl-image-processing-continued.html">Продвинутая обработка изображений</a></li>
        </ul>
  <li>2D трансформации, повороты, масштабирование и матричные операции</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-2d-translation.html">2D Трансляция</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-rotation.html">2D Вращение</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-scale.html">2D Масштабирование</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-matrices.html">2D Матрицы</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-orthographic.html">Ортографическая 3D</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-perspective.html">3D Перспектива</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-camera.html">3D - Камеры</a></li>
<li><a href="/webgl/lessons/ru/webgl-matrix-naming.html">3D - Именование матриц</a></li>
        </ul>
  <li>Освещение</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-lighting-directional.html">Направленное освещение</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-lighting-point.html">Точечное освещение</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-lighting-spot.html">Прожекторное освещение</a></li>
        </ul>
  <li>Организация и рефакторинг</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-less-code-more-fun.html">Меньше кода, больше удовольствия</a></li>
<li><a href="/webgl/lessons/ru/webgl-drawing-multiple-things.html">Рисование множественных объектов</a></li>
<li><a href="/webgl/lessons/ru/webgl-scene-graph.html">Графы сцен</a></li>
        </ul>
  <li>Геометрия</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-geometry-lathe.html">3D Геометрия - Токарная обработка</a></li>
<li><a href="/webgl/lessons/ru/webgl-load-obj.html">Загрузка .obj файлов</a></li>
<li><a href="/webgl/lessons/ru/webgl-load-obj-w-mtl.html">Загрузка .obj с .mtl файлами</a></li>
        </ul>
  <li>Текстуры</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-3d-textures.html">Текстуры</a></li>
<li><a href="/webgl/lessons/ru/webgl-data-textures.html">Data Textures</a></li>
<li><a href="/webgl/lessons/ru/webgl-2-textures.html">Использование 2 или более текстур</a></li>
<li><a href="/webgl/lessons/ru/webgl-cors-permission.html">Cross Origin Images</a></li>
<li><a href="/webgl/lessons/ru/webgl-3d-perspective-correct-texturemapping.html">Перспективно-корректное наложение текстур</a></li>
<li><a href="/webgl/lessons/ru/webgl-planar-projection-mapping.html">Планарное и перспективное проекционное отображение</a></li>
        </ul>
  <li>Рендеринг в текстуру</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-render-to-texture.html">Рендеринг в текстуру</a></li>
        </ul>
  <li>Тени</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-shadows.html">Тени</a></li>
        </ul>
  <li>Техники</li>
        <ul>
            <li>2D</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-2d-drawimage.html">2D - DrawImage</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-matrix-stack.html">2D - Стек Матриц</a></li>
<li><a href="/webgl/lessons/ru/webgl-sprites.html">Спрайты</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-cube-maps.html">Кубические карты</a></li>
<li><a href="/webgl/lessons/ru/webgl-environment-maps.html">Карты окружения</a></li>
<li><a href="/webgl/lessons/ru/webgl-skybox.html">Скайбоксы</a></li>
<li><a href="/webgl/lessons/ru/webgl-skinning.html">Скининг</a></li>
<li><a href="/webgl/lessons/ru/webgl-fog.html">Fog</a></li>
<li><a href="/webgl/lessons/ru/webgl-picking.html">Пикинг (клик по объектам)</a></li>
        </ul>
  <li>Текст</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-text-html.html">Текст - HTML</a></li>
<li><a href="/webgl/lessons/ru/webgl-text-canvas2d.html">Текст - Canvas 2D</a></li>
<li><a href="/webgl/lessons/ru/webgl-text-texture.html">Текст - Использование текстуры</a></li>
<li><a href="/webgl/lessons/ru/webgl-text-glyphs.html">Текст - Использование текстуры глифов</a></li>
        </ul>
  <li>GPGPU</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-gpgpu.html">GPGPU</a></li>
        </ul>
        </ul>
  <li>Советы</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-smallest-programs.html">Самые маленькие программы</a></li>
<li><a href="/webgl/lessons/ru/webgl-drawing-without-data.html">Рисование без данных</a></li>
<li><a href="/webgl/lessons/ru/webgl-shadertoy.html">Shadertoy</a></li>
<li><a href="/webgl/lessons/ru/webgl-pulling-vertices.html">Вытягивание вершин</a></li>
        </ul>
  <li>Оптимизация</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-indexed-vertices.html">Индексированные вершины (gl.drawElements)</a></li>
<li><a href="/webgl/lessons/ru/webgl-instanced-drawing.html">Инстансинг (Instanced Drawing)</a></li>
        </ul>
  <li>Разное</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-setup-and-installation.html">Настройка и установка</a></li>
<li><a href="/webgl/lessons/ru/webgl-boilerplate.html">Boilerplate</a></li>
<li><a href="/webgl/lessons/ru/webgl-resizing-the-canvas.html">Изменение размера Canvas</a></li>
<li><a href="/webgl/lessons/ru/webgl-animation.html">Анимация</a></li>
<li><a href="/webgl/lessons/ru/webgl-points-lines-triangles.html">Точки, линии и треугольники</a></li>
<li><a href="/webgl/lessons/ru/webgl-multiple-views.html">Множественные виды, множественные canvas</a></li>
<li><a href="/webgl/lessons/ru/webgl-visualizing-the-camera.html">Визуализация камеры</a></li>
<li><a href="/webgl/lessons/ru/webgl-and-alpha.html">WebGL2 и альфа-канал</a></li>
<li><a href="/webgl/lessons/ru/webgl-2d-vs-3d-library.html">2D против 3D библиотек</a></li>
<li><a href="/webgl/lessons/ru/webgl-anti-patterns.html">Анти-паттерны</a></li>
<li><a href="/webgl/lessons/ru/webgl-matrix-vs-math.html">WebGL2 Матрицы против математических матриц</a></li>
<li><a href="/webgl/lessons/ru/webgl-precision-issues.html">Проблемы точности</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#screenshot">Скриншот канваса</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#preservedrawingbuffer">Как не очищать канвас</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#tabindex">Получение ввода с клавиатуры</a></li>
<li><a href="/webgl/lessons/ru/webgl-tips.html#html-background">WebGL2 как фон HTML</a></li>
<li><a href="/webgl/lessons/ru/webgl-cross-platform-issues.html">Cross Platform Issues</a></li>
<li><a href="/webgl/lessons/ru/webgl-qna.html">Вопросы и ответы</a></li>
        </ul>
  <li>Справочник</li>
        <ul>
          <li><a href="/webgl/lessons/ru/webgl-attributes.html">Атрибуты</a></li>
<li><a href="/webgl/lessons/ru/webgl-texture-units.html">Текстурные юниты</a></li>
<li><a href="/webgl/lessons/ru/webgl-framebuffers.html">Framebuffers</a></li>
<li><a href="/webgl/lessons/ru/webgl-readpixels.html">readPixels</a></li>
<li><a href="/webgl/lessons/ru/webgl-references.html">Ссылки</a></li>
        </ul></ul>
<ul>
  <li><a href="/docs/">API документация</a></li>
  <li><a href="https://twgljs.org">TWGL, легковесная библиотека-помощник для WebGL</a></li>
  <li><a href="https://github.com/gfxfundamentals/webgl2-fundamentals">GitHub</a></li>
</ul>
        </div>
    </div>
    <div class="lesson-comments">
        
<div>Есть предложения или замечания? <a href="https://github.com/gfxfundamentals/webgl2-fundamentals/issues">Создайте issue на GitHub</a>.</div>
  

        <div id="disqus_thread"></div>
        <script>
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'webgl2fundamentals'; // required: replace example with your forum shortname
            var disqus_identifier = 'WebGL2 3D Перспектива';
            var disqus_title = 'WebGL2 3D Перспектива';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                if (window.location.hostname.indexOf("webgl2fundamentals.org") < 0) {
                    return;
                }
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>
</div>
</body>
<script>
const settings = {
  contribTemplate: "Спасибо <a href=\"${html_url}\"><img src=\"${avatar_url}\"> ${login}</a><br>за <a href=\"https://github.com/${owner}/${repo}/commits?author=${login}\">${contributions} вкладов</a>",
  owner: "gfxfundamentals",
  repo: "webgl2-fundamentals",
};
</script>
<script src="/contributors.js"></script>
<script src="/3rdparty/jquery-1.11.2.min.js"></script>
<script src="/webgl/lessons/resources/prettify.js"></script>
<script src="/webgl/lessons/resources/lesson.js" type="module"></script>
<script>
</script>


</html>



