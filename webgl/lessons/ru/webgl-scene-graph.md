Title: WebGL2 - –ì—Ä–∞—Ñ —Å—Ü–µ–Ω—ã
Description: –ß—Ç–æ —Ç–∞–∫–æ–µ –≥—Ä–∞—Ñ —Å—Ü–µ–Ω—ã –∏ –¥–ª—è —á–µ–≥–æ –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
TOC: –ì—Ä–∞—Ñ—ã —Å—Ü–µ–Ω


–≠—Ç–∞ —Å—Ç–∞—Ç—å—è —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º [–ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å—Ç–∞—Ç–µ–π WebGL](webgl-fundamentals.html).
–ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç–∞—Ç—å—è –±—ã–ª–∞ –æ [—Ä–∏—Å–æ–≤–∞–Ω–∏–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤](webgl-drawing-multiple-things.html).
–ï—Å–ª–∏ –≤—ã –∏—Ö –Ω–µ —á–∏—Ç–∞–ª–∏, —è –ø—Ä–µ–¥–ª–∞–≥–∞—é –Ω–∞—á–∞—Ç—å —Å –Ω–∏—Ö.

–Ø —É–≤–µ—Ä–µ–Ω, —á—Ç–æ –∫–∞–∫–æ–π-–Ω–∏–±—É–¥—å –≥—É—Ä—É CS –∏–ª–∏ –≥—Ä–∞—Ñ–∏–∫–∏ –¥–∞—Å—Ç –º–Ω–µ –Ω–∞–≥–æ–Ω—è–π, –Ω–æ...
–ì—Ä–∞—Ñ —Å—Ü–µ–Ω—ã –æ–±—ã—á–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –¥—Ä–µ–≤–æ–≤–∏–¥–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –≥–¥–µ –∫–∞–∂–¥—ã–π —É–∑–µ–ª –≤ –¥–µ—Ä–µ–≤–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç
–º–∞—Ç—Ä–∏—Ü—É... —Ö–º, —ç—Ç–æ –Ω–µ –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ. –ú–æ–∂–µ—Ç –±—ã—Ç—å, –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–º–µ—Ä–æ–≤ –±—É–¥—É—Ç
–ø–æ–ª–µ–∑–Ω—ã.

–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ 3D –¥–≤–∏–∂–∫–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≥—Ä–∞—Ñ —Å—Ü–µ–Ω—ã. –í—ã –ø–æ–º–µ—â–∞–µ—Ç–µ –æ–±—ä–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç–∏—Ç–µ –≤–∏–¥–µ—Ç—å –≤ —Å—Ü–µ–Ω–µ,
–≤ –≥—Ä–∞—Ñ —Å—Ü–µ–Ω—ã. –î–≤–∏–∂–æ–∫ –∑–∞—Ç–µ–º –æ–±—Ö–æ–¥–∏—Ç –≥—Ä–∞—Ñ —Å—Ü–µ–Ω—ã –∏ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è.
–ì—Ä–∞—Ñ—ã —Å—Ü–µ–Ω –∏–µ—Ä–∞—Ä—Ö–∏—á–Ω—ã, –ø–æ—ç—Ç–æ–º—É, –Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–µ–ª–∏ –±—ã —Å–æ–∑–¥–∞—Ç—å —Å–∏–º—É–ª—è—Ü–∏—é –≤—Å–µ–ª–µ–Ω–Ω–æ–π,
–≤—ã –º–æ–≥–ª–∏ –±—ã –∏–º–µ—Ç—å –≥—Ä–∞—Ñ, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫

{{{diagram url="resources/planet-diagram.html" height="500" }}}

–í —á–µ–º —Å–º—ã—Å–ª –≥—Ä–∞—Ñ–∞ —Å—Ü–µ–Ω—ã? –ì–ª–∞–≤–Ω–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å –≥—Ä–∞—Ñ–∞ —Å—Ü–µ–Ω—ã –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ –æ–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç
—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ-–¥–æ—á–µ—Ä–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –¥–ª—è –º–∞—Ç—Ä–∏—Ü, –∫–∞–∫ [–º—ã –æ–±—Å—É–∂–¥–∞–ª–∏ –≤ 2D –º–∞—Ç—Ä–∏—á–Ω–æ–π –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ](webgl-2d-matrices.html).
–¢–∞–∫, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –ø—Ä–æ—Å—Ç–æ–π (–Ω–æ –Ω–µ—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–π) —Å–∏–º—É–ª—è—Ü–∏–∏ –≤—Å–µ–ª–µ–Ω–Ω–æ–π –∑–≤–µ–∑–¥—ã (–¥–µ—Ç–∏) –¥–≤–∏–∂—É—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å–æ —Å–≤–æ–µ–π
–≥–∞–ª–∞–∫—Ç–∏–∫–æ–π (—Ä–æ–¥–∏—Ç–µ–ª—å). –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ª—É–Ω–∞ (—Ä–µ–±–µ–Ω–æ–∫) –¥–≤–∏–∂–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å–æ —Å–≤–æ–µ–π –ø–ª–∞–Ω–µ—Ç–æ–π (—Ä–æ–¥–∏—Ç–µ–ª—å).
–ï—Å–ª–∏ –≤—ã –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç–µ –ó–µ–º–ª—é, –ª—É–Ω–∞ –±—É–¥–µ—Ç –¥–≤–∏–≥–∞—Ç—å—Å—è —Å –Ω–µ–π. –ï—Å–ª–∏ –≤—ã –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç–µ –≥–∞–ª–∞–∫—Ç–∏–∫—É,
–≤—Å–µ –∑–≤–µ–∑–¥—ã –≤–Ω—É—Ç—Ä–∏ –±—É–¥—É—Ç –¥–≤–∏–≥–∞—Ç—å—Å—è —Å –Ω–µ–π. –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–º–µ–Ω–∞ –≤ –¥–∏–∞–≥—Ä–∞–º–º–µ –≤—ã—à–µ
–∏, –Ω–∞–¥–µ—é—Å—å, –≤—ã —Å–º–æ–∂–µ—Ç–µ —É–≤–∏–¥–µ—Ç—å –∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è.

–ï—Å–ª–∏ –≤—ã –≤–µ—Ä–Ω–µ—Ç–µ—Å—å –∫ [2D –º–∞—Ç—Ä–∏—á–Ω–æ–π –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ](webgl-2d-matrices.html), –≤—ã –º–æ–∂–µ—Ç–µ –≤—Å–ø–æ–º–Ω–∏—Ç—å, —á—Ç–æ –º—ã
—É–º–Ω–æ–∂–∞–µ–º –º–Ω–æ–≥–æ –º–∞—Ç—Ä–∏—Ü –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è, –ø–æ–≤–æ—Ä–æ—Ç–∞ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤. –ì—Ä–∞—Ñ
—Å—Ü–µ–Ω—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –ø–æ–º–æ—â–∏ –≤ —Ä–µ—à–µ–Ω–∏–∏, –∫–∞–∫—É—é –º–∞—Ç—Ä–∏—á–Ω—É—é –º–∞—Ç–µ–º–∞—Ç–∏–∫—É –ø—Ä–∏–º–µ–Ω—è—Ç—å –∫ –æ–±—ä–µ–∫—Ç—É.

–û–±—ã—á–Ω–æ –∫–∞–∂–¥—ã–π `Node` –≤ –≥—Ä–∞—Ñ–µ —Å—Ü–µ–Ω—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç *–ª–æ–∫–∞–ª—å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ*. –ü—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π
–º–∞—Ç—Ä–∏—á–Ω–æ–π –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ –≤—Å–µ –≤ —ç—Ç–æ–º *–ª–æ–∫–∞–ª—å–Ω–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ* –º–æ–∂–µ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –≤—ã—à–µ –Ω–µ–≥–æ. –î—Ä—É–≥–æ–π
—Å–ø–æ—Å–æ–± –≤—ã—Ä–∞–∑–∏—Ç—å —Ç–æ –∂–µ —Å–∞–º–æ–µ - –ª—É–Ω–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–±–æ—Ç–∏—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –æ–± –æ—Ä–±–∏—Ç–µ –≤–æ–∫—Ä—É–≥ –ó–µ–º–ª–∏.
–ï–π –Ω–µ –Ω—É–∂–Ω–æ –∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ–± –æ—Ä–±–∏—Ç–µ –≤–æ–∫—Ä—É–≥ –°–æ–ª–Ω—Ü–∞. –ë–µ–∑ —ç—Ç–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≥—Ä–∞—Ñ–∞ —Å—Ü–µ–Ω—ã
–≤–∞–º –ø—Ä–∏—à–ª–æ—Å—å –±—ã –¥–µ–ª–∞—Ç—å –≥–æ—Ä–∞–∑–¥–æ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—É—é –º–∞—Ç–µ–º–∞—Ç–∏–∫—É –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è, –∫–∞–∫ –∑–∞—Å—Ç–∞–≤–∏—Ç—å –ª—É–Ω—É
–æ—Ä–±–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–æ–∫—Ä—É–≥ –°–æ–ª–Ω—Ü–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ –µ–µ –æ—Ä–±–∏—Ç–∞ –≤–æ–∫—Ä—É–≥ –°–æ–ª–Ω—Ü–∞ –≤—ã–≥–ª—è–¥–∏—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫

{{{diagram url="resources/moon-orbit.html" }}}

–° –≥—Ä–∞—Ñ–æ–º —Å—Ü–µ–Ω—ã –≤—ã –ø—Ä–æ—Å—Ç–æ –¥–µ–ª–∞–µ—Ç–µ –ª—É–Ω—É –¥–æ—á–µ—Ä–Ω–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º –ó–µ–º–ª–∏, –∞ –∑–∞—Ç–µ–º –æ—Ä–±–∏—Ç–∏—Ä—É–µ—Ç–µ
–≤–æ–∫—Ä—É–≥ –ó–µ–º–ª–∏, —á—Ç–æ –ø—Ä–æ—Å—Ç–æ. –ì—Ä–∞—Ñ —Å—Ü–µ–Ω—ã –∑–∞–±–æ—Ç–∏—Ç—Å—è –æ —Ç–æ–º —Ñ–∞–∫—Ç–µ, —á—Ç–æ –ó–µ–º–ª—è
–æ—Ä–±–∏—Ç–∏—Ä—É–µ—Ç –≤–æ–∫—Ä—É–≥ –°–æ–ª–Ω—Ü–∞. –û–Ω –¥–µ–ª–∞–µ—Ç —ç—Ç–æ, –æ–±—Ö–æ–¥—è —É–∑–ª—ã –∏ —É–º–Ω–æ–∂–∞—è
–º–∞—Ç—Ä–∏—Ü—ã –ø–æ –º–µ—Ä–µ –æ–±—Ö–æ–¥–∞

    worldMatrix = greatGrandParent * grandParent * parent * self(localMatrix)

–í –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–∞—Ö –Ω–∞—à–µ–π —Å–∏–º—É–ª—è—Ü–∏–∏ –≤—Å–µ–ª–µ–Ω–Ω–æ–π —ç—Ç–æ –±—ã–ª–æ –±—ã

    worldMatrixForMoon = galaxyMatrix * starMatrix * planetMatrix * moonMatrix;

–ú—ã –º–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ —Å —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π, –∫–æ—Ç–æ—Ä–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ

    function computeWorldMatrix(currentNode, parentWorldMatrix) {
        // –≤—ã—á–∏—Å–ª—è–µ–º –Ω–∞—à—É –º–∏—Ä–æ–≤—É—é –º–∞—Ç—Ä–∏—Ü—É, —É–º–Ω–æ–∂–∞—è –Ω–∞—à—É –ª–æ–∫–∞–ª—å–Ω—É—é –º–∞—Ç—Ä–∏—Ü—É –Ω–∞
        // –º–∏—Ä–æ–≤—É—é –º–∞—Ç—Ä–∏—Ü—É –Ω–∞—à–µ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è.
        var worldMatrix = m4.multiply(parentWorldMatrix, currentNode.localMatrix);

        // —Ç–µ–ø–µ—Ä—å –¥–µ–ª–∞–µ–º —Ç–æ –∂–µ —Å–∞–º–æ–µ –¥–ª—è –≤—Å–µ—Ö –Ω–∞—à–∏—Ö –¥–µ—Ç–µ–π
        currentNode.children.forEach(function(child) {
            computeWorldMatrix(child, worldMatrix);
        });
    }

–≠—Ç–æ –ø–æ–¥–Ω–∏–º–∞–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—É—é —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–≤–æ–ª—å–Ω–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –¥–ª—è 3D –≥—Ä–∞—Ñ–æ–≤ —Å—Ü–µ–Ω.

*   `localMatrix`: –õ–æ–∫–∞–ª—å–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —É–∑–ª–∞. –û–Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –µ–≥–æ –∏ –µ–≥–æ –¥–µ—Ç–µ–π –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ —Å
    —Å–∞–º–∏–º —Å–æ–±–æ–π –≤ –∫–∞—á–µ—Å—Ç–≤–µ –Ω–∞—á–∞–ª–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç.

*    `worldMatrix`: –î–ª—è –¥–∞–Ω–Ω–æ–≥–æ —É–∑–ª–∞ –æ–Ω–∞ –±–µ—Ä–µ—Ç –æ–±—ä–µ–∫—Ç—ã –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ —ç—Ç–æ–≥–æ —É–∑–ª–∞
     –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∏—Ö –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —É–∑–ª–∞ –≥—Ä–∞—Ñ–∞ —Å—Ü–µ–Ω—ã. –ò–ª–∏ –¥—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, —Ä–∞–∑–º–µ—â–∞–µ—Ç –∏—Ö
     –≤ –º–∏—Ä–µ. –ï—Å–ª–∏ –º—ã –≤—ã—á–∏—Å–ª–∏–º worldMatrix –¥–ª—è –ª—É–Ω—ã, –º—ã –ø–æ–ª—É—á–∏–º —Ç—É –∑–∞–±–∞–≤–Ω—É—é –æ—Ä–±–∏—Ç—É, –∫–æ—Ç–æ—Ä—É—é –≤—ã –≤–∏–¥–∏—Ç–µ –≤—ã—à–µ.

–ì—Ä–∞—Ñ —Å—Ü–µ–Ω—ã –¥–æ–≤–æ–ª—å–Ω–æ –ª–µ–≥–∫–æ —Å–æ–∑–¥–∞—Ç—å. –î–∞–≤–∞–π—Ç–µ –æ–ø—Ä–µ–¥–µ–ª–∏–º –ø—Ä–æ—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç `Node`.
–ï—Å—Ç—å –º–∏–ª–ª–∏–æ–Ω —Å–ø–æ—Å–æ–±–æ–≤ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ —Å—Ü–µ–Ω—ã, –∏ —è –Ω–µ —É–≤–µ—Ä–µ–Ω, –∫–∞–∫–æ–π
—Å–ø–æ—Å–æ–± –ª—É—á—à–µ. –°–∞–º—ã–π —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–π - –∏–º–µ—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ –æ–±—ä–µ–∫—Ç–∞ –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è

    var node = {
       localMatrix: ...,  // "–ª–æ–∫–∞–ª—å–Ω–∞—è" –º–∞—Ç—Ä–∏—Ü–∞ –¥–ª—è —ç—Ç–æ–≥–æ —É–∑–ª–∞
       worldMatrix: ...,  // "–º–∏—Ä–æ–≤–∞—è" –º–∞—Ç—Ä–∏—Ü–∞ –¥–ª—è —ç—Ç–æ–≥–æ —É–∑–ª–∞
       children: [],      // –º–∞—Å—Å–∏–≤ –¥–µ—Ç–µ–π
       thingToDraw: ??,   // –æ–±—ä–µ–∫—Ç –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –≤ —ç—Ç–æ–º —É–∑–ª–µ
    };

–î–∞–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–¥–∏–º –≥—Ä–∞—Ñ —Å—Ü–µ–Ω—ã —Å–æ–ª–Ω–µ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã. –Ø –Ω–µ –±—É–¥—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏—á—É–¥–ª–∏–≤—ã–µ —Ç–µ–∫—Å—Ç—É—Ä—ã –∏–ª–∏
—á—Ç–æ-—Ç–æ –ø–æ–¥–æ–±–Ω–æ–µ, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –∑–∞–≥—Ä–æ–º–æ–∑–¥–∏—Ç –ø—Ä–∏–º–µ—Ä. –°–Ω–∞—á–∞–ª–∞ –¥–∞–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–¥–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏–π
–¥–ª—è –ø–æ–º–æ—â–∏ –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —É–∑–ª–∞–º–∏. –°–Ω–∞—á–∞–ª–∞ –º—ã —Å–æ–∑–¥–∞–¥–∏–º –∫–ª–∞—Å—Å —É–∑–ª–∞

    var Node = function() {
      this.children = [];
      this.localMatrix = m4.identity();
      this.worldMatrix = m4.identity();
    };

–î–∞–≤–∞–π—Ç–µ –¥–∞–¥–∏–º –µ–º—É —Å–ø–æ—Å–æ–± —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—è —É–∑–ª–∞.

    Node.prototype.setParent = function(parent) {
      // —É–¥–∞–ª—è–µ–º –Ω–∞—Å –∏–∑ –Ω–∞—à–µ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è
      if (this.parent) {
        var ndx = this.parent.children.indexOf(this);
        if (ndx >= 0) {
          this.parent.children.splice(ndx, 1);
        }
      }

      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—Å –∫ –Ω–∞—à–µ–º—É –Ω–æ–≤–æ–º—É —Ä–æ–¥–∏—Ç–µ–ª—é
      if (parent) {
        parent.children.push(this);
      }
      this.parent = parent;
    };

–ò –≤–æ—Ç –∫–æ–¥ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –º–∏—Ä–æ–≤—ã—Ö –º–∞—Ç—Ä–∏—Ü –∏–∑ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –º–∞—Ç—Ä–∏—Ü –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Ö —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ-–¥–æ—á–µ—Ä–Ω–∏—Ö
–æ—Ç–Ω–æ—à–µ–Ω–∏–π. –ï—Å–ª–∏ –º—ã –Ω–∞—á–Ω–µ–º —Å —Ä–æ–¥–∏—Ç–µ–ª—è –∏ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –ø–æ—Å–µ—Ç–∏–º –¥–µ—Ç–µ–π, –º—ã —Å–º–æ–∂–µ–º –≤—ã—á–∏—Å–ª–∏—Ç—å
–∏—Ö –º–∏—Ä–æ–≤—ã–µ –º–∞—Ç—Ä–∏—Ü—ã. –ï—Å–ª–∏ –≤—ã –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç–µ –º–∞—Ç—Ä–∏—á–Ω—É—é –º–∞—Ç–µ–º–∞—Ç–∏–∫—É,
[–ø—Ä–æ–≤–µ—Ä—å—Ç–µ —ç—Ç—É —Å—Ç–∞—Ç—å—é –æ –Ω–∏—Ö](webgl-2d-matrices.html).

    Node.prototype.updateWorldMatrix = function(parentWorldMatrix) {
      if (parentWorldMatrix) {
        // –±—ã–ª–∞ –ø–µ—Ä–µ–¥–∞–Ω–∞ –º–∞—Ç—Ä–∏—Ü–∞, –ø–æ—ç—Ç–æ–º—É –¥–µ–ª–∞–µ–º –º–∞—Ç–µ–º–∞—Ç–∏–∫—É –∏
        // —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ `this.worldMatrix`.
        m4.multiply(parentWorldMatrix, this.localMatrix, this.worldMatrix);
      } else {
        // –º–∞—Ç—Ä–∏—Ü–∞ –Ω–µ –±—ã–ª–∞ –ø–µ—Ä–µ–¥–∞–Ω–∞, –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä—É–µ–º.
        m4.copy(this.localMatrix, this.worldMatrix);
      }

      // —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ—Ö –¥–µ—Ç–µ–π
      var worldMatrix = this.worldMatrix;
      this.children.forEach(function(child) {
        child.updateWorldMatrix(worldMatrix);
      });
    };

–î–∞–≤–∞–π—Ç–µ –ø—Ä–æ—Å—Ç–æ —Å–¥–µ–ª–∞–µ–º –°–æ–ª–Ω—Ü–µ, –ó–µ–º–ª—é –∏ –õ—É–Ω—É, —á—Ç–æ–±—ã –¥–µ—Ä–∂–∞—Ç—å —ç—Ç–æ –ø—Ä–æ—Å—Ç—ã–º. –ú—ã, –∫–æ–Ω–µ—á–Ω–æ, –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
—Ñ–∞–ª—å—à–∏–≤—ã–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è, —á—Ç–æ–±—ã –≤–µ—â–∏ –ø–æ–º–µ—â–∞–ª–∏—Å—å –Ω–∞ —ç–∫—Ä–∞–Ω–µ. –ú—ã –ø—Ä–æ—Å—Ç–æ –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω—É –º–æ–¥–µ–ª—å —Å—Ñ–µ—Ä—ã
–∏ –æ–∫—Ä–∞—Å–∏–º –µ–µ –∂–µ–ª—Ç–æ–≤–∞—Ç–æ–π –¥–ª—è –°–æ–ª–Ω—Ü–∞, —Å–∏–Ω–µ-–∑–µ–ª–µ–Ω–æ–≤–∞—Ç–æ–π –¥–ª—è –ó–µ–º–ª–∏ –∏ —Å–µ—Ä–æ–≤–∞—Ç–æ–π –¥–ª—è –õ—É–Ω—ã.
–ï—Å–ª–∏ `drawInfo`, `bufferInfo` –∏ `programInfo` –≤–∞–º –Ω–µ –∑–Ω–∞–∫–æ–º—ã, [—Å–º. –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç–∞—Ç—å—é](webgl-drawing-multiple-things.html).

    // –î–∞–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–¥–∏–º –≤—Å–µ —É–∑–ª—ã
    var sunNode = new Node();
    sunNode.localMatrix = m4.translation(0, 0, 0);  // —Å–æ–ª–Ω—Ü–µ –≤ —Ü–µ–Ω—Ç—Ä–µ
    sunNode.drawInfo = {
      uniforms: {
        u_colorOffset: [0.6, 0.6, 0, 1], // –∂–µ–ª—Ç—ã–π
        u_colorMult:   [0.4, 0.4, 0, 1],
      },
      programInfo: programInfo,
      bufferInfo: sphereBufferInfo,
      vertexArray: sphereVAO,
    };

    var earthNode = new Node();
    earthNode.localMatrix = m4.translation(100, 0, 0);  // –∑–µ–º–ª—è –≤ 100 –µ–¥–∏–Ω–∏—Ü–∞—Ö –æ—Ç —Å–æ–ª–Ω—Ü–∞
    earthNode.drawInfo = {
      uniforms: {
        u_colorOffset: [0.2, 0.5, 0.8, 1],  // —Å–∏–Ω–µ-–∑–µ–ª–µ–Ω—ã–π
        u_colorMult:   [0.8, 0.5, 0.2, 1],
      },
      programInfo: programInfo,
      bufferInfo: sphereBufferInfo,
      vertexArray: sphereVAO,
    };

    var moonNode = new Node();
    moonNode.localMatrix = m4.translation(20, 0, 0);  // –ª—É–Ω–∞ –≤ 20 –µ–¥–∏–Ω–∏—Ü–∞—Ö –æ—Ç –∑–µ–º–ª–∏
    moonNode.drawInfo = {
      uniforms: {
        u_colorOffset: [0.6, 0.6, 0.6, 1],  // —Å–µ—Ä—ã–π
        u_colorMult:   [0.1, 0.1, 0.1, 1],
      },
      programInfo: programInfo,
      bufferInfo: sphereBufferInfo,
      vertexArray: sphereVAO,
    };

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –º—ã —Å–æ–∑–¥–∞–ª–∏ —É–∑–ª—ã, –¥–∞–≤–∞–π—Ç–µ —Å–æ–µ–¥–∏–Ω–∏–º –∏—Ö.

    // —Å–æ–µ–¥–∏–Ω—è–µ–º –Ω–µ–±–µ—Å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
    moonNode.setParent(earthNode);
    earthNode.setParent(sunNode);

–ú—ã —Å–Ω–æ–≤–∞ —Å–æ–∑–¥–∞–¥–∏–º —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ –∏ —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è.

    var objects = [
      sunNode,
      earthNode,
      moonNode,
    ];

    var objectsToDraw = [
      sunNode.drawInfo,
      earthNode.drawInfo,
      moonNode.drawInfo,
    ];

–í–æ –≤—Ä–µ–º—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –º—ã –±—É–¥–µ–º –æ–±–Ω–æ–≤–ª—è—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –º–∞—Ç—Ä–∏—Ü—É –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞, —Å–ª–µ–≥–∫–∞ –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞—è –µ–≥–æ.

    // –æ–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–∞—Ç—Ä–∏—Ü—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞.
    m4.multiply(m4.yRotation(0.01), sunNode.localMatrix  , sunNode.localMatrix);
    m4.multiply(m4.yRotation(0.01), earthNode.localMatrix, earthNode.localMatrix);
    m4.multiply(m4.yRotation(0.01), moonNode.localMatrix , moonNode.localMatrix);

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–∞—Ç—Ä–∏—Ü—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã, –º—ã –æ–±–Ω–æ–≤–∏–º –≤—Å–µ –º–∏—Ä–æ–≤—ã–µ –º–∞—Ç—Ä–∏—Ü—ã

    sunNode.updateWorldMatrix();

–ù–∞–∫–æ–Ω–µ—Ü, —Ç–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ —É –Ω–∞—Å –µ—Å—Ç—å –º–∏—Ä–æ–≤—ã–µ –º–∞—Ç—Ä–∏—Ü—ã, –Ω–∞–º –Ω—É–∂–Ω–æ —É–º–Ω–æ–∂–∏—Ç—å –∏—Ö, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å [–º–∞—Ç—Ä–∏—Ü—É worldViewProjection](webgl-3d-perspective.html) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞.

    // –í—ã—á–∏—Å–ª—è–µ–º –≤—Å–µ –º–∞—Ç—Ä–∏—Ü—ã –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
    objects.forEach(function(object) {
      object.drawInfo.uniforms.u_matrix = m4.multiply(viewProjectionMatrix, object.worldMatrix);
    });

–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ - —ç—Ç–æ [—Ç–æ—Ç –∂–µ —Ü–∏–∫–ª, –∫–æ—Ç–æ—Ä—ã–π –º—ã –≤–∏–¥–µ–ª–∏ –≤ –Ω–∞—à–µ–π –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç–∞—Ç—å–µ](webgl-drawing-multiple-things.html).

{{{example url="../webgl-scene-graph-solar-system.html" }}}

–í—ã –∑–∞–º–µ—Ç–∏—Ç–µ, —á—Ç–æ –≤—Å–µ –ø–ª–∞–Ω–µ—Ç—ã –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞. –î–∞–≤–∞–π—Ç–µ –ø–æ–ø—Ä–æ–±—É–µ–º —Å–¥–µ–ª–∞—Ç—å –ó–µ–º–ª—é –±–æ–ª—å—à–µ

    // –∑–µ–º–ª—è –≤ 100 –µ–¥–∏–Ω–∏—Ü–∞—Ö –æ—Ç —Å–æ–ª–Ω—Ü–∞
    earthNode.localMatrix = m4.translation(100, 0, 0));

    // –¥–µ–ª–∞–µ–º –∑–µ–º–ª—é –≤ –¥–≤–∞ —Ä–∞–∑–∞ –±–æ–ª—å—à–µ
    earthNode.localMatrix = m4.scale(earthNode.localMatrix, 2, 2, 2);

{{{example url="../webgl-scene-graph-solar-system-larger-earth.html" }}}

–£–ø—Å. –õ—É–Ω–∞ —Ç–æ–∂–µ —Å—Ç–∞–ª–∞ –±–æ–ª—å—à–µ. –ß—Ç–æ–±—ã –∏—Å–ø—Ä–∞–≤–∏—Ç—å —ç—Ç–æ, –º—ã –º–æ–≥–ª–∏ –±—ã –≤—Ä—É—á–Ω—É—é —É–º–µ–Ω—å—à–∏—Ç—å –ª—É–Ω—É. –õ—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ, –æ–¥–Ω–∞–∫–æ,
–∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –±–æ–ª—å—à–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É–∑–ª–æ–≤ –≤ –Ω–∞—à –≥—Ä–∞—Ñ —Å—Ü–µ–Ω—ã. –í–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç–æ

      —Å–æ–ª–Ω—Ü–µ
       |
      –∑–µ–º–ª—è
       |
      –ª—É–Ω–∞

–ú—ã –∏–∑–º–µ–Ω–∏–º —ç—Ç–æ –Ω–∞

     —Å–æ–ª–Ω–µ—á–Ω–∞—è–°–∏—Å—Ç–µ–º–∞
       |    |
       |   —Å–æ–ª–Ω—Ü–µ
       |
     –æ—Ä–±–∏—Ç–∞–ó–µ–º–ª–∏
       |    |
       |  –∑–µ–º–ª—è
       |
      –æ—Ä–±–∏—Ç–∞–õ—É–Ω—ã
          |
         –ª—É–Ω–∞

–≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –ó–µ–º–ª–µ –≤—Ä–∞—â–∞—Ç—å—Å—è –≤–æ–∫—Ä—É–≥ —Å–æ–ª–Ω–µ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, –Ω–æ –º—ã –º–æ–∂–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ –≤—Ä–∞—â–∞—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –°–æ–ª–Ω—Ü–µ, –∏ —ç—Ç–æ –Ω–µ –±—É–¥–µ—Ç
–≤–ª–∏—è—Ç—å –Ω–∞ –ó–µ–º–ª—é. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ó–µ–º–ª—è –º–æ–∂–µ—Ç –≤—Ä–∞—â–∞—Ç—å—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –õ—É–Ω—ã. –î–∞–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–¥–∏–º –±–æ–ª—å—à–µ —É–∑–ª–æ–≤ –¥–ª—è
`solarSystem`, `earthOrbit` –∏ `moonOrbit`.

    var solarSystemNode = new Node();
    var earthOrbitNode = new Node();

    // –æ—Ä–±–∏—Ç–∞ –ó–µ–º–ª–∏ –≤ 100 –µ–¥–∏–Ω–∏—Ü–∞—Ö –æ—Ç –°–æ–ª–Ω—Ü–∞
    earthOrbitNode.localMatrix = m4.translation(100, 0, 0);
    var moonOrbitNode = new Node();

     // –ª—É–Ω–∞ –≤ 20 –µ–¥–∏–Ω–∏—Ü–∞—Ö –æ—Ç –ó–µ–º–ª–∏
    moonOrbitNode.localMatrix = m4.translation(20, 0, 0);

–¢–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –æ—Ä–±–∏—Ç –±—ã–ª–∏ —É–¥–∞–ª–µ–Ω—ã –∏–∑ —Å—Ç–∞—Ä—ã—Ö —É–∑–ª–æ–≤

    var earthNode = new Node();
    -// –∑–µ–º–ª—è –≤ 100 –µ–¥–∏–Ω–∏—Ü–∞—Ö –æ—Ç —Å–æ–ª–Ω—Ü–∞
    -earthNode.localMatrix = m4.translation(100, 0, 0));

    -// –¥–µ–ª–∞–µ–º –∑–µ–º–ª—é –≤ –¥–≤–∞ —Ä–∞–∑–∞ –±–æ–ª—å—à–µ
    -earthNode.localMatrix = m4.scale(earthNode.localMatrix, 2, 2, 2);
    +earthNode.localMatrix = m4.scaling(2, 2, 2);

    var moonNode = new Node();
    -moonNode.localMatrix = m4.translation(20, 0, 0);  // –ª—É–Ω–∞ –≤ 20 –µ–¥–∏–Ω–∏—Ü–∞—Ö –æ—Ç –∑–µ–º–ª–∏

–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏—Ö —Ç–µ–ø–µ—Ä—å –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫

    // —Å–æ–µ–¥–∏–Ω—è–µ–º –Ω–µ–±–µ—Å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
    sunNode.setParent(solarSystemNode);
    earthOrbitNode.setParent(solarSystemNode);
    earthNode.setParent(earthOrbitNode);
    moonOrbitNode.setParent(earthOrbitNode);
    moonNode.setParent(moonOrbitNode);

–ò –Ω–∞–º –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–∏—Ç—å –æ—Ä–±–∏—Ç—ã

    // –æ–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–∞—Ç—Ä–∏—Ü—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞.
    -m4.multiply(m4.yRotation(0.01), sunNode.localMatrix  , sunNode.localMatrix);
    -m4.multiply(m4.yRotation(0.01), earthNode.localMatrix, earthNode.localMatrix);
    -m4.multiply(m4.yRotation(0.01), moonNode.localMatrix , moonNode.localMatrix);
    +m4.multiply(m4.yRotation(0.01), earthOrbitNode.localMatrix, earthOrbitNode.localMatrix);
    +m4.multiply(m4.yRotation(0.01), moonOrbitNode.localMatrix, moonOrbitNode.localMatrix);

    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –º–∏—Ä–æ–≤—ã–µ –º–∞—Ç—Ä–∏—Ü—ã –≤ –≥—Ä–∞—Ñ–µ —Å—Ü–µ–Ω—ã
    -sunNode.updateWorldMatrix();
    +solarSystemNode.updateWorldMatrix();

–ò —Ç–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–∏–¥–µ—Ç—å, —á—Ç–æ –ó–µ–º–ª—è –≤ –¥–≤–∞ —Ä–∞–∑–∞ –±–æ–ª—å—à–µ, –∞ –õ—É–Ω–∞ –Ω–µ—Ç.

{{{example url="../webgl-scene-graph-solar-system-larger-earth-fixed.html" }}}

–í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ –∑–∞–º–µ—Ç–∏—Ç—å, —á—Ç–æ –°–æ–ª–Ω—Ü–µ –∏ –ó–µ–º–ª—è –±–æ–ª—å—à–µ –Ω–µ –≤—Ä–∞—â–∞—é—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ. –¢–µ–ø–µ—Ä—å —ç—Ç–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ.

–î–∞–≤–∞–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏–º –µ—â–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–µ—â–µ–π.

    -sunNode.localMatrix = m4.translation(0, 0, 0);  // —Å–æ–ª–Ω—Ü–µ –≤ —Ü–µ–Ω—Ç—Ä–µ
    +sunNode.localMatrix = m4.scaling(5, 5, 5);

    ...

    *moonOrbitNode.localMatrix = m4.translation(30, 0, 0);

    ...

    +moonNode.localMatrix = m4.scaling(0.4, 0.4, 0.4);

    ...
    // –æ–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–∞—Ç—Ä–∏—Ü—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞.
    m4.multiply(m4.yRotation(0.01), earthOrbitNode.localMatrix, earthOrbitNode.localMatrix);
    m4.multiply(m4.yRotation(0.01), moonOrbitNode.localMatrix, moonOrbitNode.localMatrix);
    +// –≤—Ä–∞—â–∞–µ–º —Å–æ–ª–Ω—Ü–µ
    +m4.multiply(m4.yRotation(0.005), sunNode.localMatrix, sunNode.localMatrix);
    +// –≤—Ä–∞—â–∞–µ–º –∑–µ–º–ª—é
    +m4.multiply(m4.yRotation(0.05), earthNode.localMatrix, earthNode.localMatrix);
    +// –≤—Ä–∞—â–∞–µ–º –ª—É–Ω—É
    +m4.multiply(m4.yRotation(-0.01), moonNode.localMatrix, moonNode.localMatrix);

{{{example url="../webgl-scene-graph-solar-system-adjusted.html" }}}

–í –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è —É –Ω–∞—Å –µ—Å—Ç—å `localMatrix`, –∏ –º—ã –∏–∑–º–µ–Ω—è–µ–º –µ–≥–æ –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä. –û–¥–Ω–∞–∫–æ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º–∞
–≤ —Ç–æ–º, —á—Ç–æ –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä –Ω–∞—à–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –±—É–¥–µ—Ç –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å –Ω–µ–±–æ–ª—å—à—É—é –æ—à–∏–±–∫—É. –ï—Å—Ç—å —Å–ø–æ—Å–æ–± –∏—Å–ø—Ä–∞–≤–∏—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏–∫—É,
–∫–æ—Ç–æ—Ä—ã–π –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è *–æ—Ä—Ç–æ–≥–æ–Ω–∞–ª—å–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Ç—Ä–∏—Ü—ã*, –Ω–æ –¥–∞–∂–µ —ç—Ç–æ –Ω–µ –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–∞–≤–∞–π—Ç–µ
–ø—Ä–µ–¥—Å—Ç–∞–≤–∏–º, —á—Ç–æ –º—ã –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–ª–∏ –¥–æ –Ω—É–ª—è –∏ –æ–±—Ä–∞—Ç–Ω–æ. –î–∞–≤–∞–π—Ç–µ –ø—Ä–æ—Å—Ç–æ —Å–¥–µ–ª–∞–µ–º —ç—Ç–æ –¥–ª—è –æ–¥–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è `x`

    x = 246;       // –∫–∞–¥—Ä #0, x = 246

    scale = 1;
    x = x * scale  // –∫–∞–¥—Ä #1, x = 246

    scale = 0.5;
    x = x * scale  // –∫–∞–¥—Ä #2, x = 123

    scale = 0;
    x = x * scale  // –∫–∞–¥—Ä #3, x = 0

    scale = 0.5;
    x = x * scale  // –∫–∞–¥—Ä #4, x = 0  –£–ü–°!

    scale = 1;
    x = x * scale  // –∫–∞–¥—Ä #5, x = 0  –£–ü–°!

–ú—ã –ø–æ—Ç–µ—Ä—è–ª–∏ –Ω–∞—à–µ –∑–Ω–∞—á–µ–Ω–∏–µ. –ú—ã –º–æ–∂–µ–º –∏—Å–ø—Ä–∞–≤–∏—Ç—å —ç—Ç–æ, –¥–æ–±–∞–≤–∏–≤ –∫–∞–∫–æ–π-—Ç–æ –¥—Ä—É–≥–æ–π –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –æ–±–Ω–æ–≤–ª—è–µ—Ç –º–∞—Ç—Ä–∏—Ü—É –∏–∑
–¥—Ä—É–≥–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π. –î–∞–≤–∞–π—Ç–µ –∏–∑–º–µ–Ω–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ `Node`, —á—Ç–æ–±—ã –∏–º–µ—Ç—å `source`. –ï—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –º—ã
–ø–æ–ø—Ä–æ—Å–∏–º `source` –¥–∞—Ç—å –Ω–∞–º –ª–æ–∫–∞–ª—å–Ω—É—é –º–∞—Ç—Ä–∏—Ü—É.

    *var Node = function(source) {
      this.children = [];
      this.localMatrix = makeIdentity();
      this.worldMatrix = makeIdentity();
    +  this.source = source;
    };

    Node.prototype.updateWorldMatrix = function(matrix) {

    +  var source = this.source;
    +  if (source) {
    +    source.getMatrix(this.localMatrix);
    +  }

      ...

–¢–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º —Å–æ–∑–¥–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫. –û–±—â–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫ - —ç—Ç–æ —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ, –ø–æ–≤–æ—Ä–æ—Ç –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ,
—á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ —ç—Ç–æ–≥–æ

    var TRS = function() {
      this.translation = [0, 0, 0];
      this.rotation = [0, 0, 0];
      this.scale = [1, 1, 1];
    };

    TRS.prototype.getMatrix = function(dst) {
      dst = dst || new Float32Array(16);
      var t = this.translation;
      var r = this.rotation;
      var s = this.scale;

      // –≤—ã—á–∏—Å–ª—è–µ–º –º–∞—Ç—Ä–∏—Ü—É –∏–∑ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è, –ø–æ–≤–æ—Ä–æ—Ç–∞ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
      m4.translation(t[0], t[1], t[2], dst);
      m4.xRotate(dst, r[0], dst);
      m4.yRotate(dst, r[1], dst);
      m4.zRotate(dst, r[2], dst);
      m4.scale(dst, s[0], s[1], s[2]), dst);
      return dst;
    };

–ò –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ —Ç–∞–∫

    // –≤–æ –≤—Ä–µ–º—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–µ–º —É–∑–µ–ª —Å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º
    var someTRS  = new TRS();
    var someNode = new Node(someTRS);

    // –≤–æ –≤—Ä–µ–º—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
    someTRS.rotation[2] += elapsedTime;

–¢–µ–ø–µ—Ä—å –Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º, –ø–æ—Ç–æ–º—É —á—Ç–æ –º—ã –≤–æ—Å—Å–æ–∑–¥–∞–µ–º –º–∞—Ç—Ä–∏—Ü—É –∫–∞–∂–¥—ã–π —Ä–∞–∑.

–í—ã –º–æ–∂–µ—Ç–µ –¥—É–º–∞—Ç—å, —è –Ω–µ —Å–æ–∑–¥–∞—é —Å–æ–ª–Ω–µ—á–Ω—É—é —Å–∏—Å—Ç–µ–º—É, —Ç–∞–∫ –≤ —á–µ–º —Å–º—ã—Å–ª? –ù—É, –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–µ–ª–∏ –±—ã
–∞–Ω–∏–º–∏—Ä–æ–≤–∞—Ç—å —á–µ–ª–æ–≤–µ–∫–∞, –≤—ã –º–æ–≥–ª–∏ –±—ã –∏–º–µ—Ç—å –≥—Ä–∞—Ñ —Å—Ü–µ–Ω—ã, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫

{{{diagram url="resources/person-diagram.html" height="400" }}}

–°–∫–æ–ª—å–∫–æ —Å—É—Å—Ç–∞–≤–æ–≤ –≤—ã –¥–æ–±–∞–≤–ª—è–µ—Ç–µ –¥–ª—è –ø–∞–ª—å—Ü–µ–≤ –∏ –ø–∞–ª—å—Ü–µ–≤ –Ω–æ–≥, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–∞—Å. –ß–µ–º –±–æ–ª—å—à–µ —Å—É—Å—Ç–∞–≤–æ–≤ —É –≤–∞—Å –µ—Å—Ç—å,
—Ç–µ–º –±–æ–ª—å—à–µ –º–æ—â–Ω–æ—Å—Ç–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–π –∏ —Ç–µ–º –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö –∞–Ω–∏–º–∞—Ü–∏–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è
–¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Å—É—Å—Ç–∞–≤–æ–≤. –°—Ç–∞—Ä—ã–µ –∏–≥—Ä—ã, —Ç–∞–∫–∏–µ –∫–∞–∫ Virtua Fighter, –∏–º–µ–ª–∏ –æ–∫–æ–ª–æ 15 —Å—É—Å—Ç–∞–≤–æ–≤.
–ò–≥—Ä—ã –≤ –Ω–∞—á–∞–ª–µ-—Å–µ—Ä–µ–¥–∏–Ω–µ 2000-—Ö –∏–º–µ–ª–∏ –æ—Ç 30 –¥–æ 70 —Å—É—Å—Ç–∞–≤–æ–≤. –ï—Å–ª–∏ –±—ã –≤—ã —Å–¥–µ–ª–∞–ª–∏ –∫–∞–∂–¥—ã–π —Å—É—Å—Ç–∞–≤ –≤ –≤–∞—à–∏—Ö —Ä—É–∫–∞—Ö,
–∏—Ö –ø–æ –∫—Ä–∞–π–Ω–µ–π –º–µ—Ä–µ 20 –≤ –∫–∞–∂–¥–æ–π —Ä—É–∫–µ, –ø–æ—ç—Ç–æ–º—É —Ç–æ–ª—å–∫–æ 2 —Ä—É–∫–∏ - —ç—Ç–æ 40 —Å—É—Å—Ç–∞–≤–æ–≤. –ú–Ω–æ–≥–∏–µ –∏–≥—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç—è—Ç
–∞–Ω–∏–º–∏—Ä–æ–≤–∞—Ç—å —Ä—É–∫–∏, –∞–Ω–∏–º–∏—Ä—É—é—Ç –±–æ–ª—å—à–æ–π –ø–∞–ª–µ—Ü –∫–∞–∫ –æ–¥–∏–Ω –∏ 4 –ø–∞–ª—å—Ü–∞ –∫–∞–∫ –æ–¥–∏–Ω –±–æ–ª—å—à–æ–π –ø–∞–ª–µ—Ü, —á—Ç–æ–±—ã —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å
–≤—Ä–µ–º—è (–∫–∞–∫ CPU/GPU, —Ç–∞–∫ –∏ –≤—Ä–µ–º—è —Ö—É–¥–æ–∂–Ω–∏–∫–∞) –∏ –ø–∞–º—è—Ç—å.

–í –ª—é–±–æ–º —Å–ª—É—á–∞–µ, –≤–æ—Ç –±–ª–æ—á–Ω—ã–π –ø–∞—Ä–µ–Ω—å, –∫–æ—Ç–æ—Ä–æ–≥–æ —è —Å–æ–±—Ä–∞–ª. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫ `TRS` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ
—É–∑–ª–∞, —É–ø–æ–º—è–Ω—É—Ç–æ–≥–æ –≤—ã—à–µ. –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—Å–∫–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ –∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—Å–∫–∞—è –∞–Ω–∏–º–∞—Ü–∏—è FTW! üòÇ

{{{example url="../webgl-scene-graph-block-guy.html" }}}

–ï—Å–ª–∏ –≤—ã –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –ª—é–±—É—é 3D –±–∏–±–ª–∏–æ—Ç–µ–∫—É, –≤—ã –Ω–∞–π–¥–µ—Ç–µ –≥—Ä–∞—Ñ —Å—Ü–µ–Ω—ã, –ø–æ—Ö–æ–∂–∏–π –Ω–∞ —ç—Ç–æ—Ç.
–ß—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∏–µ—Ä–∞—Ä—Ö–∏–π, –æ–±—ã—á–Ω–æ –æ–Ω–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ –∫–∞–∫–æ–º-—Ç–æ –ø–∞–∫–µ—Ç–µ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è
–∏–ª–∏ –ø–∞–∫–µ—Ç–µ –∫–æ–º–ø–æ–Ω–æ–≤–∫–∏ —É—Ä–æ–≤–Ω–µ–π.

<div class="webgl_bottombar">
<h3>SetParent vs AddChild / RemoveChild</h3>
<p>–ú–Ω–æ–≥–∏–µ –≥—Ä–∞—Ñ—ã —Å—Ü–µ–Ω –∏–º–µ—é—Ç —Ñ—É–Ω–∫—Ü–∏—é <code>node.addChild</code> –∏ —Ñ—É–Ω–∫—Ü–∏—é <code>node.removeChild</code>,
—Ç–æ–≥–¥–∞ –∫–∞–∫ –≤—ã—à–µ —è —Å–æ–∑–¥–∞–ª —Ñ—É–Ω–∫—Ü–∏—é <code>node.setParent</code>. –ö–∞–∫–æ–π —Å–ø–æ—Å–æ–± –ª—É—á—à–µ
—Å–ø–æ—Ä–Ω–æ —è–≤–ª—è–µ—Ç—Å—è –≤–æ–ø—Ä–æ—Å–æ–º —Å—Ç–∏–ª—è, –Ω–æ —è –±—ã —É—Ç–≤–µ—Ä–∂–¥–∞–ª, —á—Ç–æ –µ—Å—Ç—å –æ–¥–Ω–∞ –æ–±—ä–µ–∫—Ç–∏–≤–Ω–æ –ª—É—á—à–∞—è –ø—Ä–∏—á–∏–Ω–∞,
–ø–æ—á–µ–º—É <code>setParent</code> –ª—É—á—à–µ, —á–µ–º <code>addChild</code>, –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–¥, –ø–æ–¥–æ–±–Ω—ã–π
—ç—Ç–æ–º—É, –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã–º.</p>
<pre class="prettyprint">{{#escapehtml}}
    someParent.addChild(someNode);
    ...
    someOtherParent.addChild(someNode);
{{/escapehtml}}</pre>
<p>–ß—Ç–æ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç? –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ª–∏ <code>someNode</code> –∫ –æ–±–æ–∏–º <code>someParent</code> –∏ <code>someOtherParent</code>?
–í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –≥—Ä–∞—Ñ–æ–≤ —Å—Ü–µ–Ω —ç—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ª–∏ –≤—Ç–æ—Ä–æ–π –≤—ã–∑–æ–≤ –æ—à–∏–±–∫—É?
<code>ERROR: Already have parent</code>. –£–¥–∞–ª—è–µ—Ç –ª–∏ –æ–Ω –º–∞–≥–∏—á–µ—Å–∫–∏ <code>someNode</code> –∏–∑ <code>someParent</code> –ø–µ—Ä–µ–¥
–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫ <code>someOtherParent</code>? –ï—Å–ª–∏ –¥–∞, —Ç–æ —ç—Ç–æ, –∫–æ–Ω–µ—á–Ω–æ, –Ω–µ —è—Å–Ω–æ –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è <code>addChild</code>.
</p>
<p><code>setParent</code> —Å –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã –Ω–µ –∏–º–µ–µ—Ç —Ç–∞–∫–æ–π –ø—Ä–æ–±–ª–µ–º—ã</p>
<pre class="prettyprint">{{#escapehtml}}
    someNode.setParent(someParent);
    ...
    someNode.setParent(someOtherParent);
{{/escapehtml}}</pre>
<p>
–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –Ω–∞ 100% –æ—á–µ–≤–∏–¥–Ω–æ, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç. –ù—É–ª–µ–≤–∞—è –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç—å.
</p>
</div> 