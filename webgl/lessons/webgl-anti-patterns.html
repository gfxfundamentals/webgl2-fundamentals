<!DOCTYPE html>
<!-- this file is auto-generated from webgl/lessons/webgl-anti-patterns.md. Do not edited directly -->
<!--
Copyright 2021, GFXFundamentals.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

*   Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.

*   Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the following disclaimer
    in the documentation and/or other materials provided with the
    distribution.

*   Neither the name of GFXFundamentals. nor the names of his
    contributors may be used to endorse or promote products derived from
    this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="What not to do in WebGL, why not to do it, and what to do instead">
<meta name="keywords" content="webgl webgl2 graphics">
<meta name="thumbnail" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-anti-patterns_en.jpg">

<meta property="og:title" content="WebGL2 Anti-Patterns">
<meta property="og:type" content="website">
<meta property="og:image" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-anti-patterns_en.jpg">
<meta property="og:description" content="What not to do in WebGL, why not to do it, and what to do instead">
<meta property="og:url" content="https://webgl2fundamentals.org/webgl/lessons/webgl-anti-patterns.html">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@greggman">
<meta name="twitter:creator" content="@greggman">
<meta name="twitter:domain" content="webgl2fundamentals.org">
<meta name="twitter:title" content="WebGL2 Anti-Patterns">
<meta name="twitter:url" content="https://webgl2fundamentals.org/webgl/lessons/webgl-anti-patterns.html">
<meta name="twitter:description" content="What not to do in WebGL, why not to do it, and what to do instead">
<meta name="twitter:image:src" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-anti-patterns_en.jpg">

<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@graph":[
    {
      "@type":"WebSite",
      "@id":"https://webgl2fundamentals.org/#website",
      "url":"https://webgl2fundamentals.org/",
      "name":"Webgl2Fundamentals"
    },
    {
      "@type":"ImageObject",
      "@id":"https://webgl2fundamentals.org/webgl/lessons/webgl-anti-patterns.html#primaryimage",
      "url":"https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-anti-patterns_en.jpg",
      "width":1200,
      "height":630
    },
    {
      "@type":"WebPage",
      "@id":"https://webgl2fundamentals.org/webgl/lessons/webgl-anti-patterns.html#webpage",
      "url":"https://webgl2fundamentals.org/webgl/lessons/webgl-anti-patterns.html",
      "inLanguage":"en",
      "name":"WebGL2 Anti-Patterns",
      "keywords":"webgl webgl2 graphics programming",
      "isPartOf":{
        "@id":"https://webgl2fundamentals.org/#website"
      },
      "primaryImageOfPage":{
        "@id":"https://webgl2fundamentals.org/webgl/lessons/webgl-anti-patterns.html#primaryimage"
      }
    }
  ]
}
</script>


<title>WebGL2 Anti-Patterns</title>
<link href="/webgl/lessons/resources/webgl2fundamentals-icon.png" rel="shortcut icon" type="image/png">
<link rel="stylesheet" href="/webgl/lessons/lang.css">
<link rel="stylesheet" href="/webgl/lessons/resources/lesson.css">

  <link rel="alternate" hreflang="en" href="https://webglfundamentals.org/webgl/lessons/webgl-anti-patterns.html">
  <link rel="alternate" hreflang="de" href="https://webglfundamentals.org/webgl/lessons/de/webgl-anti-patterns.html">
  <link rel="alternate" hreflang="ja" href="https://webglfundamentals.org/webgl/lessons/ja/webgl-anti-patterns.html">
  <link rel="alternate" hreflang="ko" href="https://webglfundamentals.org/webgl/lessons/ko/webgl-anti-patterns.html">
  <link rel="alternate" hreflang="pt-br" href="https://webglfundamentals.org/webgl/lessons/pt-br/webgl-anti-patterns.html">
  <link rel="alternate" hreflang="zh_cn" href="https://webglfundamentals.org/webgl/lessons/zh_cn/webgl-anti-patterns.html">




</head>
<body>
<div class="webgl_navbar">
  <div>
    <select class="language">
    <option value="/webgl/lessons/webgl-anti-patterns.html" selected>English</a>
    <option value="/webgl/lessons/de/webgl-anti-patterns.html" >Deutsch</a>
    <option value="/webgl/lessons/ja/webgl-anti-patterns.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-anti-patterns.html" >한국어</a>
    <option value="/webgl/lessons/pt-br/webgl-anti-patterns.html" >Português Brasileiro</a>
    <option value="/webgl/lessons/zh_cn/webgl-anti-patterns.html" >简体中文</a>
</select>


    <a href="#toc">Table of Contents</a>
  </div>
</div>
<div class="webgl_header">
  <h1><a href="/">WebGL2Fundamentals.org</a></h1>
<style>
#forkongithub>div {
    background: #000;
    color: #fff;
    font-family: arial,sans-serif;
    text-align: center;
    font-weight: bold;
    padding: 5px 40px;
    font-size: 0.9rem;
    line-height: 1.3rem;
    position: relative;
    transition: 0.5s;
    display: block;
    width: 400px;
    position: absolute;
    top: 0;
    right: 0;
    transform: translateX(200px) rotate(45deg) translate(10px,70px);
    box-shadow: 4px 4px 10px rgba(0,0,0,0.8);
    pointer-events: auto;
}
#forkongithub a {
  text-decoration: none;
  color: #fff;
}
#forkongithub>div:hover {
    background: #c11;
    color: #fff;
}
#forkongithub .contributors {
  font-size: 0.75rem;
  background: rgba(255,255,255,0.2);
  line-height: 1.2;
  padding: 0.1em;
}
#forkongithub>div::before,#forkongithub>div::after {
    content: "";
    width: 100%;
    display: block;
    position: absolute;
    top: 1px;
    left: 0;
    height: 1px;
    background: #fff;
}
#forkongithub>div::after {
    bottom: 1px;
    top: auto;
}

#forkongithub{
    z-index: 9999;
    /* needed for firefox */
    overflow: hidden;
    width: 300px;
    height: 300px;
    position: absolute;
    right: 0;
    top: 0;
    pointer-events: none;
}
#forkongithub svg{
  width: 1em;
  height: 1em;
  vertical-align: middle;
}
#forkongithub img {
  width: 1em;
  height: 1em;
  border-radius: 100%;
  vertical-align: middle;
}

@media (max-width: 900px) {
    #forkongithub>div {
        line-height: 1.2rem;
    }
}
@media (max-width: 700px) {
  #forkongithub {
    display: none;
  }
}
@media (max-width: 410px) {
    #forkongithub>div {
        font-size: 0.7rem;
        transform: translateX(150px) rotate(45deg) translate(20px,40px);
    }
}

</style>
<div id="forkongithub"><div><div><a href="https://github.com/gfxfundamentals/webgl2-fundamentals">Fix, Fork, Contribute <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 136 133" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(3.92891,0,0,3.92891,67.867,129.125)">
        <path d="M0,-31.904C-8.995,-31.904 -16.288,-24.611 -16.288,-15.614C-16.288,-8.417 -11.621,-2.312 -5.148,-0.157C-4.333,-0.008 -4.036,-0.511 -4.036,-0.943C-4.036,-1.329 -4.05,-2.354 -4.058,-3.713C-8.589,-2.729 -9.545,-5.897 -9.545,-5.897C-10.286,-7.779 -11.354,-8.28 -11.354,-8.28C-12.833,-9.29 -11.242,-9.27 -11.242,-9.27C-9.607,-9.155 -8.747,-7.591 -8.747,-7.591C-7.294,-5.102 -4.934,-5.821 -4.006,-6.238C-3.858,-7.29 -3.438,-8.008 -2.972,-8.415C-6.589,-8.826 -10.392,-10.224 -10.392,-16.466C-10.392,-18.244 -9.757,-19.698 -8.715,-20.837C-8.883,-21.249 -9.442,-22.905 -8.556,-25.148C-8.556,-25.148 -7.188,-25.586 -4.076,-23.478C-2.777,-23.84 -1.383,-24.02 0.002,-24.026C1.385,-24.02 2.779,-23.84 4.08,-23.478C7.19,-25.586 8.555,-25.148 8.555,-25.148C9.444,-22.905 8.885,-21.249 8.717,-20.837C9.761,-19.698 10.392,-18.244 10.392,-16.466C10.392,-10.208 6.583,-8.831 2.954,-8.428C3.539,-7.925 4.06,-6.931 4.06,-5.411C4.06,-3.234 4.04,-1.477 4.04,-0.943C4.04,-0.507 4.333,0 5.16,-0.159C11.628,-2.318 16.291,-8.419 16.291,-15.614C16.291,-24.611 8.997,-31.904 0,-31.904" style="fill:white;"/>
    </g>
</svg>
</a></div></div></div>

</div>


<div class="container">
  <div class="lesson-title">
    <h1>WebGL2 Anti-Patterns</h1>
  </div>
  <div class="lesson">
    <div class="lesson-main">
      <p>This is a list of anti patterns for WebGL. Anti patterns are things you should avoid doing</p>
<ol>
<li><p><a id="viewportwidth"></a>Putting <code class="notranslate" translate="no">viewportWidth</code> and <code class="notranslate" translate="no">viewportHeight</code> on the <code class="notranslate" translate="no">WebGLRenderingContext</code></p>
<p>Some code adds properties for their viewport width and height
and sticks them on the <code class="notranslate" translate="no">WebGLRenderingContext</code> something like this</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">gl = canvas.getContext(&quot;webgl2&quot;);
gl.viewportWidth = canvas.width;    // BAD!!!
gl.viewportHeight = canvas.height;  // BAD!!!
</code></pre><p>Then later they might do something like this</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">gl.viewport(0, 0, gl.viewportWidth, gl.viewportHeight);
</code></pre><p><strong>Why it&#39;s Bad:</strong></p>
<p>It&#39;s objectively bad because you now have 2 properties that need to be updated
anytime you change the size of the canvas. For example if you change the size
of the canvas when the user resizes the window <code class="notranslate" translate="no">gl.viewportWidth</code> &amp; <code class="notranslate" translate="no">gl.viewportHeight</code>
will be wrong unless you set them again.</p>
<p>It&#39;s subjectively bad because any new WebGL programmer will glance at your code
and likely think <code class="notranslate" translate="no">gl.viewportWidth</code> and <code class="notranslate" translate="no">gl.viewportHeight</code> are part of the WebGL
spec, confusing them for months.</p>
<p><strong>What to do instead:</strong></p>
<p>Why make more work for yourself? The WebGL context has its canvas available
and that has a size.</p>
<pre class="prettyprint">
gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);
</pre>

<p>The context also has its width and height directly on it.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">// When you need to set the viewport to match the size of the canvas&#39;s
// drawingBuffer this will always be correct
gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);
</code></pre><p>Even better it will handle extreme cases whereas using <code class="notranslate" translate="no">gl.canvas.width</code>
and <code class="notranslate" translate="no">gl.canvas.height</code> will not. <a href="#drawingbuffer">As for why see here</a>.</p>
</li>
<li><p><a id="canvaswidth"></a>Using <code class="notranslate" translate="no">canvas.width</code> and <code class="notranslate" translate="no">canvas.height</code> for aspect ratio</p>
<p>Often code uses <code class="notranslate" translate="no">canvas.width</code> and <code class="notranslate" translate="no">canvas.height</code> for aspect ratio like this</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">var aspect = canvas.width / canvas.height;
perspective(fieldOfView, aspect, zNear, zFar);
</code></pre><p><strong>Why it&#39;s Bad:</strong></p>
<p>The width and height of the canvas have nothing to do with the size the canvas is
displayed. CSS controls the size the canvas is displayed.</p>
<p><strong>What to do instead:</strong></p>
<p>Use <code class="notranslate" translate="no">canvas.clientWidth</code> and <code class="notranslate" translate="no">canvas.clientHeight</code>. Those values tell you what
size your canvas is actually being displayed on the screen. Using those values
you&#39;ll always get the correct aspect ratio regardless of your CSS settings.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">var aspect = canvas.clientWidth / canvas.clientHeight;
perspective(projectionMatrix, fieldOfView, aspect, zNear, zFar);
</code></pre><p>Here are examples of a canvas who&#39;s drawingbuffers are the same size (<code class="notranslate" translate="no">width=&quot;400&quot; height=&quot;300&quot;</code>)
but using CSS we&#39;ve told the browser to display the canvas a different size.
Notice the samples both display the &#39;F&#39; in the correct aspect ratio.</p>
<p><div class="webgl_diagram_container">
  <iframe class="webgl_example " style="width: 150px; height: 200px;" src="/webgl/lessons/../webgl-canvas-clientwidth-clientheight.html"></iframe>
</div>


<p></p>
<div class="webgl_diagram_container">
  <iframe class="webgl_example " style="width: 400px; height: 150px;" src="/webgl/lessons/../webgl-canvas-clientwidth-clientheight.html"></iframe>
</div>

</p>
<p>If we had used <code class="notranslate" translate="no">canvas.width</code> and <code class="notranslate" translate="no">canvas.height</code> that would not be true.</p>
<p><div class="webgl_diagram_container">
  <iframe class="webgl_example " style="width: 150px; height: 200px;" src="/webgl/lessons/../webgl-canvas-width-height.html"></iframe>
</div>


<p></p>
<div class="webgl_diagram_container">
  <iframe class="webgl_example " style="width: 400px; height: 150px;" src="/webgl/lessons/../webgl-canvas-width-height.html"></iframe>
</div>

</p>
</li>
<li><p><a id="innerwidth"></a>Using <code class="notranslate" translate="no">window.innerWidth</code> and <code class="notranslate" translate="no">window.innerHeight</code> to compute anything</p>
<p>Many WebGL programs use <code class="notranslate" translate="no">window.innerWidth</code> and <code class="notranslate" translate="no">window.innerHeight</code> in many places.
For example:</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">canvas.width = window.innerWidth;                    // BAD!!
canvas.height = window.innerHeight;                  // BAD!!
</code></pre><p><strong>Why it&#39;s Bad:</strong></p>
<p>It&#39;s not portable. Yes, it can work for WebGL pages where you want to make the canvas
fill the screen. The problem comes when you don&#39;t. Maybe you decide to make an article
like these tutorials where your canvas is just some small diagram in a larger page.
Or maybe you need some property editor on the side or a score for a game. Sure you can fix your code
to handle those cases but why not just write it so it works in those cases in the first place?
Then you won&#39;t have to go change any code when you copy it to a new project or use an old
project in a new way.</p>
<p><strong>What to do instead:</strong></p>
<p>Instead of fighting the Web platform, use the Web platform as it was designed to be used.
Use CSS and <code class="notranslate" translate="no">clientWidth</code> and <code class="notranslate" translate="no">clientHeight</code>.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">var width = gl.canvas.clientWidth;
var height = gl.canvas.clientHeight;

gl.canvas.width = width;
gl.canvas.height = height;
</code></pre><p>Here are 9 cases. They all use exactly the same code. Notice that none of them
reference <code class="notranslate" translate="no">window.innerWidth</code> nor <code class="notranslate" translate="no">window.innerHeight</code>.</p>
<p><a href="../webgl-same-code-canvas-fullscreen.html" target="_blank">A page with nothing but a canvas using CSS to make it fullscreen</a></p>
<p><a href="../webgl-same-code-canvas-partscreen.html" target="_blank">A page with a canvas set to using 70% width so there is room for editor controls</a></p>
<p><a href="../webgl-same-code-canvas-embedded.html" target="_blank">A page with a canvas embedded in a paragraph</a></p>
<p><a href="../webgl-same-code-canvas-embedded-border-box.html" target="_blank">A page with a canvas embedded in a paragraph using <code class="notranslate" translate="no">box-sizing: border-box;</code></a></p>
<p><code class="notranslate" translate="no">box-sizing: border-box;</code> makes borders and padding take space from the element they&#39;re defined on rather than outside it. In other words, in
normal box-sizing mode a 400x300 pixel element with 15 pixel border has a 400x300 pixel content space surrounded by a 15 pixel border making its total size
430x330 pixels. In box-sizing: border-box mode the border goes on the inside so that same element would stay 400x300 pixels, the content would end up
being 370x270. This is yet another reason why using <code class="notranslate" translate="no">clientWidth</code> and <code class="notranslate" translate="no">clientHeight</code> is so important. If you set the border to say <code class="notranslate" translate="no">1em</code> you&#39;d have no
way of knowing what size your canvas will turn out. It would be different with different fonts on different machines or different browsers.</p>
<p><a href="../webgl-same-code-container-fullscreen.html" target="_blank">A page with nothing but a container using CSS to make it fullscreen into which the code will insert a canvas</a></p>
<p><a href="../webgl-same-code-container-partscreen.html" target="_blank">A page with a container set to using 70% width so there is room for editor controls into which the code will insert a canvas</a></p>
<p><a href="../webgl-same-code-container-embedded.html" target="_blank">A page with a container embedded in a paragraph into which the code will insert a canvas</a></p>
<p><a href="../webgl-same-code-container-embedded-border-box.html" target="_blank">A page with a container embedded in a paragraph using <code class="notranslate" translate="no">box-sizing: border-box;</code> into which the code will insert a canvas</a></p>
<p><a href="../webgl-same-code-body-only-fullscreen.html" target="_blank">A page with no elements with CSS setup to make it fullscreen into which the code will insert a canvas</a></p>
<p>Again, the point is, if you embrace the web and write your code using the techniques above you won&#39;t have to change any code when you run into different use cases.</p>
</li>
<li><p><a id="resize"></a>Using the <code class="notranslate" translate="no">&#39;resize&#39;</code> event to change the size of your canvas.</p>
<p>Some apps check for the window <code class="notranslate" translate="no">&#39;resize&#39;</code> event like this to resize their canvas.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">window.addEventListener(&#39;resize&#39;, resizeTheCanvas);
</code></pre><p>or this</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">window.onresize = resizeTheCanvas;
</code></pre><p><strong>Why it&#39;s Bad:</strong></p>
<p>It&#39;s not bad per se, rather, for <em>most</em> WebGL programs it fits less use cases.
Specifically <code class="notranslate" translate="no">&#39;resize&#39;</code> only works when the window is resized. It doesn&#39;t work
if the canvas is resized for some other reason. For example let&#39;s say you&#39;re making
a 3D editor. You have your canvas on the left and your settings on the right. You&#39;ve
made it so there&#39;s a draggable bar separating the 2 parts and you can drag that bar
to make the settings area larger or smaller. In this case you won&#39;t get any <code class="notranslate" translate="no">&#39;resize&#39;</code>
events. Similarly if you&#39;ve got a page where other content gets added or removed and
the canvas changes size as the browser re-lays out the page you won&#39;t get a resize
event.</p>
<p><strong>What to do instead:</strong></p>
<p>Like many of the solutions to anti-patterns above there&#39;s a way to write your code
so it just works for most cases. For WebGL apps that constantly draw every frame
the solution is to check if you need to resize every time you draw like this</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">function resizeCanvasToDisplaySize() {
  var width = gl.canvas.clientWidth;
  var height = gl.canvas.clientHeight;
  if (gl.canvas.width != width ||
      gl.canvas.height != height) {
     gl.canvas.width = width;
     gl.canvas.height = height;
  }
}

function render() {
   resizeCanvasToDisplaySize();
   drawStuff();
   requestAnimationFrame(render);
}
render();
</code></pre><p>Now in any of those cases your canvas will scale to the right size. No need to
change any code for different cases. For example using the same code from #3 above
here&#39;s an editor with a sizable editing area.</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-same-code-resize.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-same-code-resize.html" target="_blank">click here to open in a separate window</a>
</div>

</p>
<p>There would be no resize events for this case nor any other where the canvas gets resized
based on the size of other dynamic elements on the page.</p>
<p>For WebGL apps that don&#39;t re-draw every frame the code above is still correct, you&#39;ll just need
to trigger a re-draw in every case where the canvas can possibly get resized. One easy way to use a <code class="notranslate" translate="no">ResizeObserver</code></p>
<pre class="prettyprint">
const resizeObserver = new ResizeObserver(render);
resizeObserver.observe(gl.canvas, {box: 'content-box'});
</pre>
</li>
<li><p><a id="properties"></a>Adding properties to <code class="notranslate" translate="no">WebGLObject</code>s</p>
<p><code class="notranslate" translate="no">WebGLObject</code>s are the various types of resources in WebGL like a <code class="notranslate" translate="no">WebGLBuffer</code>
or <code class="notranslate" translate="no">WebGLTexture</code>. Some apps add properties to those objects. For example code like this:</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">var buffer = gl.createBuffer();
buffer.itemSize = 3;        // BAD!!
buffer.numComponents = 75;  // BAD!!

var program = gl.createProgram();
...
program.u_matrixLoc = gl.getUniformLocation(program, &quot;u_matrix&quot;);  // BAD!!
</code></pre><p><strong>Why it&#39;s Bad:</strong></p>
<p>The reason this is bad is that WebGL can &quot;lose the context&quot;. This can happen for any
reason but the most common reason is if the browser decides too many GPU resources are being used
it might intentionally lose the context on some <code class="notranslate" translate="no">WebGLRenderingContext</code>s to free up space.
WebGL programs that want to always work have to handle this. Google Maps handles this for example.</p>
<p>The problem with the code above is that when the context is lost the WebGL creation functions like
<code class="notranslate" translate="no">gl.createBuffer()</code> above will return <code class="notranslate" translate="no">null</code>. That effectively makes the code this</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">var buffer = null;
buffer.itemSize = 3;        // ERROR!
buffer.numComponents = 75;  // ERROR!
</code></pre><p>That will likely kill your app with an error like</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">TypeError: Cannot set property &#39;itemSize&#39; of null
</code></pre><p>While many apps don&#39;t care if they die when the context is lost it seems like a bad idea
to write code that will have to be fixed later if the developers ever decide to update their
app to handle context lost events.</p>
<p><strong>What to do instead:</strong></p>
<p>If you want to keep <code class="notranslate" translate="no">WebGLObjects</code> and some info about them together one way would be
to use JavaScript objects. For example:</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">var bufferInfo = {
  id: gl.createBuffer(),
  itemSize: 3,
  numComponents: 75,
};

var programInfo = {
  id: program,
  u_matrixLoc: gl.getUniformLocation(program, &quot;u_matrix&quot;),
};
</code></pre><p>Personally I&#39;d suggest <a href="webgl-less-code-more-fun.html">using a few simple helpers that make writing WebGL
much simpler</a>.</p>
</li>
</ol>
<p>Those are a few of what I consider WebGL Anti-Patterns in code I&#39;ve seen around the net.
Hopefully I&#39;ve made the case why to avoid them and given solutions that are easy and useful.</p>
<div class="webgl_bottombar"><a id="drawingbuffer"></a><h3>What is drawingBufferWidth and drawingBufferHeight?</h3>
<p>
GPUs have a limit on how big a rectangle of pixels (texture, renderbuffer) they can support. Often this
size is the next power of 2 larger than whatever a common monitor resolution was at the time the GPU was
made. For example if the GPU was designed to support 1280x1024 screens it might have a size limit of 2048.
If it was designed for 2560x1600 screens it might have a limit of 4096.
</p><p>
That seems reasonable but what happens if you have multiple monitors? Let's say I have a GPU with a limit
of 2048 but I have two 1920x1080 monitors. The user opens a browser window with a WebGL page, they then
stretch that window across both monitors. Your code tries to set the <code class="notranslate" translate="no">canvas.width</code> to
<code class="notranslate" translate="no">canvas.clientWidth</code> which in this case is 3840. What should happen?
</p>
<p>Off the top of my head there are only 3 options</p>
<ol>
<li>
 <p>Throw an exception.</p>
 <p>That seems bad. Most web apps won't be checking for it and the app will crash.
 If the app had user data in it the user just lost their data</p>
</li>
<li>
 <p>Limit the size of the canvas to the GPUs limit</p>
 <p>The problem with this solution is it will also
 likely lead to a crash or possibly a messed up webpage because the code expects the canvas to be the size
 they requested and they expect other parts of the UI and elements on the page to be in the proper places.</p>
</li>
<li>
 <p>Let the canvas be the size the user requested but make its drawingbuffer the limit</p>
 <p>This is the
 solution WebGL uses. If your code is written correctly the only thing the user might notice is the image in
 the canvas is being scaled slightly. Otherwise it just works. In the worst case most WebGL programs that
 don't do the right thing will just have a slightly off display but if the user sizes the window back down
 things will return to normal.</p>
</li>
</ol>
<p>Most people don't have multiple monitors so this issue rarely comes up. Or at least it used to.
Chrome and Safari, at least as of January 2015, had a hard coded limit on canvas size of 4096. Apple's
5k iMac is past that limit. Lots of WebGL apps were having strange displays because of this.
Similarly many people have started using WebGL with multiple monitors for installation work and have
been hitting this limit.</p>
<p>
So, if you want to handle these cases use <code class="notranslate" translate="no">gl.drawingBufferWidth</code> and <code class="notranslate" translate="no">gl.drawingBufferHeight</code> as
shown in #1 above. For most apps if you follow the best practices above things will just work. Be aware
though if you are doing calculations that need to know the actual size of the drawingbuffer you need
to take that into account. Examples off the top of my head, [picking](webgl-picking.html), in other words converting from
mouse coordinates into canvas pixel coordinates. Another would be any kind of post processing
effects that want to know the actual size of the drawingbuffer.
</p>
</div>







    </div>
    <div class="lesson-sidebar">
        <select class="language">
    <option value="/webgl/lessons/webgl-anti-patterns.html" selected>English</a>
    <option value="/webgl/lessons/de/webgl-anti-patterns.html" >Deutsch</a>
    <option value="/webgl/lessons/ja/webgl-anti-patterns.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-anti-patterns.html" >한국어</a>
    <option value="/webgl/lessons/pt-br/webgl-anti-patterns.html" >Português Brasileiro</a>
    <option value="/webgl/lessons/zh_cn/webgl-anti-patterns.html" >简体中文</a>
</select>


        <div id="toc">
          <ul>  <li>Fundamentals</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-getting-webgl2.html">How to use WebGL2</a></li>
<li><a href="/webgl/lessons/webgl-fundamentals.html">Fundamentals</a></li>
<li><a href="/webgl/lessons/webgl-how-it-works.html">How It Works</a></li>
<li><a href="/webgl/lessons/webgl-shaders-and-glsl.html">Shaders and GLSL</a></li>
<li><a href="/webgl/lessons/resources/webgl-state-diagram.html">WebGL2 State Diagram</a></li>
        </ul>
  <li>WebGL2 vs WebGL1</li>
        <ul>
          <li><a href="/webgl/lessons/webgl2-whats-new.html">What's new in WebGL2</a></li>
<li><a href="/webgl/lessons/webgl1-to-webgl2.html">Moving from WebGL1 to WebGL2</a></li>
<li><a href="/webgl/lessons/webgl1-to-webgl2-fundamentals.html">Differences from WebGLFundamentals.org to WebGL2Fundamentals.org</a></li>
        </ul>
  <li>Image Processing</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-image-processing.html">Image Processing</a></li>
<li><a href="/webgl/lessons/webgl-image-processing-continued.html">Image Processing Continued</a></li>
        </ul>
  <li>2D translation, rotation, scale, matrix math</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-2d-translation.html">2D Translation</a></li>
<li><a href="/webgl/lessons/webgl-2d-rotation.html">2D Rotation</a></li>
<li><a href="/webgl/lessons/webgl-2d-scale.html">2D Scale</a></li>
<li><a href="/webgl/lessons/webgl-2d-matrices.html">2D Matrices</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-3d-orthographic.html">Orthographic 3D</a></li>
<li><a href="/webgl/lessons/webgl-3d-perspective.html">3D Perspective</a></li>
<li><a href="/webgl/lessons/webgl-3d-camera.html">3D - Cameras</a></li>
<li><a href="/webgl/lessons/webgl-matrix-naming.html">3D - Matrix Naming</a></li>
        </ul>
  <li>Lighting</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-3d-lighting-directional.html">Directional Lighting</a></li>
<li><a href="/webgl/lessons/webgl-3d-lighting-point.html">Point Lighting</a></li>
<li><a href="/webgl/lessons/webgl-3d-lighting-spot.html">Spot Lighting</a></li>
        </ul>
  <li>Structure and Organization</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-less-code-more-fun.html">Less Code, More Fun</a></li>
<li><a href="/webgl/lessons/webgl-drawing-multiple-things.html">Drawing Multiple Things</a></li>
<li><a href="/webgl/lessons/webgl-scene-graph.html">Scene Graphs</a></li>
        </ul>
  <li>Geometry</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-3d-geometry-lathe.html">3D Geometry - Lathe</a></li>
<li><a href="/webgl/lessons/webgl-load-obj.html">Loading .obj files</a></li>
<li><a href="/webgl/lessons/webgl-load-obj-w-mtl.html">Loading .obj w .mtl files</a></li>
        </ul>
  <li>Textures</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-3d-textures.html">Textures</a></li>
<li><a href="/webgl/lessons/webgl-data-textures.html">Data Textures</a></li>
<li><a href="/webgl/lessons/webgl-2-textures.html">Using 2 or More Textures</a></li>
<li><a href="/webgl/lessons/webgl-cors-permission.html">Cross Origin Images</a></li>
<li><a href="/webgl/lessons/webgl-3d-perspective-correct-texturemapping.html">Perspective Correct Texture Mapping</a></li>
<li><a href="/webgl/lessons/webgl-planar-projection-mapping.html">Planar and Perspective Projection Mapping</a></li>
        </ul>
  <li>Rendering To A Texture</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-render-to-texture.html">Render to Texture</a></li>
        </ul>
  <li>Shadows</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-shadows.html">Shadows</a></li>
        </ul>
  <li>Techniques</li>
        <ul>
            <li>2D</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-2d-drawimage.html">2D - DrawImage</a></li>
<li><a href="/webgl/lessons/webgl-2d-matrix-stack.html">2D - Matrix Stack</a></li>
<li><a href="/webgl/lessons/webgl-sprites.html">Sprites</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-cube-maps.html">Cubemaps</a></li>
<li><a href="/webgl/lessons/webgl-environment-maps.html">Environment maps</a></li>
<li><a href="/webgl/lessons/webgl-skybox.html">Skyboxes</a></li>
<li><a href="/webgl/lessons/webgl-skinning.html">Skinning</a></li>
<li><a href="/webgl/lessons/webgl-fog.html">Fog</a></li>
<li><a href="/webgl/lessons/webgl-picking.html">Picking (clicking on stuff)</a></li>
        </ul>
  <li>Text</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-text-html.html">Text - HTML</a></li>
<li><a href="/webgl/lessons/webgl-text-canvas2d.html">Text - Canvas 2D</a></li>
<li><a href="/webgl/lessons/webgl-text-texture.html">Text - Using a Texture</a></li>
<li><a href="/webgl/lessons/webgl-text-glyphs.html">Text - Using a Glyph Texture</a></li>
        </ul>
  <li>GPGPU</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-gpgpu.html">GPGPU</a></li>
        </ul>
        </ul>
  <li>Tips</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-smallest-programs.html">Smallest Programs</a></li>
<li><a href="/webgl/lessons/webgl-drawing-without-data.html">Drawing Without Data</a></li>
<li><a href="/webgl/lessons/webgl-shadertoy.html">Shadertoy</a></li>
<li><a href="/webgl/lessons/webgl-pulling-vertices.html">Pulling Vertices</a></li>
        </ul>
  <li>Optimization</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-indexed-vertices.html">Indexed Vertices (gl.drawElements)</a></li>
<li><a href="/webgl/lessons/webgl-instanced-drawing.html">Instanced Drawing</a></li>
        </ul>
  <li>Misc</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-setup-and-installation.html">Setup And Installation</a></li>
<li><a href="/webgl/lessons/webgl-boilerplate.html">Boilerplate</a></li>
<li><a href="/webgl/lessons/webgl-resizing-the-canvas.html">Resizing the Canvas</a></li>
<li><a href="/webgl/lessons/webgl-animation.html">Animation</a></li>
<li><a href="/webgl/lessons/webgl-points-lines-triangles.html">Points, Lines, and Triangles</a></li>
<li><a href="/webgl/lessons/webgl-multiple-views.html">Multiple Views, Multiple Canvases</a></li>
<li><a href="/webgl/lessons/webgl-visualizing-the-camera.html">Visualizing the Camera</a></li>
<li><a href="/webgl/lessons/webgl-and-alpha.html">WebGL2 and Alpha</a></li>
<li><a href="/webgl/lessons/webgl-2d-vs-3d-library.html">2D vs 3D libraries</a></li>
<li><a href="/webgl/lessons/webgl-anti-patterns.html">Anti-Patterns</a></li>
<li><a href="/webgl/lessons/webgl-matrix-vs-math.html">WebGL2 Matrices vs Math Matrices</a></li>
<li><a href="/webgl/lessons/webgl-precision-issues.html">Precision Issues</a></li>
<li><a href="/webgl/lessons/webgl-tips.html#screenshot">Taking a screenshot</a></li>
<li><a href="/webgl/lessons/webgl-tips.html#preservedrawingbuffer">Prevent the Canvas Being Cleared</a></li>
<li><a href="/webgl/lessons/webgl-tips.html#tabindex">Get Keyboard Input From a Canvas</a></li>
<li><a href="/webgl/lessons/webgl-tips.html#html-background">Use WebGL2 as Background in HTML</a></li>
<li><a href="/webgl/lessons/webgl-cross-platform-issues.html">Cross Platform Issues</a></li>
<li><a href="/webgl/lessons/webgl-qna.html">Questions and Answers</a></li>
        </ul>
  <li>Reference</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-attributes.html">Attributes</a></li>
<li><a href="/webgl/lessons/webgl-texture-units.html">Texture Units</a></li>
<li><a href="/webgl/lessons/webgl-framebuffers.html">Framebuffers</a></li>
<li><a href="/webgl/lessons/webgl-readpixels.html">readPixels</a></li>
<li><a href="/webgl/lessons/webgl-references.html">References</a></li>
        </ul></ul>
<ul>
  <li><a href="/docs/">Helper API Docs</a></li>
  <li><a href="https://twgljs.org">TWGL, A tiny WebGL helper library</a></li>
  <li><a href="https://github.com/gfxfundamentals/webgl2-fundamentals">github</a></li>
</ul>
        </div>
    </div>
    <div class="lesson-comments">
        
<div>Issue/Bug? <a href="https://github.com/gfxfundamentals/webgl2-fundamentals/issues">Create an issue on github</a>.</div>
<div class="lesson-comment-notes">
   Use <b>&lt;pre&gt;&lt;code&gt;</b>code goes here<b>&lt;/code&gt;&lt;/pre&gt;</b> for code blocks
</div>
  

        <div id="disqus_thread"></div>
        <script>
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'webgl2fundamentals'; // required: replace example with your forum shortname
            var disqus_identifier = 'WebGL2 Anti-Patterns';
            var disqus_title = 'WebGL2 Anti-Patterns';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                if (window.location.hostname.indexOf("webgl2fundamentals.org") < 0) {
                    return;
                }
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>
</div>
</body>
<script>
const settings = {
  contribTemplate: "Thank you <a href=\"${html_url}\"><img src=\"${avatar_url}\"> ${login}</a><br>for <a href=\"https://github.com/${owner}/${repo}/commits?author=${login}\">${contributions} contributions</a>",
  owner: "gfxfundamentals",
  repo: "webgl2-fundamentals",
};
</script>
<script src="/contributors.js"></script>
<script src="/3rdparty/jquery-1.11.2.min.js"></script>
<script src="/webgl/lessons/resources/prettify.js"></script>
<script src="/webgl/lessons/resources/lesson.js" type="module"></script>
<script>
</script>


</html>



