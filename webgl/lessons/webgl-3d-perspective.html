<!DOCTYPE html>
<!-- this file is auto-generated from webgl/lessons/webgl-3d-perspective.md. Do not edited directly -->
<!--
Copyright 2021, GFXFundamentals.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

*   Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.

*   Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the following disclaimer
    in the documentation and/or other materials provided with the
    distribution.

*   Neither the name of GFXFundamentals. nor the names of his
    contributors may be used to endorse or promote products derived from
    this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="How to display perspective in 3D in WebGL">
<meta name="keywords" content="webgl webgl2 graphics">
<meta name="thumbnail" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-3d-perspective_en.jpg">

<meta property="og:title" content="WebGL2 3D Perspective">
<meta property="og:type" content="website">
<meta property="og:image" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-3d-perspective_en.jpg">
<meta property="og:description" content="How to display perspective in 3D in WebGL">
<meta property="og:url" content="https://webgl2fundamentals.org/webgl/lessons/webgl-3d-perspective.html">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@greggman">
<meta name="twitter:creator" content="@greggman">
<meta name="twitter:domain" content="webgl2fundamentals.org">
<meta name="twitter:title" content="WebGL2 3D Perspective">
<meta name="twitter:url" content="https://webgl2fundamentals.org/webgl/lessons/webgl-3d-perspective.html">
<meta name="twitter:description" content="How to display perspective in 3D in WebGL">
<meta name="twitter:image:src" content="https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-3d-perspective_en.jpg">

<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@graph":[
    {
      "@type":"WebSite",
      "@id":"https://webgl2fundamentals.org/#website",
      "url":"https://webgl2fundamentals.org/",
      "name":"Webgl2Fundamentals"
    },
    {
      "@type":"ImageObject",
      "@id":"https://webgl2fundamentals.org/webgl/lessons/webgl-3d-perspective.html#primaryimage",
      "url":"https://webgl2fundamentals.org/webgl/lessons/screenshots/webgl-3d-perspective_en.jpg",
      "width":1200,
      "height":630
    },
    {
      "@type":"WebPage",
      "@id":"https://webgl2fundamentals.org/webgl/lessons/webgl-3d-perspective.html#webpage",
      "url":"https://webgl2fundamentals.org/webgl/lessons/webgl-3d-perspective.html",
      "inLanguage":"en",
      "name":"WebGL2 3D Perspective",
      "keywords":"webgl webgl2 graphics programming",
      "isPartOf":{
        "@id":"https://webgl2fundamentals.org/#website"
      },
      "primaryImageOfPage":{
        "@id":"https://webgl2fundamentals.org/webgl/lessons/webgl-3d-perspective.html#primaryimage"
      }
    }
  ]
}
</script>


<title>WebGL2 3D Perspective</title>
<link href="/webgl/lessons/resources/webgl2fundamentals-icon.png" rel="shortcut icon" type="image/png">
<link rel="stylesheet" href="/webgl/lessons/lang.css">
<link rel="stylesheet" href="/webgl/lessons/resources/lesson.css">

  <link rel="alternate" hreflang="en" href="https://webglfundamentals.org/webgl/lessons/webgl-3d-perspective.html">
  <link rel="alternate" hreflang="de" href="https://webglfundamentals.org/webgl/lessons/de/webgl-3d-perspective.html">
  <link rel="alternate" hreflang="ja" href="https://webglfundamentals.org/webgl/lessons/ja/webgl-3d-perspective.html">
  <link rel="alternate" hreflang="ko" href="https://webglfundamentals.org/webgl/lessons/ko/webgl-3d-perspective.html">
  <link rel="alternate" hreflang="pt-br" href="https://webglfundamentals.org/webgl/lessons/pt-br/webgl-3d-perspective.html">
  <link rel="alternate" hreflang="zh_cn" href="https://webglfundamentals.org/webgl/lessons/zh_cn/webgl-3d-perspective.html">




</head>
<body>
<div class="webgl_navbar">
  <div>
    <select class="language">
    <option value="/webgl/lessons/webgl-3d-perspective.html" selected>English</a>
    <option value="/webgl/lessons/de/webgl-3d-perspective.html" >Deutsch</a>
    <option value="/webgl/lessons/ja/webgl-3d-perspective.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-3d-perspective.html" >한국어</a>
    <option value="/webgl/lessons/pt-br/webgl-3d-perspective.html" >Português Brasileiro</a>
    <option value="/webgl/lessons/zh_cn/webgl-3d-perspective.html" >简体中文</a>
</select>


    <a href="#toc">Table of Contents</a>
  </div>
</div>
<div class="webgl_header">
  <h1><a href="/">WebGL2Fundamentals.org</a></h1>
<style>
#forkongithub>div {
    background: #000;
    color: #fff;
    font-family: arial,sans-serif;
    text-align: center;
    font-weight: bold;
    padding: 5px 40px;
    font-size: 0.9rem;
    line-height: 1.3rem;
    position: relative;
    transition: 0.5s;
    display: block;
    width: 400px;
    position: absolute;
    top: 0;
    right: 0;
    transform: translateX(200px) rotate(45deg) translate(10px,70px);
    box-shadow: 4px 4px 10px rgba(0,0,0,0.8);
    pointer-events: auto;
}
#forkongithub a {
  text-decoration: none;
  color: #fff;
}
#forkongithub>div:hover {
    background: #c11;
    color: #fff;
}
#forkongithub .contributors {
  font-size: 0.75rem;
  background: rgba(255,255,255,0.2);
  line-height: 1.2;
  padding: 0.1em;
}
#forkongithub>div::before,#forkongithub>div::after {
    content: "";
    width: 100%;
    display: block;
    position: absolute;
    top: 1px;
    left: 0;
    height: 1px;
    background: #fff;
}
#forkongithub>div::after {
    bottom: 1px;
    top: auto;
}

#forkongithub{
    z-index: 9999;
    /* needed for firefox */
    overflow: hidden;
    width: 300px;
    height: 300px;
    position: absolute;
    right: 0;
    top: 0;
    pointer-events: none;
}
#forkongithub svg{
  width: 1em;
  height: 1em;
  vertical-align: middle;
}
#forkongithub img {
  width: 1em;
  height: 1em;
  border-radius: 100%;
  vertical-align: middle;
}

@media (max-width: 900px) {
    #forkongithub>div {
        line-height: 1.2rem;
    }
}
@media (max-width: 700px) {
  #forkongithub {
    display: none;
  }
}
@media (max-width: 410px) {
    #forkongithub>div {
        font-size: 0.7rem;
        transform: translateX(150px) rotate(45deg) translate(20px,40px);
    }
}

</style>
<div id="forkongithub"><div><div><a href="https://github.com/gfxfundamentals/webgl2-fundamentals">Fix, Fork, Contribute <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 136 133" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(3.92891,0,0,3.92891,67.867,129.125)">
        <path d="M0,-31.904C-8.995,-31.904 -16.288,-24.611 -16.288,-15.614C-16.288,-8.417 -11.621,-2.312 -5.148,-0.157C-4.333,-0.008 -4.036,-0.511 -4.036,-0.943C-4.036,-1.329 -4.05,-2.354 -4.058,-3.713C-8.589,-2.729 -9.545,-5.897 -9.545,-5.897C-10.286,-7.779 -11.354,-8.28 -11.354,-8.28C-12.833,-9.29 -11.242,-9.27 -11.242,-9.27C-9.607,-9.155 -8.747,-7.591 -8.747,-7.591C-7.294,-5.102 -4.934,-5.821 -4.006,-6.238C-3.858,-7.29 -3.438,-8.008 -2.972,-8.415C-6.589,-8.826 -10.392,-10.224 -10.392,-16.466C-10.392,-18.244 -9.757,-19.698 -8.715,-20.837C-8.883,-21.249 -9.442,-22.905 -8.556,-25.148C-8.556,-25.148 -7.188,-25.586 -4.076,-23.478C-2.777,-23.84 -1.383,-24.02 0.002,-24.026C1.385,-24.02 2.779,-23.84 4.08,-23.478C7.19,-25.586 8.555,-25.148 8.555,-25.148C9.444,-22.905 8.885,-21.249 8.717,-20.837C9.761,-19.698 10.392,-18.244 10.392,-16.466C10.392,-10.208 6.583,-8.831 2.954,-8.428C3.539,-7.925 4.06,-6.931 4.06,-5.411C4.06,-3.234 4.04,-1.477 4.04,-0.943C4.04,-0.507 4.333,0 5.16,-0.159C11.628,-2.318 16.291,-8.419 16.291,-15.614C16.291,-24.611 8.997,-31.904 0,-31.904" style="fill:white;"/>
    </g>
</svg>
</a></div></div></div>

</div>


<div class="container">
  <div class="lesson-title">
    <h1>WebGL2 3D Perspective</h1>
  </div>
  <div class="lesson">
    <div class="lesson-main">
      <p>This post is a continuation of a series of posts about WebGL.
The first <a href="webgl-fundamentals.html">started with fundamentals</a> and
the previous was about <a href="webgl-3d-orthographic.html">3D Basics</a>.
If you haven&#39;t read those please view them first.</p>
<p>In the last post we went over how to do 3D but that 3D didn&#39;t have any perspective.
It was using what&#39;s called an &quot;orthographic&quot; view which has its uses but it&#39;s
generally not what people want when they say &quot;3D&quot;.</p>
<p>Instead we need to add perspective. Just what is perspective?
It&#39;s basically the feature that things that are further away appear
smaller.</p>
<div class="webgl_center noinvertdark"><img style="width: 500px;" src="resources/perspective-example.svg" /></div>

<p>Looking at the example above we see that things further away
are drawn smaller. Given our current sample one easy way to
make it so that things that are further away appear smaller
would be to divide the clip space X and Y by Z.</p>
<p>Think of it this way: If you have a line from (10, 15) to (20,15)
it&#39;s 10 units long. In our current sample it would be drawn 10 pixels
long. But if we divide by Z then for example if Z is 1</p>
<pre class="webgl_center">
10 / 1 = 10
20 / 1 = 20
abs(10-20) = 10
</pre>

<p>it would be 10 pixels long, If Z is 2 it would be</p>
<pre class="webgl_center">
10 / 2 = 5
20 / 2 = 10
abs(5 - 10) = 5
</pre>

<p>5 pixels long.  At Z = 3 it would be</p>
<pre class="webgl_center">
10 / 3 = 3.333
20 / 3 = 6.666
abs(3.333 - 6.666) = 3.333
</pre>

<p>You can see that as Z increases, as it gets further away, we&#39;ll end up drawing it smaller.
If we divide in clip space we might get better results because Z will be a smaller number (-1 to +1).
If we add a fudgeFactor to multiply Z before we divide we can adjust how much smaller things
get for a given distance.</p>
<p>Let&#39;s try it. First let&#39;s change the vertex shader to divide by Z after we&#39;ve
multiplied it by our &quot;fudgeFactor&quot;.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">...
+uniform float u_fudgeFactor;
...
void main() {
  // Multiply the position by the matrix.
*  vec4 position = u_matrix * a_position;

  // Adjust the z to divide by
+  float zToDivideBy = 1.0 + position.z * u_fudgeFactor;

  // Divide x and y by z.
*  gl_Position = vec4(position.xy / zToDivideBy, position.zw);
}
</code></pre><p>Note, because Z in clip space goes from -1 to +1 I added 1 to get
<code class="notranslate" translate="no">zToDivideBy</code> to go from 0 to +2 * fudgeFactor</p>
<p>We also need to update the code to let us set the fudgeFactor.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">  ...
+  var fudgeLocation = gl.getUniformLocation(program, &quot;u_fudgeFactor&quot;);

  ...
+  var fudgeFactor = 1;
  ...
  function drawScene() {
    ...
+    // Set the fudgeFactor
+    gl.uniform1f(fudgeLocation, fudgeFactor);

    // Draw the geometry.
    gl.drawArrays(gl.TRIANGLES, 0, 16 * 6);
</code></pre><p>And here&#39;s the result.</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-3d-perspective.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-3d-perspective.html" target="_blank">click here to open in a separate window</a>
</div>

</p>
<p>If it&#39;s not clear drag the &quot;fudgeFactor&quot; slider from 1.0 to 0.0 to see
what things used to look like before we added our divide by Z code.</p>
<div class="webgl_center"><img src="resources/orthographic-vs-perspective.png" /></div>
<div class="webgl_center">orthographic vs perspective</div>

<p>It turns out WebGL takes the x,y,z,w value we assign to <code class="notranslate" translate="no">gl_Position</code> in our vertex
shader and divides it by w automatically.</p>
<p>We can prove this very easily by changing the shader and instead of doing the
division ourselves, put <code class="notranslate" translate="no">zToDivideBy</code> in <code class="notranslate" translate="no">gl_Position.w</code>.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">...
uniform float u_fudgeFactor;
...
void main() {
  // Multiply the position by the matrix.
  vec4 position = u_matrix * a_position;

  // Adjust the z to divide by
  float zToDivideBy = 1.0 + position.z * u_fudgeFactor;

  // Divide x, y and z by zToDivideBy
  gl_Position = vec4(position.xyz,  zToDivideBy);
}
</code></pre><p>and see how it&#39;s exactly the same.</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-3d-perspective-w.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-3d-perspective-w.html" target="_blank">click here to open in a separate window</a>
</div>

</p>
<p>Why is the fact that WebGL automatically divides by W useful? Because now, using
more matrix magic, we can just use yet another matrix to copy z to w.</p>
<p>A Matrix like this</p>
<div class="webgl_math_center"><pre class="webgl_math">
1, 0, 0, 0,
0, 1, 0, 0,
0, 0, 1, 1,
0, 0, 0, 0,
</pre></div>

<p>will copy z to w. You can look at each of those columns as</p>
<div class="webgl_math_center"><pre class="webgl_math">
x_out = x_in * 1 +
        y_in * 0 +
        z_in * 0 +
        w_in * 0 ;

y_out = x_in * 0 +
        y_in * 1 +
        z_in * 0 +
        w_in * 0 ;

z_out = x_in * 0 +
        y_in * 0 +
        z_in * 1 +
        w_in * 0 ;

w_out = x_in * 0 +
        y_in * 0 +
        z_in * 1 +
        w_in * 0 ;
</pre></div>

<p>which when simplified is</p>
<div class="webgl_math_center"><pre class="webgl_math">
x_out = x_in;
y_out = y_in;
z_out = z_in;
w_out = z_in;
</pre></div>

<p>We can add the plus 1 we had before with this matrix since we know <code class="notranslate" translate="no">w_in</code> is always 1.0.</p>
<div class="webgl_math_center"><pre class="webgl_math">
1, 0, 0, 0,
0, 1, 0, 0,
0, 0, 1, 1,
0, 0, 0, 1,
</pre></div>

<p>that will change the W calculation to</p>
<div class="webgl_math_center"><pre class="webgl_math">
w_out = x_in * 0 +
        y_in * 0 +
        z_in * 1 +
        w_in * 1 ;
</pre></div>

<p>and since we know <code class="notranslate" translate="no">w_in</code> = 1.0 then that&#39;s really</p>
<div class="webgl_math_center"><pre class="webgl_math">
w_out = z_in + 1;
</pre></div>

<p>Finally we can work our fudgeFactor back in if the matrix is this</p>
<div class="webgl_math_center"><pre class="webgl_math">
1, 0, 0, 0,
0, 1, 0, 0,
0, 0, 1, fudgeFactor,
0, 0, 0, 1,
</pre></div>

<p>which means</p>
<div class="webgl_math_center"><pre class="webgl_math">
w_out = x_in * 0 +
        y_in * 0 +
        z_in * fudgeFactor +
        w_in * 1 ;
</pre></div>

<p>and simplified that&#39;s</p>
<div class="webgl_math_center"><pre class="webgl_math">
w_out = z_in * fudgeFactor + 1;
</pre></div>

<p>So, let&#39;s modify the program again to just use matrices.</p>
<p>First let&#39;s put the vertex shader back. It&#39;s simple again</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">uniform mat4 u_matrix;

void main() {
  // Multiply the position by the matrix.
  gl_Position = u_matrix * a_position;
  ...
}
</code></pre><p>Next let&#39;s make a function to make our Z &rarr; W matrix.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">function makeZToWMatrix(fudgeFactor) {
  return [
    1, 0, 0, 0,
    0, 1, 0, 0,
    0, 0, 1, fudgeFactor,
    0, 0, 0, 1,
  ];
}
</code></pre><p>and we&#39;ll change the code to use it.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">    ...

    // Compute the matrix
+    var matrix = makeZToWMatrix(fudgeFactor);
*    matrix = m4.multiply(matrix, m4.projection(gl.canvas.clientWidth, gl.canvas.clientHeight, 400));
    matrix = m4.translate(matrix, translation[0], translation[1], translation[2]);
    matrix = m4.xRotate(matrix, rotation[0]);
    matrix = m4.yRotate(matrix, rotation[1]);
    matrix = m4.zRotate(matrix, rotation[2]);
    matrix = m4.scale(matrix, scale[0], scale[1], scale[2]);

    ...
</code></pre><p>and note, again, it&#39;s exactly the same.</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-3d-perspective-w-matrix.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-3d-perspective-w-matrix.html" target="_blank">click here to open in a separate window</a>
</div>

</p>
<p>All that was basically just to show you that dividing by Z gives us perspective
and that WebGL conveniently does this divide by Z for us.</p>
<p>But there are still some problems. For example if you set Z to around -100 you&#39;ll see something like
the animation below</p>
<div class="webgl_center"><img src="resources/z-clipping.gif" style="border: 1px solid black;" /></div>

<p>What&#39;s going on? Why is the F disappearing early? Just like WebGL clips X and Y to
values between +1 to -1 it also clips Z. What we&#39;re seeing here is where Z &lt; -1.</p>
<p>I could go into detail about the math to fix it but <a href="https://stackoverflow.com/a/28301213/128511">you can derive it</a> the same way
we did 2D projection. We need to take Z, add some amount and scale some amount and we can make any range we want
get remapped to the -1 to +1.</p>
<p>The cool thing is all of these steps can be done in 1 matrix. Even better, rather than a <code class="notranslate" translate="no">fudgeFactor</code>
we&#39;ll decide on a <code class="notranslate" translate="no">fieldOfView</code> and compute the right values to make that happen.</p>
<p>Here&#39;s a function to build the matrix.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">var m4 = {
  perspective: function(fieldOfViewInRadians, aspect, near, far) {
    var f = Math.tan(Math.PI * 0.5 - 0.5 * fieldOfViewInRadians);
    var rangeInv = 1.0 / (near - far);

    return [
      f / aspect, 0, 0, 0,
      0, f, 0, 0,
      0, 0, (near + far) * rangeInv, -1,
      0, 0, near * far * rangeInv * 2, 0
    ];
  },

  ...
</code></pre><p>This matrix will do all our conversions for us. It will adjust the units so they are
in clip space, it will do the math so that we can choose a field of view by angle
and it will let us choose our Z-clipping space. It assumes there&#39;s an <em>eye</em> or <em>camera</em> at the
origin (0, 0, 0) and given a <code class="notranslate" translate="no">zNear</code> and a <code class="notranslate" translate="no">fieldOfView</code> it computes what it would take so that
stuff at <code class="notranslate" translate="no">zNear</code> ends up at <code class="notranslate" translate="no">Z = -1</code> and stuff at <code class="notranslate" translate="no">zNear</code> that is half of <code class="notranslate" translate="no">fieldOfView</code> above or below the center
ends up with <code class="notranslate" translate="no">Y = -1</code> and <code class="notranslate" translate="no">Y = 1</code> respectively. It computes what to use for X by just multiplying by the <code class="notranslate" translate="no">aspect</code> passed in.
We&#39;d normally set this to the <code class="notranslate" translate="no">width / height</code> of the display area.
Finally, it figures out how much to scale things in Z so that stuff at zFar ends up at <code class="notranslate" translate="no">Z = 1</code>.</p>
<p>Here&#39;s a diagram of the matrix in action.</p>
<p><div class="webgl_diagram_container">
  <iframe class="webgl_example " style="width: 400px; height: 600px;" src="/webgl/lessons/../frustum-diagram.html"></iframe>
</div>

</p>
<p>That shape that looks like a 4 sided cone the cubes are spinning in is called a &quot;frustum&quot;.
The matrix takes the space inside the frustum and converts that to clip space. <code class="notranslate" translate="no">zNear</code> defines where
things will get clipped in the front and <code class="notranslate" translate="no">zFar</code> defines where things get clipped in the back. Set <code class="notranslate" translate="no">zNear</code> to 23 and
you&#39;ll see the front of the spinning cubes get clipped. Set <code class="notranslate" translate="no">zFar</code> to 24 and you&#39;ll see the back of the cubes
get clipped.</p>
<p>There&#39;s just one problem left. This matrix assumes there&#39;s a viewer at 0,0,0 and
it assumes it&#39;s looking in the negative Z direction and that positive Y is up.
Our matrices up to this point have done things in a different way. </p>
<p>To make it appear we need to move it inside the frustum.
We can do that by moving our F. We were drawing at (45, 150, 0). Let&#39;s move it to (-150, 0, -360)
and let&#39;s set the rotation to something that makes it appear right side up.</p>
<div class="webgl_center"><img src="resources/f-right-side.svg" style="width: 500px;" caption="not to scale"></div>

<p>Now, to use it we just need to replace our old call to m4.projection with a call to
m4.perspective</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">   var aspect = gl.canvas.clientWidth / gl.canvas.clientHeight;
   var zNear = 1;
   var zFar = 2000;
   var matrix = m4.perspective(fieldOfViewRadians, aspect, zNear, zFar);
   matrix = m4.translate(matrix, translation[0], translation[1], translation[2]);
   matrix = m4.xRotate(matrix, rotation[0]);
   matrix = m4.yRotate(matrix, rotation[1]);
   matrix = m4.zRotate(matrix, rotation[2]);
   matrix = m4.scale(matrix, scale[0], scale[1], scale[2]);
</code></pre><p>And here it is.</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-3d-perspective-matrix.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-3d-perspective-matrix.html" target="_blank">click here to open in a separate window</a>
</div>

</p>
<p>We&#39;re back to just a matrix multiply and we&#39;re getting both a field of view and we&#39;re able to choose our Z space.
We&#39;re not done but this article is getting too long. Next up, <a href="webgl-3d-camera.html">cameras</a>.</p>
<div class="webgl_bottombar">
<h3>Why did we move the F so far in Z (-360)?</h3>
<p>

In the other samples we had the F at (45, 150, 0) but in the last sample
it's been moved to (-150, 0, -360).  Why did it need to be moved so far
away?

</p>
<p>

The reason is up until this last sample our <code class="notranslate" translate="no">m4.projection</code> function
has made a projection from pixels to clip space.  That means the area we
were displaying represented 400x300 pixels.  Using 'pixels' really doesn't
make sense in 3D. 

</p>
<p>

In other words if we tried to draw with the F at 0,0,0 and not rotated we'd get this

</p>

<div class="webgl_center"><img src="resources/f-big-and-wrong-side.svg" style="width: 500px;"></div>

<p>
The F has its top left front corner at the origin. The projection
looks toward negative Z but our F is built in positive Z. The projection has
positive Y up but our F is built with positive Z down.
</p>

<p>
Our new projection only sees what's in the blue frustum. With -zNear = 1 and with a field of view of 60 degrees
then at Z = -1 the frustum is only 1.154 units tall and 1.154 * aspect units wide. At Z = -2000 (-zFar) its 2309 units tall.
Since our F is 150 units big and the view can only see 1.154
units when something is at <code class="notranslate" translate="no">-zNear</code> we need to move it pretty far away from the origin to
see all of it.
</p>

<p>
Moving it -360 units in Z moves in inside the frustum. We also rotated it to be right side up.
</p>

<div class="webgl_center"><img src="resources/f-right-side.svg" style="width: 500px;"><div>not to scale</div></div>

<p></div></p>

    </div>
    <div class="lesson-sidebar">
        <select class="language">
    <option value="/webgl/lessons/webgl-3d-perspective.html" selected>English</a>
    <option value="/webgl/lessons/de/webgl-3d-perspective.html" >Deutsch</a>
    <option value="/webgl/lessons/ja/webgl-3d-perspective.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-3d-perspective.html" >한국어</a>
    <option value="/webgl/lessons/pt-br/webgl-3d-perspective.html" >Português Brasileiro</a>
    <option value="/webgl/lessons/zh_cn/webgl-3d-perspective.html" >简体中文</a>
</select>


        <div id="toc">
          <ul>  <li>Fundamentals</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-getting-webgl2.html">How to use WebGL2</a></li>
<li><a href="/webgl/lessons/webgl-fundamentals.html">Fundamentals</a></li>
<li><a href="/webgl/lessons/webgl-how-it-works.html">How It Works</a></li>
<li><a href="/webgl/lessons/webgl-shaders-and-glsl.html">Shaders and GLSL</a></li>
<li><a href="/webgl/lessons/resources/webgl-state-diagram.html">WebGL2 State Diagram</a></li>
        </ul>
  <li>WebGL2 vs WebGL1</li>
        <ul>
          <li><a href="/webgl/lessons/webgl2-whats-new.html">What's new in WebGL2</a></li>
<li><a href="/webgl/lessons/webgl1-to-webgl2.html">Moving from WebGL1 to WebGL2</a></li>
<li><a href="/webgl/lessons/webgl1-to-webgl2-fundamentals.html">Differences from WebGLFundamentals.org to WebGL2Fundamentals.org</a></li>
        </ul>
  <li>Image Processing</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-image-processing.html">Image Processing</a></li>
<li><a href="/webgl/lessons/webgl-image-processing-continued.html">Image Processing Continued</a></li>
        </ul>
  <li>2D translation, rotation, scale, matrix math</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-2d-translation.html">2D Translation</a></li>
<li><a href="/webgl/lessons/webgl-2d-rotation.html">2D Rotation</a></li>
<li><a href="/webgl/lessons/webgl-2d-scale.html">2D Scale</a></li>
<li><a href="/webgl/lessons/webgl-2d-matrices.html">2D Matrices</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-3d-orthographic.html">Orthographic 3D</a></li>
<li><a href="/webgl/lessons/webgl-3d-perspective.html">3D Perspective</a></li>
<li><a href="/webgl/lessons/webgl-3d-camera.html">3D - Cameras</a></li>
<li><a href="/webgl/lessons/webgl-matrix-naming.html">3D - Matrix Naming</a></li>
        </ul>
  <li>Lighting</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-3d-lighting-directional.html">Directional Lighting</a></li>
<li><a href="/webgl/lessons/webgl-3d-lighting-point.html">Point Lighting</a></li>
<li><a href="/webgl/lessons/webgl-3d-lighting-spot.html">Spot Lighting</a></li>
        </ul>
  <li>Structure and Organization</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-less-code-more-fun.html">Less Code, More Fun</a></li>
<li><a href="/webgl/lessons/webgl-drawing-multiple-things.html">Drawing Multiple Things</a></li>
<li><a href="/webgl/lessons/webgl-scene-graph.html">Scene Graphs</a></li>
        </ul>
  <li>Geometry</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-3d-geometry-lathe.html">3D Geometry - Lathe</a></li>
<li><a href="/webgl/lessons/webgl-load-obj.html">Loading .obj files</a></li>
<li><a href="/webgl/lessons/webgl-load-obj-w-mtl.html">Loading .obj w .mtl files</a></li>
        </ul>
  <li>Textures</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-3d-textures.html">Textures</a></li>
<li><a href="/webgl/lessons/webgl-data-textures.html">Data Textures</a></li>
<li><a href="/webgl/lessons/webgl-2-textures.html">Using 2 or More Textures</a></li>
<li><a href="/webgl/lessons/webgl-cors-permission.html">Cross Origin Images</a></li>
<li><a href="/webgl/lessons/webgl-3d-perspective-correct-texturemapping.html">Perspective Correct Texture Mapping</a></li>
<li><a href="/webgl/lessons/webgl-planar-projection-mapping.html">Planar and Perspective Projection Mapping</a></li>
        </ul>
  <li>Rendering To A Texture</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-render-to-texture.html">Render to Texture</a></li>
        </ul>
  <li>Shadows</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-shadows.html">Shadows</a></li>
        </ul>
  <li>Techniques</li>
        <ul>
            <li>2D</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-2d-drawimage.html">2D - DrawImage</a></li>
<li><a href="/webgl/lessons/webgl-2d-matrix-stack.html">2D - Matrix Stack</a></li>
<li><a href="/webgl/lessons/webgl-sprites.html">Sprites</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-cube-maps.html">Cubemaps</a></li>
<li><a href="/webgl/lessons/webgl-environment-maps.html">Environment maps</a></li>
<li><a href="/webgl/lessons/webgl-skybox.html">Skyboxes</a></li>
<li><a href="/webgl/lessons/webgl-skinning.html">Skinning</a></li>
<li><a href="/webgl/lessons/webgl-fog.html">Fog</a></li>
<li><a href="/webgl/lessons/webgl-picking.html">Picking (clicking on stuff)</a></li>
        </ul>
  <li>Text</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-text-html.html">Text - HTML</a></li>
<li><a href="/webgl/lessons/webgl-text-canvas2d.html">Text - Canvas 2D</a></li>
<li><a href="/webgl/lessons/webgl-text-texture.html">Text - Using a Texture</a></li>
<li><a href="/webgl/lessons/webgl-text-glyphs.html">Text - Using a Glyph Texture</a></li>
        </ul>
  <li>GPGPU</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-gpgpu.html">GPGPU</a></li>
        </ul>
        </ul>
  <li>Tips</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-smallest-programs.html">Smallest Programs</a></li>
<li><a href="/webgl/lessons/webgl-drawing-without-data.html">Drawing Without Data</a></li>
<li><a href="/webgl/lessons/webgl-shadertoy.html">Shadertoy</a></li>
<li><a href="/webgl/lessons/webgl-pulling-vertices.html">Pulling Vertices</a></li>
        </ul>
  <li>Optimization</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-indexed-vertices.html">Indexed Vertices (gl.drawElements)</a></li>
<li><a href="/webgl/lessons/webgl-instanced-drawing.html">Instanced Drawing</a></li>
        </ul>
  <li>Misc</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-setup-and-installation.html">Setup And Installation</a></li>
<li><a href="/webgl/lessons/webgl-boilerplate.html">Boilerplate</a></li>
<li><a href="/webgl/lessons/webgl-resizing-the-canvas.html">Resizing the Canvas</a></li>
<li><a href="/webgl/lessons/webgl-animation.html">Animation</a></li>
<li><a href="/webgl/lessons/webgl-points-lines-triangles.html">Points, Lines, and Triangles</a></li>
<li><a href="/webgl/lessons/webgl-multiple-views.html">Multiple Views, Multiple Canvases</a></li>
<li><a href="/webgl/lessons/webgl-visualizing-the-camera.html">Visualizing the Camera</a></li>
<li><a href="/webgl/lessons/webgl-and-alpha.html">WebGL2 and Alpha</a></li>
<li><a href="/webgl/lessons/webgl-2d-vs-3d-library.html">2D vs 3D libraries</a></li>
<li><a href="/webgl/lessons/webgl-anti-patterns.html">Anti-Patterns</a></li>
<li><a href="/webgl/lessons/webgl-matrix-vs-math.html">WebGL2 Matrices vs Math Matrices</a></li>
<li><a href="/webgl/lessons/webgl-precision-issues.html">Precision Issues</a></li>
<li><a href="/webgl/lessons/webgl-tips.html#screenshot">Taking a screenshot</a></li>
<li><a href="/webgl/lessons/webgl-tips.html#preservedrawingbuffer">Prevent the Canvas Being Cleared</a></li>
<li><a href="/webgl/lessons/webgl-tips.html#tabindex">Get Keyboard Input From a Canvas</a></li>
<li><a href="/webgl/lessons/webgl-tips.html#html-background">Use WebGL2 as Background in HTML</a></li>
<li><a href="/webgl/lessons/webgl-cross-platform-issues.html">Cross Platform Issues</a></li>
<li><a href="/webgl/lessons/webgl-qna.html">Questions and Answers</a></li>
        </ul>
  <li>Reference</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-attributes.html">Attributes</a></li>
<li><a href="/webgl/lessons/webgl-texture-units.html">Texture Units</a></li>
<li><a href="/webgl/lessons/webgl-framebuffers.html">Framebuffers</a></li>
<li><a href="/webgl/lessons/webgl-readpixels.html">readPixels</a></li>
<li><a href="/webgl/lessons/webgl-references.html">References</a></li>
        </ul></ul>
<ul>
  <li><a href="/docs/">Helper API Docs</a></li>
  <li><a href="https://twgljs.org">TWGL, A tiny WebGL helper library</a></li>
  <li><a href="https://github.com/gfxfundamentals/webgl2-fundamentals">github</a></li>
</ul>
        </div>
    </div>
    <div class="lesson-comments">
        
<div>Issue/Bug? <a href="https://github.com/gfxfundamentals/webgl2-fundamentals/issues">Create an issue on github</a>.</div>
<div class="lesson-comment-notes">
   Use <b>&lt;pre&gt;&lt;code&gt;</b>code goes here<b>&lt;/code&gt;&lt;/pre&gt;</b> for code blocks
</div>
  

        <div id="disqus_thread"></div>
        <script>
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'webgl2fundamentals'; // required: replace example with your forum shortname
            var disqus_identifier = 'WebGL2 3D Perspective';
            var disqus_title = 'WebGL2 3D Perspective';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                if (window.location.hostname.indexOf("webgl2fundamentals.org") < 0) {
                    return;
                }
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>
</div>
</body>
<script>
const settings = {
  contribTemplate: "Thank you <a href=\"${html_url}\"><img src=\"${avatar_url}\"> ${login}</a><br>for <a href=\"https://github.com/${owner}/${repo}/commits?author=${login}\">${contributions} contributions</a>",
  owner: "gfxfundamentals",
  repo: "webgl2-fundamentals",
};
</script>
<script src="/contributors.js"></script>
<script src="/3rdparty/jquery-1.11.2.min.js"></script>
<script src="/webgl/lessons/resources/prettify.js"></script>
<script src="/webgl/lessons/resources/lesson.js" type="module"></script>
<script>
</script>


</html>



